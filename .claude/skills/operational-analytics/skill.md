---
name: operational-analytics
description: |
  è¿è¥åˆ†æAgentï¼Œè´Ÿè´£EOPï¼ˆEnterprise Operation Platformï¼‰æ•°æ®åº“æŸ¥è¯¢ä¸åˆ†æã€‚æ”¯æŒè®¢å•æŸ¥è¯¢ã€ç§Ÿæˆ·ç»Ÿè®¡ã€è¥æ”¶åˆ†æã€è¿è¥æŠ¥è¡¨ã€‚

  è§¦å‘è¯ï¼šEOPã€è¿è¥å¹³å°ã€è®¢å•æŸ¥è¯¢ã€ç§Ÿæˆ·æ•°æ®ã€è¥æ”¶åˆ†æã€ç»“ç®—å•ã€t_ocm_* è¡¨å
---

# è¿è¥åˆ†æ Skill

æ ¹æ®è‡ªç„¶è¯­è¨€æŸ¥è¯¢ EOP æ•°æ®åº“ï¼Œç”Ÿæˆ SQL å¹¶è¿”å›ç»“æœã€‚

---

## æŸ¥è¯¢å·¥å…·

```bash
# æ‰§è¡Œ SQL æŸ¥è¯¢ï¼ˆè‡ªåŠ¨å®‰å…¨æ£€æŸ¥ï¼šSELECT-only, 4è¡¨ç™½åå•, 60ç§’è¶…æ—¶ï¼‰
source .venv/bin/activate
python .claude/skills/operational-analytics/scripts/query.py "SELECT ..."

# ç»“æœä¸ºç©ºæ—¶è¯Šæ–­
python .claude/skills/operational-analytics/scripts/diagnose.py --tenant "ç§Ÿæˆ·å" --year 2025
```

---

## æŸ¥è¯¢è§„åˆ’å·¥ä½œæµ

å¤åˆ¶æ£€æŸ¥æ¸…å•å¹¶è·Ÿè¸ªè¿›åº¦ï¼š

```
æŸ¥è¯¢è¿›åº¦ï¼š
- [ ] æ­¥éª¤1ï¼šè¯†åˆ«æŸ¥è¯¢æ„å›¾
- [ ] æ­¥éª¤2ï¼šé€‰æ‹©ä¸»è¡¨
- [ ] æ­¥éª¤3ï¼šåº”ç”¨ä¸šåŠ¡è§„åˆ™
- [ ] æ­¥éª¤4ï¼šéªŒè¯å¹¶æ‰§è¡Œ
```

### æ­¥éª¤1ï¼šè¯†åˆ«æŸ¥è¯¢æ„å›¾

- **å®¢æˆ·/äº§å“æŸ¥è¯¢** â†’ ä¼˜å…ˆä½¿ç”¨ `t_ocm_kbc_order_settle`ï¼ˆç»“ç®—è¡¨ï¼‰
- **è®¢å•è¯¦æƒ…/æ—¶é—´çº¿** â†’ ä½¿ç”¨ `t_ocm_order_header`ï¼ˆè®¢å•è¡¨ï¼‰
- **é‡‘é¢æŸ¥è¯¢** â†’ å…ˆç¡®è®¤é‡‘é¢ç±»å‹ï¼ˆè§ä¸‹æ–‡"é‡‘é¢å­—æ®µæ˜ å°„"ï¼‰

### æ­¥éª¤2ï¼šé€‰æ‹©ä¸»è¡¨

å‚è€ƒ"è¡¨å¿«é€Ÿç´¢å¼•"é€‰æ‹©æœ€é€‚åˆçš„è¡¨ã€‚

### æ­¥éª¤3ï¼šåº”ç”¨ä¸šåŠ¡è§„åˆ™

æ ¹æ®æŸ¥è¯¢ç±»å‹åº”ç”¨è¿‡æ»¤è§„åˆ™ï¼ˆè§ä¸‹æ–‡"å…³é”®ä¸šåŠ¡è§„åˆ™"ï¼‰ã€‚

### æ­¥éª¤4ï¼šéªŒè¯å¹¶æ‰§è¡Œ

æ‰§è¡Œå‰æ£€æŸ¥ï¼šæ—¶é—´èŒƒå›´è¿‡æ»¤ã€ä¸šåŠ¡è§„åˆ™ã€æŸ¥è¯¢é€»è¾‘ã€‚

---

## è¡¨å¿«é€Ÿç´¢å¼•

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ |
|------|------|----------|
| **t_ocm_kbc_order_settle** | ç»“ç®—/æ”¶æ¬¾ | fuse_customer, fprice_tax_amount, fpost_date |
| **t_ocm_order_header** | è®¢å•æŸ¥è¯¢ | fbillno, fap_amount, fcreatetime |
| **t_ocm_order_lines** | äº§å“æ˜ç»† | fentryid, famount |
| **t_ocm_tenant** | ç§Ÿæˆ·ä¿¡æ¯ | fid, fname |

**è¯¦ç»†å­—æ®µè¯´æ˜**ï¼š[reference/tables.md](reference/tables.md)

---

## è¡¨å…³è”å…³ç³»

```
t_ocm_order_header.fid (1) â†â†’ (N) t_ocm_order_lines.fentryid
t_ocm_order_header.ftenant (N) â†â†’ (1) t_ocm_tenant.fid
```

**JOIN å»ºè®®**ï¼š
- è®¢å• + äº§å“æ˜ç»†ï¼š`INNER JOIN`
- è®¢å• + ç§Ÿæˆ·ï¼š`LEFT JOIN`ï¼ˆç§Ÿæˆ·ä¿¡æ¯å¯èƒ½ç¼ºå¤±ï¼‰
- å®¢æˆ·æŸ¥äº§å“ï¼š**æ— éœ€JOIN**ï¼Œç›´æ¥æŸ¥ç»“ç®—è¡¨

---

## é‡‘é¢å­—æ®µæ˜ å°„

å½“ç”¨æˆ·æŸ¥è¯¢"é‡‘é¢"ä½†ç±»å‹ä¸æ˜ç¡®æ—¶ï¼Œ**å¿…é¡»ç”¨ AskUserQuestion ç¡®è®¤**ï¼š

| ç”¨æˆ·æ„å›¾ | æŸ¥è¯¢è¡¨ | å­—æ®µ |
|---------|--------|------|
| ç»“ç®—/æ”¶æ¬¾é‡‘é¢ | t_ocm_kbc_order_settle | fprice_tax_amount |
| è®¢å•/åˆåŒé‡‘é¢ | t_ocm_order_header | fap_amount |
| æ ‡å‡†æŠ¥ä»· | t_ocm_order_header | fstandard_amount |

**æ”¶æ¬¾ç±»å‹ç»†åˆ†**ï¼ˆç»“ç®—è¡¨ fc_contract_typeï¼‰ï¼š
- è®¢é˜…æ”¶æ¬¾ï¼š`= 'ç§ŸèµæœåŠ¡'`
- äº§å“æ”¶æ¬¾ï¼š`IN ('ç§ŸèµæœåŠ¡', 'è½¯ä»¶è®¸å¯')`
- è€ƒæ ¸æ”¶æ¬¾ï¼šä¸è¿‡æ»¤

å…³ç³»ï¼šè€ƒæ ¸æ”¶æ¬¾ âŠ‡ äº§å“æ”¶æ¬¾ âŠ‡ è®¢é˜…æ”¶æ¬¾

---

## å…³é”®ä¸šåŠ¡è§„åˆ™

### è¥æ”¶ç»Ÿè®¡è¿‡æ»¤

**è®¢å•è¡¨ (t_ocm_order_header)**ï¼š
```sql
WHERE fbiz_type = 'Standard'           -- æ ‡å‡†ä»˜è´¹è®¢å•
  AND fbusiness_type != 'Upgradation'  -- æ’é™¤å‡çº§ï¼ˆä¸è®¡è´¹ï¼‰
```

**ç»“ç®—è¡¨ (t_ocm_kbc_order_settle)**ï¼š
```sql
WHERE fdelivery_status = 'å·²äº¤ä»˜'       -- å·²äº¤ä»˜æ‰å¯ç»“ç®—
```

**å®Œæ•´æšä¸¾å€¼å’Œä¸šåŠ¡è§„åˆ™**ï¼šè§ [reference/tables.md](reference/tables.md#æšä¸¾å€¼å®šä¹‰)

---

## æŸ¥è¯¢ä¼˜åŒ–

- æ·»åŠ æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼ˆfpost_date / fcreatetimeï¼‰
- å®¢æˆ·åæœç´¢ä½¿ç”¨ `LIKE '%å…³é”®å­—%'`
- é¿å…ä¸å¿…è¦çš„ JOIN

---

## è¾“å‡ºæ ¼å¼

### 1. å±•ç¤º SQL

```sql
SELECT ...
```

### 2. ç»“æ„åŒ–åˆ—è¡¨ï¼ˆé€‚é…èŠå¤©å·¥å…·ï¼‰

```
ã€æŸ¥è¯¢æ ‡é¢˜ã€‘

â–ª é¡¹ç›®1
  â€¢ å­—æ®µ1ï¼šå€¼1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° æ±‡æ€»ä¿¡æ¯
```

### 3. è‡ªç„¶è¯­è¨€è§£é‡Š

è¯´æ˜æŸ¥è¯¢æ€è·¯ã€æ•°æ®æ¥æºã€ä¸šåŠ¡å«ä¹‰ã€‚

---

## æ•…éšœæ’æŸ¥

### æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Ÿ

1. **è¿è¡Œè¯Šæ–­**ï¼š
   ```bash
   python .claude/skills/operational-analytics/scripts/diagnose.py --tenant "ç§Ÿæˆ·å" --year 2025
   ```

2. **å¸¸è§é—®é¢˜**ï¼š
   - å®¢æˆ·åæ‹¼å†™ï¼ˆç”¨ `LIKE '%å…³é”®å­—%'`ï¼‰
   - æ—¥æœŸèŒƒå›´è¿‡çª„
   - äº¤ä»˜çŠ¶æ€è¿‡æ»¤
   - è®¢å•ç±»å‹è¿‡æ»¤
