---
name: prd-generator
description: PRD生成Agent，负责根据用户需求生成结构化的产品需求文档（Product Requirements Document）。基于《业务动作表》和《数据标准字典》知识库，生成符合发票云业务规范的PRD文档。触发词：PRD、产品需求文档、需求文档、功能设计、用户故事、需求分析
---

# PRD 生成 Skill

根据用户输入的产品需求，结合发票云业务知识库，生成结构化的产品需求文档（PRD）。

---

## 知识库资源

本 Skill 依赖以下知识库文件，生成 PRD 时必须参考：

1. **《业务动作表》V2.md** (#[[file:reference/《业务动作表》V2.md]])
   - 包含9个核心开票功能的完整业务动作定义
   - 提供动作ID、输入参数、输出参数、业务规则、验收标准等标准化描述
   - 涵盖：开具发票、同步税局发票、打印发票、交付发票文件、下载发票文件、导出发票数据、预览发票文件、作废发票、红冲发票

2. **《数据标准字典-销项发票数据》V0.1.xlsx**
   - 定义销项发票相关的数据模型和字段规范
   - 提供字段名称、数据类型、长度限制、枚举值等标准定义
   - 确保 PRD 中的数据字段与系统数据模型保持一致
   - **读取方式**: 使用 `scripts/excel_reader.py` 脚本读取 Excel 内容

---

## 核心规则

### 文档生成原则

1. **结构化输出**：按照标准 PRD 模板组织内容
2. **需求明确性**：确保需求描述清晰、可执行
3. **用户导向**：从用户价值出发，明确功能目标
4. **可验收性**：提供明确的验收标准
5. **知识库驱动**：优先引用《业务动作表》和《数据标准字典》中的标准定义

### 信息收集策略

**当用户提供的信息不足时，MUST 使用 AskUserQuestion 工具收集必要信息：**

必要信息包括：
- 产品/功能名称
- 目标用户
- 核心需求/痛点
- 预期目标

**🛑 调用 AskUserQuestion 后，立即停止执行 🛑**
- **DO NOT** 继续生成 PRD
- **WAIT** 用户回答会在下一轮对话中返回
- 用户回答后，再根据完整信息生成 PRD

---

## 执行流程

### 步骤0: 读取 Excel 数据字典（如需要）

**当需要查询《数据标准字典》时，使用以下命令读取 Excel 文件：**

```bash
python scripts/excel_reader.py reference/01-《数据标准字典-销项发票数据》V0.1.xlsx markdown
```

**输出格式选项**：
- `markdown`（推荐）：生成 Markdown 表格，便于阅读
- `json`：生成 JSON 格式，便于程序处理
- `text`：生成纯文本，使用 Tab 分隔

**使用场景**：
- 需要查询具体字段定义时
- 需要确认数据类型和长度限制时
- 需要查看枚举值和约束规则时

### 步骤1: 需求理解与知识库匹配

1. **识别需求类型**：
   - 新功能开发
   - 功能优化
   - 问题修复
   - 流程改进

2. **提取关键信息**：
   - 产品/功能名称
   - 目标用户群体
   - 核心痛点
   - 业务目标

3. **匹配知识库内容**：
   - 检查需求是否涉及《业务动作表》中的9个核心功能
   - 如涉及开票、作废、红冲等业务，直接引用业务动作表中的标准定义
   - 如需查询《数据标准字典》，使用 `scripts/excel_reader.py` 读取 Excel 文件
   - 确认涉及的数据字段和约束规则

4. **信息补全**：
   - 如果信息不足，使用 AskUserQuestion 工具询问
   - 确保有足够信息生成完整 PRD

### 步骤2: 文档生成（基于知识库）

按照标准 PRD 结构生成文档，包含以下章节：

1. **文档信息**
2. **需求概述**
3. **用户分析**
4. **功能需求**（重点：引用《业务动作表》）
   - 如需求涉及业务动作表中的功能，直接引用其动作ID、动作名称、输入参数、输出参数等
   - 复用业务动作表中的业务规则和约束条件
   - 确保参数命名与数据标准字典保持一致
5. **数据模型**（新增：引用《数据标准字典》）
   - 列出涉及的数据实体和字段
   - 引用数据标准字典中的字段定义、数据类型、长度限制
   - 明确枚举值和约束规则
6. **非功能需求**
7. **验收标准**（重点：引用《业务动作表》中的提交准则）
8. **风险与依赖**

### 步骤3: 质量检查

生成后检查：
- 需求描述是否清晰
- 验收标准是否可执行
- 是否遗漏关键信息

---

## PRD 标准模板

### 1. 文档信息

```markdown
# [产品/功能名称] PRD

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | YYYY-MM-DD |
| 负责人 | [姓名] |
| 优先级 | P0/P1/P2 |
| 状态 | 草稿/评审中/已确认 |
```

### 2. 需求概述

```markdown
## 需求概述

### 背景
[描述产品/功能的业务背景和产生原因]

### 目标
[明确要达成的业务目标，使用 SMART 原则]

### 范围
**包含**：
- [功能点1]
- [功能点2]

**不包含**：
- [明确不在本期范围内的内容]
```

### 3. 用户分析

```markdown
## 用户分析

### 目标用户
- **用户角色1**：[描述]
- **用户角色2**：[描述]

### 用户痛点
1. [痛点1描述]
2. [痛点2描述]

### 用户价值
- [价值点1]
- [价值点2]
```

### 4. 功能需求

```markdown
## 功能需求

### 功能1：[功能名称]

**动作ID**：[如涉及业务动作表，引用动作ID，如：INVOICE_ISSUE_BLUE]

**用户故事**：
作为 [用户角色]，我希望 [功能描述]，以便 [达成目标]。

**功能描述**：
[详细描述功能的实现方式和交互流程]
[如涉及业务动作表，引用"动作目的与描述"内容]

**输入参数**：
[如涉及业务动作表，引用"输入参数"和"输入约束"内容]
| 参数名称 | 参数说明 | 是否必填 | 数据类型 | 约束条件 |
|---------|---------|---------|---------|---------|
| [参数1] | [说明] | 必填/可选 | [类型] | [约束] |

**业务规则**：
[如涉及业务动作表，引用"提交准则"内容]
1. [规则1]
2. [规则2]

**输出结果**：
[如涉及业务动作表，引用"输出参数（执行结果/返回值）"内容]
| 字段名称 | 字段说明 | 数据类型 |
|---------|---------|---------|
| [字段1] | [说明] | [类型] |

**状态变更**：
[如涉及业务动作表，引用"输出参数（属性修改逻辑）"内容]
- [原状态] → [新状态]

**界面原型**：
[如有原型图，在此说明或引用]

---

### 功能2：[功能名称]
...
```

### 5. 数据模型（新增）

```markdown
## 数据模型

### 涉及的数据实体
[列出本需求涉及的数据实体，引用《数据标准字典》]

#### 实体1：[实体名称，如：OutputInvoice（销项发票）]

**核心字段**：
| 字段名称 | 字段说明 | 数据类型 | 长度 | 是否必填 | 枚举值/约束 |
|---------|---------|---------|------|---------|------------|
| [字段1] | [说明] | [类型] | [长度] | 是/否 | [约束] |
| [字段2] | [说明] | [类型] | [长度] | 是/否 | [约束] |

**数据来源**：《数据标准字典-销项发票数据》V0.1.xlsx

---

#### 实体2：[实体名称]
...
```

### 6. 非功能需求

```markdown
## 非功能需求

### 性能要求
- 响应时间：[具体指标]
- 并发量：[具体指标]

### 安全要求
- [安全要求描述]

### 兼容性
- 浏览器：[支持的浏览器版本]
- 设备：[支持的设备类型]

### 可用性
- [可用性要求]
```

### 7. 验收标准

```markdown
## 验收标准

### 功能验收
[如涉及业务动作表，引用"提交准则"作为验收标准]
- [ ] [验收项1]
- [ ] [验收项2]

### 数据验收
[基于《数据标准字典》验证数据完整性和准确性]
- [ ] 所有必填字段不为空
- [ ] 数据类型和长度符合标准字典定义
- [ ] 枚举值在允许范围内

### 性能验收
- [ ] [性能指标1]
- [ ] [性能指标2]

### 用户体验验收
- [ ] [体验指标1]
- [ ] [体验指标2]
```

### 8. 风险与依赖

```markdown
## 风险与依赖

### 技术风险
| 风险 | 影响 | 应对方案 |
|------|------|----------|
| [风险1] | [影响描述] | [应对方案] |

### 业务依赖
[如涉及业务动作表中的功能，列出依赖的前置条件]
- [依赖项1：如税控设备已配置]
- [依赖项2：如企业已开通托管服务]

### 数据依赖
[基于《数据标准字典》列出依赖的数据实体和字段]
- [依赖项1]
- [依赖项2]

### 里程碑
| 阶段 | 时间 | 交付物 |
|------|------|---------|
| 需求评审 | [日期] | PRD 文档 |
| 设计评审 | [日期] | 设计稿 |
| 开发完成 | [日期] | 功能代码 |
| 测试完成 | [日期] | 测试报告 |
| 上线发布 | [日期] | 生产环境 |
```

---

## 输出规范

### CRITICAL: 询问用户

**当需要补充信息时，MUST 使用 AskUserQuestion 工具：**

示例1 - 收集基本信息：
```
Use AskUserQuestion tool with:
question: "为了生成完整的 PRD，请提供以下信息"
header: "需求信息收集"
options:
  - label: "产品/功能名称"
    description: "请描述要开发的产品或功能"
  - label: "目标用户"
    description: "谁会使用这个功能？"
  - label: "核心痛点"
    description: "要解决什么问题？"
  - label: "预期目标"
    description: "希望达成什么效果？"
```

示例2 - 确认优先级：
```
Use AskUserQuestion tool with:
question: "请确认需求优先级"
header: "优先级"
options:
  - label: "P0 - 紧急"
    description: "影响核心功能，需立即处理"
  - label: "P1 - 高"
    description: "重要功能，近期需完成"
  - label: "P2 - 中"
    description: "常规需求，按计划推进"
  - label: "P3 - 低"
    description: "优化类需求，可延后"
```

**NEVER**：
- 在信息不足时强行生成 PRD
- 直接输出问题让用户回答（必须用 AskUserQuestion 工具）
- 猜测用户的需求意图

### 输出格式

**直接输出完整的 PRD 文档，使用 Markdown 格式。**

#### 文档结构

1. 使用清晰的标题层级（#、##、###）
2. 使用表格组织结构化信息
3. 使用列表展示要点
4. 使用 checkbox 列表展示验收标准

#### 内容要求

- **具体性**：避免模糊描述，提供具体指标
- **完整性**：覆盖所有必要章节
- **可执行性**：确保开发团队能够理解和实施
- **可验收性**：提供明确的验收标准

---

## 使用场景

### 场景1：新功能开发

用户输入：
```
我想开发一个用户反馈功能，让用户可以在产品内提交问题和建议
```

Agent 行为：
1. 识别为新功能开发
2. 收集补充信息（目标用户、具体需求、优先级等）
3. 生成完整 PRD

### 场景2：功能优化

用户输入：
```
现有的搜索功能太慢，用户体验不好，需要优化
```

Agent 行为：
1. 识别为功能优化
2. 收集当前问题详情和优化目标
3. 生成优化方案 PRD

### 场景3：基于用户故事生成

用户输入：
```
作为管理员，我希望能批量导入用户数据，以便快速完成系统初始化
```

Agent 行为：
1. 识别用户故事格式
2. 提取角色、需求、目标
3. 扩展为完整 PRD

---

## 最佳实践

### 需求描述

- 使用"用户故事"格式：作为[角色]，我希望[功能]，以便[目标]
- 避免技术实现细节，聚焦业务需求
- 明确功能边界（包含/不包含）
- **优先引用知识库**：如需求涉及业务动作表中的功能，直接引用标准定义，避免重复描述

### 参数定义

- **严格遵循《数据标准字典》**：参数命名、数据类型、长度限制必须与标准字典保持一致
- **引用业务动作表**：输入参数、输出参数、约束条件直接引用业务动作表中的定义
- 避免自创参数名称，确保与系统数据模型一致

### 验收标准

- 使用可量化的指标
- 提供具体的测试场景
- 覆盖正常流程和异常流程
- **引用业务动作表的提交准则**：作为功能验收的基础标准

### 优先级判断

- P0：影响核心功能，阻塞业务
- P1：重要功能，影响用户体验
- P2：常规需求，按计划推进
- P3：优化类需求，可延后

---

## 注意事项

1. **保持客观**：基于事实和数据，避免主观臆断
2. **用户导向**：始终从用户价值出发
3. **可执行性**：确保需求可被开发团队理解和实施
4. **迭代思维**：PRD 可以随着项目推进不断完善
5. **知识库优先**：
   - 生成 PRD 前，先检查《业务动作表》是否包含相关功能
   - 涉及数据字段时，必须查询《数据标准字典》确认字段定义
   - 引用知识库内容时，注明来源（如：来源《业务动作表》V2 - 开具发票）
6. **标准化命名**：
   - 动作ID、参数名称、字段名称必须与知识库保持一致
   - 避免使用同义词或自创名称
7. **完整性检查**：
   - 确保输入参数、输出参数、业务规则、验收标准完整覆盖
   - 数据模型章节必须包含所有涉及的数据实体和字段

---

## 常见问题

### Q: 用户提供的信息很简单，怎么办？

A: 使用 AskUserQuestion 工具收集必要信息，不要猜测或编造。

### Q: 如何处理技术实现细节？

A: PRD 聚焦"做什么"而非"怎么做"，技术方案由技术团队在设计阶段确定。

### Q: 验收标准写多详细？

A: 详细到测试人员可以直接编写测试用例的程度。

### Q: 是否需要包含 UI 设计？

A: PRD 可以包含界面原型或交互说明，但详细的 UI 设计由设计师完成。

### Q: 如何使用《业务动作表》？

A: 
1. 识别用户需求是否涉及9个核心功能之一（开具、同步、打印、交付、下载、导出、预览、作废、红冲）
2. 如涉及，直接引用业务动作表中的标准定义
3. 在 PRD 中注明动作ID，复用输入参数、输出参数、业务规则等内容
4. 确保参数命名与业务动作表保持一致

### Q: 如何使用《数据标准字典》？

A:
1. 在"数据模型"章节列出涉及的数据实体
2. 引用标准字典中的字段定义，包括字段名称、数据类型、长度、枚举值
3. 确保 PRD 中的参数命名与标准字典保持一致
4. 在验收标准中加入数据完整性和准确性验证

### Q: 如果需求不在业务动作表中怎么办？

A: 
1. 如果是全新功能，按照标准 PRD 模板编写
2. 如果涉及现有功能的扩展，参考业务动作表中相似功能的定义方式
3. 确保新增的参数和字段符合《数据标准字典》的命名规范
4. 在 PRD 中明确标注哪些是新增内容，哪些是引用知识库内容
