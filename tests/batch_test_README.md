# 批量测试结果输出格式说明

## 问题

原来使用 CSV 格式输出测试结果时，长文本（如"最终回答"和"思考过程"）存在以下问题：
1. 内容被截断（最终回答1000字符，思考过程500字符）
2. Excel 打开 CSV 时，单元格无法很好地显示长文本
3. 需要手动调整列宽和换行

## 解决方案

新增 **Excel (.xlsx) 格式输出**，具有以下优势：

### ✅ 优势

1. **完整内容** - 不截断，保留所有文本
2. **自动换行** - 单元格自动换行显示长文本
3. **预设列宽** - 合理的默认列宽（最终回答和思考过程各80字符宽）
4. **样式美化**
   - 蓝色表头，白色字体
   - 状态列根据结果显示不同颜色（成功=绿色，超时=橙色，错误=红色）
   - 冻结首行，方便滚动查看
5. **更好的中文支持**

### 📊 输出格式

| 格式 | 用途 | 优势 |
|------|------|------|
| **Excel (.xlsx)** | 查看和分析 | 完整内容、自动换行、样式美化 |
| JSON (.json) | 程序处理 | 结构化、完整信息 |

## 使用方法

### 安装依赖

```bash
source .venv/bin/activate
pip install openpyxl
```

### 运行测试

```bash
python tests/batch_test.py tests/dataset/test_set_0.md
```

运行后会在 `tests/results/` 目录生成两个文件：
- `test_set_0_YYYYMMDD_HHMMSS.xlsx` - **查看这个文件**
- `test_set_0_YYYYMMDD_HHMMSS.json` - 程序处理用

## Excel 使用技巧

1. **查看长文本** - 单元格自动换行已设置，直接滚动查看即可
2. **调整行高** - 双击行号边界，自动调整行高以显示完整内容
3. **调整列宽** - 如需更宽，拖动列边界或双击自动调整
4. **搜索内容** - Ctrl+F 在整个表格中搜索关键词
5. **冻结首行** - 已自动设置，滚动时表头始终可见

## 列宽设置

| 列名 | 宽度 | 说明 |
|------|------|------|
| 序号 | 8 | 索引 |
| 问题 | 40 | 测试问题 |
| 最终回答 | 80 | **完整内容，自动换行** |
| 思考过程 | 80 | **完整内容，自动换行** |
| 状态 | 12 | success/timeout/error |
| 耗时(s) | 12 | 执行时间 |
| 轮数 | 8 | 对话轮数 |
| 选择的产品 | 15 | 自动选择的产品 |
| 错误信息 | 30 | 错误详情 |

## 注意事项

- 如果 openpyxl 未安装，会跳过 xlsx 输出，只生成 JSON
- 所有命令行参数保持不变
