| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | 金蝶苍穹环境 | **公开** | **创建** | **2025-09-15** | **欧浩斌** |


# 文档说明
本文适用于私有化星瀚环境补丁包发布操作。

# 登录mc
登录地址： 按实际

登录账号密码： 按实际

# 上传升级包
集群管理列表——>上传升级包

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579297837-c006e371-1473-432b-a2a0-cf8c111cb46b.png)

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579303430-66c45295-8979-4585-b859-591dc7b97b02.png)

# 执行升级
集群管理列表——>升级——>选择升级包——>选择数据中心——>开始校验——>开始升级

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579419827-9352a131-32ed-447a-a86e-cf1eab0ec013.png)

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579426766-f4cc7f8b-fdce-4d3a-85eb-5845e08c863a.png)

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579432190-0c93b353-4931-40c5-983b-ad53bce0b04d.png)

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579437749-e6a698e6-896d-489f-8326-82ad5801ebd7.png)

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579444294-9db2dc4b-ea7b-49c8-9a92-84ec5d1612f3.png)

# 发布集群
集群升级完成后，需要发布集群才能生效，集群管理列表——>发布

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1760579549375-1244662d-351a-4732-95ad-cd31fe00d9cd.png)

# 重启应用
## 方法一：有GPaas管理平台
登录平台，重启mservice、web、mservice-qing服务即可

## 方法二：后台重启
连接服务器

上传重启工具包：restart-pods.tar.gz

#下载地址：[http://dl.piaozone.com:18025/download/tools/restart-pods.tar.gz](http://dl.piaozone.com:18025/download/tools/restart-pods.tar.gz) 

#账号密码：fpy   Fpy@piaonzone2025#$ 

解压：

```shell
#解压
tar xf restart-pods.tar.gz -C /opt

#执行命令：
cd /opt/updata
ls
sh restart-pods.sh
```

restart-pods.sh 脚本内容：

```shell
#!/bin/bash
#NS=ierp-ybs

#用户检查
check_user(){
  user=`whoami`
  if [ $user != root ]
  then
    echo -e "\e[31m >>>>>>>>>> you are not root,please use root!!! <<<<<<<<<<"
    exit
  fi
}

#命名空间检查
check_ns(){
  if [ `kubectl get pods -A  |grep mservice|wc -l` -ge 1 ]
  then
    NS=`kubectl get pods -A |grep mservice |head -1 |awk '{print $1}'`
    echo "namespace = $NS"
  else
    echo -e "\e[31m namespace unknown;please use \e[34m kubectl get ns \e[31m get namespace \e[0m"
	echo -e "\e[31m 请执行一下操作：\n 
	1. 将脚本中check_ns行注释 \n 
	2. 取消NS= 行的注释，并手动写入ns \e[0m"
    exit
  fi
}

#重启服务
restart(){
  list=$@
  for i in $list
  do
    echo delete  $i
    kubectl delete pods -n $NS $i
  done
}

main(){
  check_user
  check_ns
  #NS=
  mservice_list=`kubectl get pods -n $NS|grep ^mservice|awk '{print $1}'`
  web_list=`kubectl get pods -n $NS|grep ^web|awk '{print $1}'`
  echo -e "\e[32m >>>>>>>>>>>>>>> restart mservice mservice-qing..... <<<<<<<<<<<<<<\e[0m"
  restart $mservice_list
  echo -e "\e[32m >>>>>>>>>>>>>>> restart web..... <<<<<<<<<<<<<<\e[0m"
  restart $web_list

  kubectl get pods -n $NS
  echo -e "\e[32m >>>>>>>>>> restart need some times,please waitting.....<<<<<<<<<<"
  echo -e "\e[32m >>>>>>>>>> you can use \e[34m kubectl get pods -n $NS \e[32m to check status<<<<<<<<<<\e[0m"
  echo -e "\e[32m >>>>>>>>>> see READY is 1/1, restart successful <<<<<<<<<<\e[0m" 
}

main 


```

