| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **7.0及以上** | **公开** | **创建** | **2025-09-28** | **欧浩斌** |


# 文档说明
本文档适用于私有化部署旗舰版星瀚发票云；文档主要介绍了如何使用后台重启工具 重启星瀚应用服务。

# 工具下载
工具使用shell语言编写，适用于大部分的操作系统，下载地址如下：

url： [http://dl.piaozone.com:18025/download/tools/restart-pods.tar.gz](http://dl.piaozone.com:18025/download/tools/restart-pods.tar.gz)

账号密码：fpy   Fpy@piaonzone2025#$

操作步骤：

将工具上传至 k8s-master节点（一台即可） /opt 目录下

```shell
#初次使用时，需先解压工具包
cd /opt
tar xf restart-pods.tar.gz
cd updata
sh restart-pods.sh

#已有工具包时
cd /opt/updata
sh restart-pods.sh
```

# 工具包代码内容
```shell
#!/bin/bash
#NS=ierp-ybs

#用户检查
check_user(){
  user=`whoami`
  if [ $user != root ]
  then
    echo -e "\e[31m >>>>>>>>>> you are not root,please use root!!! <<<<<<<<<<"
    exit
  fi
}

#命名空间检查
check_ns(){
  if [ `kubectl get pods -A  |grep mservice|head|awk '{print $1}'|wc -l` == 1 ]
  then

    NS=`kubectl get pods -A  |grep mservice|head|awk '{print $1}'`
    echo "namespace = $NS"
  else
    echo -e "\e[31m namespace unknown;please use \e[34m kubectl get ns \e[31m get namespace \e[0m"
        echo -e "\e[31m 请执行一下操作：\n
        1. 将脚本中check_ns行注释 \n
        2. 取消NS= 行的注释，并手动写入ns \e[0m"
    exit
  fi
}

#重启服务
restart(){
  list=$@

  for i in $list
  do
    echo delete  $i
    kubectl delete pods -n $NS $i
  done
}

main(){
  check_user
  check_ns
  #NS=
  mservice_list=`kubectl get pods -n $NS|grep ^mservice|awk '{print $1}'`
  web_list=`kubectl get pods -n $NS|grep ^web|awk '{print $1}'`
  echo -e "\e[32m >>>>>>>>>>>>>>> restart mservice mservice-qing..... <<<<<<<<<<<<<<\e[0m"
  restart $mservice_list
  echo -e "\e[32m >>>>>>>>>>>>>>> restart web..... <<<<<<<<<<<<<<\e[0m"
  restart $web_list

  kubectl get pods -n $NS
  echo -e "\e[32m >>>>>>>>>> restart need some times,please waitting.....<<<<<<<<<<"
  echo -e "\e[32m >>>>>>>>>> you can use \e[34m kubectl get pods -n $NS \e[32m to check status<<<<<<<<<<\e[0m"
  echo -e "\e[32m >>>>>>>>>> see READY is 1/1, restart successful <<<<<<<<<<\e[0m"
}

main
```



