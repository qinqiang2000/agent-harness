### 1.修改配置项
#### 1.1设置模拟开票（测试税号）
星瀚数电发票模拟开票

+ <font style="color:#000000;">配置项类型</font> : all_ele_mock_invoice
+ <font style="color:#000000;">配置项key</font> : 企业实际<font style="color:#000000;">税号，比如：91789XXXXXXXXXX</font>
+ <font style="color:#000000;">配置项值</font> : <font style="color:#000000;">1(为空则不启用模拟开票)(配置成功后见单张开票页面选择数电票种，授信额度为999999999.99则表示配置成功)</font>

<font style="color:#000000;">路径:开发服务云->开发平台->发票云->系统管理->云应用参数配置->参数配置单据->列表(TAB)->预览</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763541861571-974e8ba1-d6bd-4a6a-b7c4-698f258193b7.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763541900106-fa974c9a-08cb-4899-9d8f-72409469ad79.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763541976524-e6d66758-6d27-4ded-9bc2-ae6a9c3f53b0.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542065435-dae7477d-c576-493c-89fa-bfad88b87431.png)

#### 1.2 进项发票批量导入无需查验
路径:开发服务云->开发平台->发票云->系统管理->云应用参数配置->参数配置单据->列表(TAB)->预览

配置项类型:rim_config

配置项key:rim_config_need_check

配置值:0

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542178191-e2317b5d-5e62-4bd0-b9da-1939b6f8ec72.png)

### 2.模拟开具销项发票
#### 2.1 单张开票
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542364725-4fccc737-d274-4354-9ef8-11d11eadbcc5.png)

路径：发票云->开票管理->无单据开票->单张开票

录入开票信息，发票类型选择:数电票(专票)

其中开票抬头基础资料维护:[https://jdpiaozone.yuque.com/nbklz3/tadboa/scgwhou5ghpxzfag](https://jdpiaozone.yuque.com/nbklz3/tadboa/scgwhou5ghpxzfag)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542529477-037dd7dc-29af-4dfa-9dba-42eaca2e3937.png)

项目名称，资料维护:[https://jdpiaozone.yuque.com/nbklz3/tadboa/gyfy872f6rg5gcdq](https://jdpiaozone.yuque.com/nbklz3/tadboa/gyfy872f6rg5gcdq)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542606072-b06d50d7-1c81-4ad9-bb38-7c8a0cab31d0.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763542638789-ed6c5f7d-f5ff-4782-81d0-f6dff9744dd4.png)

#### 2.2 批量导入开票申请单开票
开票申请单支持通过异构系统通过API推送、星瀚系统内通过botp推送数据，接收数据后可通过开票引擎智能匹配/映射开票项、购销方信息、备注等票面信息，处理完成后保存为开票申请单。开票申请单可进行合并、拆分后开票，支持数电发票、税控发票开具，数电支持RPA、乐企，税控发票支持金税盘、税控盘、税务ukey。

发票云开票整体流程:

![](https://cdn.nlark.com/yuque/0/2024/png/12881570/1711701172656-2508465d-db6c-4bd9-84cc-e7b24ef86bd1.png)

| **序号*** | **字段名称*** | **业务含义*** | **字段规则*** | **其他属性说明** |
| --- | --- | --- | --- | --- |
| 1 | 征税方式 | 决定了如何计算应纳税额 | 普通征税/减按计征/差额征税-全额开票/差额征税-差额开票 |  |
| 2 | 单据性质 | 开票申请单可下推生成蓝字发票或红字发票。如选择负数，增值税专用发票单据上会有红字信息栏目，需选择红字信息编号及待冲蓝票代码 |  |  |
| 3 | 申请状态 | 该状态和单据状态联合可以得出开票进度 | 未申请=未生成待开发票，部分申请=部分待开发票，已申请=已全部下推待开，可与单据状态联用来看，如已申请+单据状态为“开票结束”=已完成开票操作，所有的开票申请单上的开票金额已完成开具，已申请+单据状态为正常=已生成待开发票，所有的开票申请单上的金额已全部生成待开发票。 |  |
| 4 | 发票种类 | 通常指的是不同类型的发票，它们根据使用目的、行业特点、税收政策等因素进行分类 | 电子普票/电子专票/纸质普票/纸质专票/增值税普票/数电普票/数电专票 |  |
| 5 | 单据审批状态 | 单据在审批流程中的当前节点和状态 | 暂存/已提交/已审核/无需审批 |  |
| 6 | 关闭状态 | “关闭”状态的开票申请单无法做任何操作。<br/>①使用【关闭上游单据】按钮，可将“未关闭“状态的开票申请单变更为”关闭“，此按钮的说明见3.2节。<br/>②使用【确认应收】按钮，可将“未关闭“状态的开票申请单变更为”关闭“，此按钮的说明见3.2节。 | <font style="background-color:#FFFFFF;">非应收或者EAS来源的单据不能关闭</font> |  |
| 7 | 是否合并拆分标志 | 发票的合并开具或拆分开具的标志 |  |  |
| 8 | 拆分规则 | 拆分用于设置开票过程中对单据、明细进行拆分处理 | 开票参数设置中的拆分配置 |  |
| 9 | 合并规则 | 合并用于设置开票过程中对单据、明细进行合并处理 | 开票参数设置中的合并配置 |  |
| 10 | 交付手机 | <font style="color:#000000;">开票后的发票交付方式</font> | <font style="color:#000000;">1、最多可填写3个手机号，手机号间通过英文分隔符;隔开</font><br/><font style="color:#000000;">2、若为电票，交付手机、邮箱字段是否必填受发票推送设置管控，详见：</font>[开票其他信息设置 (yuque.com)](https://jdpiaozone.yuque.com/nbklz3/dn5ehb/ifdc0zclx18088ux#LRsfy)<font style="color:#000000;">   </font><font style="color:#000000;">3、需在发票云购买短信套餐才可使用。</font> |  |
| 11 | 交付邮箱 | <font style="color:#000000;">开票后的发票交付方式</font> | <font style="color:#000000;">1、最多可填写3个邮箱，邮箱间通过英文分隔符;隔开</font><br/><font style="color:#000000;">2、若为电票，交付手机、邮箱字段是否必填受发票推送设置管控，详见：</font>[开票其他信息设置 (yuque.com)](https://jdpiaozone.yuque.com/nbklz3/dn5ehb/ifdc0zclx18088ux#LRsfy) |  |
| 12 | 开票业务管控 | 通过对开票业务类型、通道类型、通道调度策略、授信额度等关键要素的设置和管理，实现对企业开票业务的精细化管控。 | 基础资料的开票业务管控中已配置 |  |
| 13 | 原始价税合计 | 指的是原始交易或合同中记录的价税合计金额 | 原始价税合计可能在合同签订时确定，并作为交易记录的一部分。 |  |
| 14 | 申请价税合计 | 在开票申请过程中提出的价税合计金额 | 这个金额可能与原始价税合计不同，差异可能由于多种原因，例如合同变更、价格调整 |  |
| 15 | 申请金额 | 指的是开票申请单中请求开具发票的金额，即商品或服务的总售价。 | 值为金额（不含税） |  |
| 16 | 申请税额 | 指的是根据申请金额计算出的应纳税额，通常是增值税。 | 值为税额，即为总共应该缴纳的增值税部分。 |  |
| 17 | 已申请金额 | 下推生成待开发票后写入，根据单据含税标记进行赋值<br/>当单据为含税时，全额下推时，已申请金额 = 申请价税合计<br/>当单据为不含税时，全额下推时，已申请金额 = 申请金额 |  |  |
| 18 | 已开金额 | 实际开具的发票金额 |  |  |
| 19 | 已开税额 | 实际开具的发票税额 |  |  |
| 20 | 剩余可开金额 | 单据不含税金额-已开不含税金额 | 初始值为单据不含税金额 |  |
| 21 | 剩余可开税额 | 申请税额-已开税额 | 初始值为单据税额 |  |
| 22 | 原币价税合计误差 | 由于汇率变动或计算过程中的误差，导致按照原始货币（原币）计算的价税合计金额与实际交易或开票时使用的金额存在差异 |  |  |
| 23 | 商品类型 | 商品分类 | 分为开票项/物料/费用项目 |  |
| 24 | 税额尾差 | 单据税额与发票的税额尾差 |  |  |
| 25 | 金额尾差 | 原始金额与开票金额之间的差异 |  |  |
| 26 | 数量尾差 | 原始数量与开票数量之间的差异 |  |  |
| 27 | 数据来源系统 | 数据来源系统 | 如果是接口，根据具体传BISUNESS_SYSTEM的值确定 |  |
| 28 | 数据来源 | 开票申请单来源 |  |  |
| 29 | 纳税人识别号 | 购方销方纳税人识别号 | 当购方类型为企业时，显示纳税人识别号，企业类型为个人时，显示身份证号码 |  |
| 30 | 地址及电话 | 购方销方地址及电话 |  |  |
| 31 | 开户行及账号 | 购方销方开户行及账号 |  |  |
| 32 | 征税方式 |  | （1）普通征税：指按照法定的税率和计税基础，对纳税人的应税收入或应税行为进行征税。<br/>（2）减按征税：一种税收优惠政策，允许纳税人在特定条件下享受较低的税率或减免部分税款。这种方式的目的是鼓励某些经济活动或支持特定行业的发展。<br/>（3）差额征税-全额开票：全额开票方式下，企业在开具发票时，显示的是整个销售额，包括成本和利润。<br/>（4）差额征税-差额开票：差额开票是一种特殊的开票方式，适用于特定的税务处理情况，旨在避免重复征税和简化税务处理过程。‌ |  |
| 33 | 备注 | 可展示在发票票面的备注 | （1）开具税控发票，长度为230字节，一个中文记为两个字符，一个英文记为一个字节<br/>（2）通过rpa开具数电发票，长度为200字符，一个中文、一个英文记为一个字符<br/>（3）通过乐企开具数电发票，长度为450字符，一个中文、一个英文记为一个字符<br/>（4）乐企红冲发票，限制备注385字符，若红冲的是税控票，限制378字符。<br/>在开票申请单不控制长度，开票时，按照不同的通道校验，可配置超长时的处理方式，支持超长截取、超长提示，配置方式：[https://jdpiaozone.yuque.com/nbklz3/dn5ehb/ifdc0zclx18088ux](https://jdpiaozone.yuque.com/nbklz3/dn5ehb/ifdc0zclx18088ux) |  |
| 34 | 国籍 | 销售方自然人国家或地区 | F7选择，根据证件类型/证件号码校验国籍<br/>乐企校验必填，RPA不校验 |  |


导入说明:详细可参考:[https://jdpiaozone.yuque.com/nbklz3/tadboa/uvbb02cgn0zq3g9k](https://jdpiaozone.yuque.com/nbklz3/tadboa/uvbb02cgn0zq3g9k)

点击【批量导入】

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763600873324-07f34d82-6db9-4b0e-8c41-6463ca845a24.png)

[开票申请单导入模板.xlsx](https://jdpiaozone.yuque.com/attachments/yuque/0/2025/xlsx/35533825/1763600969224-e3286d9e-0fc7-472e-974c-936285c2f748.xlsx)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763601138006-0cc1c011-da89-49fd-b68f-a9db05c2071a.png)

### 3.模拟生成红字确认单
金税四期，电票红冲，税局规定必须先申请红字确认单，再根据红字确认单红冲，数电票红冲详细说明:[https://jdpiaozone.yuque.com/nbklz3/tadboa/edhu9lhwt2kg46sv](https://jdpiaozone.yuque.com/nbklz3/tadboa/edhu9lhwt2kg46sv)

系统逻辑:由销方发起红冲，系统生成一行红字确认单，点击【录入】按钮同步录入到税局。

操作步骤:发票云->开票管理->发票逆向处理->发票红冲

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763602804933-be8365b4-35ba-4e5e-9753-6dd635e1fec5.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763602932190-e7471786-ae76-4f4a-8aa6-1128864bac6b.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763602988310-19ea1b93-0541-43b0-93d3-df53d5e816c7.png)

提交成功后生成一行唯一的红字确认单编号，可以登录购方组织下进行确认

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763603841191-bd2ac0fa-1016-482a-ad37-a78bf4166f4e.png)

进入购方组织，选择菜单:开票管理->发票逆向处理->红字确认单(数电票)

搜索红字确认单编号，点击按钮【确认】备注:数电票(普通发票)无需确认，数电票(专票)需要确认

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763604075997-41aecc3f-19ca-4a88-8f4a-3e2f51f68aef.png)

红字确认单查询:

路径：发票云->开票管理->发票逆向处理->红字确认单（数电票）

### 4.数据库插入红字信息表数据
#### 4.1 红字信息表无法从税局下载，使用SQL批量插入，单个插入sql如下
INSERT INTO t_sim_red_info(fid,finfocode,foriginalinvoicecode,foriginalivoiceno ,finvoicetype,fsalertaxno,fsalerame,fbuyerame,fbuyertaxno,finvoiceamount,ftotatax,ftotalamount ,fcreater,fmodifier,fcreatetime,fmodifytime,fapplicant,finfosource ,forg,fstatus,fstatusdescribe,finfostatus,foriginalissuetime,foriginaldeduction,fpayee,fjqbh,freviewer,finvoicecode,finvoiceno,finfoserialno,finfodate,fbatchbelong,fbillno,fapplytaxno,fsaleraddr,fsalerbank,fbuyeraddr,fbuyerbank,fapplyreason,fmaintaxrate,fhsbz,fspecialtype,fbillstatus,fsystemsource ,fdrawer,finventorymark,ftaxorg,fmergelable,fauditorid,fauditdate fsubmitterid,fsubmitdate,freason,fterminalno,taxbureauaudittime,fdecuction,forde

no,finfotype,fcancelredlable) VALUES

(2331894609947425019,'4403052103104446','4403192130','20988460','91440300789220309P','深圳市金蝶精斗云网络科技有限公司','金蝶票据云科技(深圳)有限公司','91440300MA5G9GK78Y',-4.7200000000,-0.2800000000,-5.0000000000,2144180952828478464,2144180952828478464,'2025-10-23 11:17:26.250','2025-10-27 17:12:57.858','0','2',2153154004098482176,'4','','',NULL,0.0000000000,'','','','','','621181894386251023111726','2021-03-19 00:00:00.000','','','91440300MA5G9GK78Y','D','','无邪','',2153154004098482176,'',0,NULL,0,'2021-03-19 00:00:00.000','',NULL,0.0000000000,'5AF3TMPH5RJ3EBXWCM7A','','');

#### 4.2 批量插入


### 5.前端引入进项发票数据
#### 5.1 批量导入发票，操作路径:收票管理->全票池查询，点击按钮【引入发票】
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763605105426-0668c187-33bd-4ca6-a305-b18b6265ee5b.png)

发票文件模板

[全票池引入模板.xlsx](https://jdpiaozone.yuque.com/attachments/yuque/0/2025/xlsx/35533825/1763605162051-144afe8a-0f7e-4e24-9a16-38ef6e5a9f16.xlsx)

#### 5.2 数据整理:根据票种导入数据，根据需要测试的购方维护购方名称，购方纳税人识别号
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763605363640-9d49da34-7713-43ab-b96d-5476340d415b.png)

### 6.模拟发票入账
税局无法对接提交入账状态使用SQL更新入账状态，

**ftax_recorded_status:**税局入账状态:01-未入账;11-入账处理中;02-已入账(企业所得税睡前扣除);03-已入账(企业所得税不扣除):06-入账撤销

**ftax_recorded_purpose:**税局入账用途:02:企业所得税睡前扣除03:企业所得税不扣除

**ftax_recorded_time:**税局入账时间:ftax_recorded period:税局入账属期需要执行两条sql:

--更新主表入账状态sql

update t_rim_invoice set ftax_recorded_status='入账状态', ftax_recorded_purpose='入账用途,ftax_recorded_time='入账时间’, ftax_recorded_period='入账属期' where finvoice_no ='发票号码'

--更新子表入账状态

update t_rim_inv_electric set ftax_recorded_status='入账状态", ftax_recorded_purpose='入账用途”ftax_recorded_time='入账时间', ftax _recorded_period='入账属期' where fserial_no =(select fserial_no from t_rim_invoice where finvoice_no ='发票号码’);

示例:

update t_rim_invoice set ftax_recorded status='02',ftax_recorded_purpose='02',ftax_recorded _time='2025-10-25 00:00:00', ftax_recorded_period='2025-10

25 00:00:00' where finvoice_no='16269211';--更新主表入账状态sql

update t_rim _inv_electric set ftax_recorded_status='02', ftax_recorded_purpose='02',ftax_recorded _time='2025-10-25 00:00:00', ftax_recorded_period='2025-10-25 00:00:00' where fserial_no =

(select fserial_no from t_rim_invoice where finvoice_no='16269211');--更新子表入账状态



### 7.修改发票勾选状态
#### 7.1 方式一.设置虚拟勾选
路径：【开发平台】→【发票云】→【系统管理】→【云应用参数配置】→【参数配置单据】

配置项类型：rim_config 配置项key：rim_config_unit_test_flag  配置项值：1

配置项类型：rim_config 配置项key：rim_config_test_invoice_all_success 配置项值：1

配置项类型：dim_imc_config_fpy 配置项key：unittest	 配置项值：1

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763717463610-12f24b55-7606-469f-887d-26d7d31cc68f.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763717468193-6b42c3c0-3075-4455-8ced-8ed247f8442c.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1763717491839-5aa957a9-4dc9-4c06-8130-32aa2db62958.png)

#### 7.2 方式二.数据库修改
税局无法对接提交勾选状态，使用SQL更新勾选状态

**finvoice _info:**发票信息; au_0-未勾选状态;au_1-勾选状态;or_0-签收状态

**fauthenticate_fag:**认证状态:0:未勾选1:勾选 2:勾选认证 3:扫描认证 4:预勾选 5:勾选中

**fselect_time:**勾选时间;

**ftax_period:**抵扣税期

finvoice_info, 'au_0', 'au_1’)

执行两条sql，如下:

--更新主表的勾选状态和勾选时间。

update t_rim _invoice set finvoice_ info = replace (finvoice_info, 'au_0, 'au_1"), fauthenticate_flag ='认证状态，fselect_time='勾选时间',ftax_period='抵扣税期' where finvoice_no='发票号码’;

--更新子表的勾选时间

update t_rim _inv_electric set fauthenticate flag='认证状态',fselect time='勾选时间', ftax period='抵扣税期' where fserial_no =

(select fserial_no from t_rim_invoice where finvoice_no='发票号码'):

示例:

--将主表的未勾选状态修改为勾选状态

update t_rim_invoice set finvoice_info = replace (finvoice _info, 'au 0,, 'au 1,), fauthenticate_flag = '1'fselect_time='2025-07-30 00:00:00',ftax_period='2025-07-01 00:00:00'where finvoice_no ='24952000000115886116':

--将主表的签收状态修改为签收状态+勾选状态

update t_rim_ invoice set finvoice_info = replace (finvoice_info, 'or 0,, 'or 0,au_1,’), fauthenticate_flag = '1',fselect_time='2025-07-30 00:00:00', ftax_period='2025-07-01 00:00:00' where finvoice_no ='24952000000115886116';

--更新子表的勾选时间

update t_rim_inv_electric set fauthenticate_flag ='1',fselect time='2025-07-30 00:00:00',ftax _period='2025-07-01 00:00:00' where fserial_no =

(select fserial_no from t_rim_invoice where finvoice_no ='24952000000115886116')





<font style="color:#000000;"></font>

