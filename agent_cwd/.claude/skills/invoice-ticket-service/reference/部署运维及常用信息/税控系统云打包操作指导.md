| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **7.0及以上** | **公开** | **创建** | **2025-11-19** | **欧浩斌** |


# 文档说明
本文档介绍了在星瀚环境下，新增部署税控系统云的操作指导。不同星瀚版本在部署上有所区别，文档中将详细说明。

# 非domain模式部署
星瀚7.0版本之前，基本都是使用非domain模式部署的；区分是否为domain模式，可以查看mservice容器的环境变量，如果存在domain环境变量，则为domain模式，否则为非domain模式。

## MC添加ismc分库
<font style="color:#117CEE;">路径：基础数据维护->分库标识</font>

新增分库标识： ismc

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639125538597-b19c4ac5-c221-48ac-8cad-8ea40a03ea79.png?x-oss-process=image%2Fformat%2Cwebp)

## 数据中心添加税控系统云库
在您当前使用的数据中心，添加税控系统云分库

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639446563213-32fa8ef4-c0c5-4008-b3c7-5bccdfc02fe9.png?x-oss-process=image%2Fformat%2Cwebp)

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639125700462-733b74a7-629c-437f-8102-cd978e4d645a.png?x-oss-process=image%2Fformat%2Cwebp)

点击 提交建库

保存之后，在集群管理，点击发布

## MC升级税控系统云私包
直接在MC上传升级包zip升级，即可

税控系统云最新包下载地址： [https://api-dev.piaozone.com/invoice-client/imc/ismc.zip](https://api-dev.piaozone.com/invoice-client/imc/ismc.zip) 

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639125475380-a7c82f8b-c954-4c6a-a679-6db8442d8934.png?x-oss-process=image%2Fformat%2Cwebp)

## mservice容器新增环境变量
容器部署方式：

mservice容器环境变量 BIZLIBS下，新增 ismc.xml

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639126021421-86e10506-1e48-4749-94a9-8cf1ce989617.png?x-oss-process=image%2Fformat%2Cwebp)



单机版虚拟机部署 mservice：

在mservice/bin目录下，编辑 setappenv.sh

![](https://cdn.nlark.com/yuque/0/2022/png/22572071/1651044860666-474e0011-328c-4c14-a880-78983979aaac.png?x-oss-process=image%2Fformat%2Cwebp)

BIZLIBS最后面添加 ismc.xml

![](https://cdn.nlark.com/yuque/0/2022/png/22572071/1651044809084-94bb795d-b213-4022-bffe-35d7b364aae0.png?x-oss-process=image%2Fformat%2Cwebp)

最后重启mservice容器或虚拟机

# domain模式部署
domain模式已经自带分库标识和数据中心，所以只需执行后两步就行，环境变量有所不同。

## MC升级税控系统云私包
直接在MC上传升级包zip升级，即可

税控系统云最新包下载地址： [https://api-dev.piaozone.com/invoice-client/imc/ismc.zip](https://api-dev.piaozone.com/invoice-client/imc/ismc.zip) 

![](https://cdn.nlark.com/yuque/0/2021/png/22572071/1639125475380-a7c82f8b-c954-4c6a-a679-6db8442d8934.png?x-oss-process=image%2Fformat%2Cwebp)

## 新增lib文件
在nginx服务器（应用仓库）上新增一个lib文件，文件名：ismc.lib

存放目录：/var/appstatic/appstore/cosmic/

imsc.lib文件内容：

```shell
<root>
 <libs>
  <lib>biz/ismc-dim</lib>
  <lib>biz/ismc-iim</lib>
  <lib>biz/3std-ismc</lib>
 </libs>
 <appIds>dim,iim</appIds>
</root>
```

## 新增环境变量
在mservice容器中新增环境变量：

-name: libs

  value: ismc.lib

![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1763516436606-f82cb0ab-804d-4bad-b3e1-95d37bbedb27.png)



<font style="background-color:#FBDE28;">最后重启容器。</font>



