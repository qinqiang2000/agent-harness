| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **7.0以上** | **公开** | **创建** | **2025-11-13** | **支三垒** |


# 扫码开票异构对接说明
本文档旨在方便各异构的系统与金蝶发票云系统功能结合，使对接上游系统可以快速、高效的完成开票扫码异构对接，以适应该税改政策，完成全电发票的开具。如有异议请予指正。

# 推单星瀚生成二维码链接模式
**<font style="background-color:#FBDE28;">开票场景：</font>**

+ 调用方通过上传发票销售单接口上传销售单信息到发票云。
+ 发票云返回二维码链接给接口调用方。
+ 调用方将二维码链接给到用户。
+ 用户扫码或者点击链接进入到发票云的开票页面。
+ 用户填写购方信息并提交开票。
+ 发票云完成开票之后将发票的PDF链接发送给用户(邮件、短信)，并且通过回推接口将开票成功信息。
+ 回推给调用方客户系统。

**<font style="background-color:#FBDE28;">适用范围：</font>**

+ 支持企业上传销售订单，由发票云存储后，返回开票链接，企业端可生成二维码，消费者扫码开票
+ 支持开票类型：数电票（普票）、数电票（专票）、专用发票、普通发票、卷式发票、电子发票、电子专票 (税务 ukey才能开具)
+ 所有开票数据支持反写客户ERP 系统

## 业务流程图
![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764142756574-4d75215f-e46c-413e-b062-e6d55c161d61.png)

## 流程说明
| **编号** | **步骤** | **前置条件** | **操作人** | **工作说明** | **输出** | **系统** |
| :---: | :---: | :---: | --- | --- | :---: | :---: |
| 1 | 发起开票申请 | 应收系统存在业务单据 | 业务部门/应收 | 应收业务人员在异构系统里进行业务单据的处理，异构系统可支持应收业务人员对业务单据拆分、合并的操作，待其业务人员确认好本次需开票的数据后，最终形成待开票申请单据（将开票单据下推） | 开票申请单 | 异构系统 |
| 2 | 开票申请单推送 | 发起开票申请 | 系统 | 异构系统的开票申请单数据通过金蝶发票云的开票申请单上传接口进行同步数据，把数据传给金蝶发票云进行发票开具处理。<br/> | 开票申请单 | 金蝶 |
| 3 | 返回url | 发票云接收请求 | 系统 | 发票云返回发票url链接 | 接口反馈 | c端客户 |
| 4 | 用户扫码 | 打开链接 | 系统 | 金蝶返回发票url链接 | 用户扫码 | H5小程序 |
| 5 | 提交开票 | 购方信息 | 系统 | 提交开票 | 提交开票 | H5小程序 |
| 6 | 发票开具 | 开票申请单推送成功 | 系统 | 金蝶发票云系统对开票申请单信息补充完成后，并根据此单据里的自动开票标记，进行发票的自动开具；调用此税号下的对应税盘或乐企平台或省电子税局，进行发票的开具。 | 发票 | 税控/数电 |
| 7 | 发票信息返回 | 发票开具 | 系统 | 返回开票信息到异构系统：包括开票状态、开票时间、开票金额、发票号码、发票代码、发票影像url。 | 发票 | 金蝶 |
| 8 | 撤回单据 | 单据未开票 | 系统 | 调用单据撤回接口撤销推送的单据 | 开票申请单 | 异构系统 |


## 接口执行顺序
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920692937-89707e06-fe61-4c9d-8bb7-8a641ccaf427.png)

### 获取接口授权
+ 接口名字：1.01.获取app_token
+ 接口地址：[https://open.piaozone.com/api-145421044](https://open.piaozone.com/api-145421044)



+ 接口名字：1.02获取access_token
+ 接口地址：[https://open.piaozone.com/api-145421045](https://open.piaozone.com/api-145421045)

```json
"appId": "xxx",
"appSecuret": "xxxx",
"accountId": "xxx"
```

**<font style="color:#117CEE;">8.0路径</font>**<font style="color:#117CEE;">：【开放服务云】→【OpenApi】→【安全策略】→【第三方应用】  </font>

首次对接可根据对接系统不同创建不同的应用id

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920693163-ed677e7e-ef43-4f44-a834-2ade4955cd80.png)

Appid与appSecuret为个性化设置

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920693397-13a721ab-60d7-4dbc-8eed-8c3fcba5a46c.png)

点击获取获取Token示例

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920693614-b903914f-5d16-4372-bc04-1183d04798ef.png)

只需替换appSecret与apptoken即可调通获取当前登录系统用户的授权接口

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920693887-596629ef-3062-437c-94a5-f9cc2918b7cd.png)

**<font style="background-color:#FBDE28;">常见异常</font>**

+ 数据中心accountId参数不对

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920694056-c14b28b1-ecfe-4b4d-98da-6eca49c0dfa1.png)

+ appid/appsecuret参数不对

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920694304-b1a53d57-dd28-4771-9798-27d3d42abaf2.png)

### 调用上传销售单获取二维码链接接口
+ 接口名字：3.2.01上传销售单获取二维码链接
+ 接口地址：[https://open.piaozone.com/api-146003738](https://open.piaozone.com/api-146003738)

推送订单生成二维码链接

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920694493-2d9b3987-620c-48d3-94b1-21a393332257.png)

<font style="color:#117CEE;">系统推送订单记录：发票云->开票管理->单据开票->开票申请单</font>

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920694770-e313c825-069b-49e1-a61d-bdc8074c392b.png)

<font style="color:#117CEE;">开出后的发票->销项全票池</font>

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920695036-e796fdfc-e6b2-41ca-a95d-5fec4f41407a.png)

### 调用回调接口-按单回调
+ 接口名字：5.1.04回调接口-按单回调
+ 接口地址：[https://open.piaozone.com/api-146003722](https://open.piaozone.com/api-146003722)

<font style="color:#117CEE;">配置回调接口路径：</font><font style="color:#117CEE;">发票云-系统管理-业务系统列表</font>

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920695352-d86c6120-83c0-4191-92c5-ebc2712dda6d.png)

接收回调

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920695656-f568e774-1228-42aa-be7f-78bf7c147379.png)

# 业务系统组装二维码链接模式
**<font style="background-color:#FBDE28;">开票场景:</font>**

+ 调用方根据业务生成二维码规则将销售单转换为二维码链接。
+ 调用方将二维码链接给到用户。
+ 用户扫码或者点击链接进入到发票云的开票页面。
+ 用户填写购方信息并提交开票。
+ 发票云接受到用户提交的开票请求后去查询调用方订单（查询接口由调用方提供）并开票。
+ 发票云完成开票之后将发票的PDF链接发送给用户(邮件、短信)，并且通过回推接口将开票成功信息。
+ 回推给调用方客户系统。

**<font style="background-color:#FBDE28;">适用范围：</font>**

+ 支持企业根据规则将销售单生成开票链接，消费者扫码开票，由发票云查询订单，完成开票。
+ 支持开票类型：数电票（普票）、数电票（专票）、专用发票、普通发票、卷式发票、电子发票、电子专票 (税务 ukey才能开具)
+ 所有开票数据支持反写客户ERP 系统

## 业务流程图
![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764143053396-451aadfd-1b3d-4df4-bb9d-d44e61ce597c.png)

## 流程说明
| **编号** | **步骤** | **前置条件** | **操作人** | **工作说明** | **输出** | **系统** |
| :---: | :---: | :---: | --- | --- | --- | --- |
| 1 | 业务单据 | 应收系统存在业务单据 | 业务部门/应收 | 应收业务人员在异构系统里进行业务单据的处理，异构系统可支持应收业务人员对业务单据拆分、合并的操作，待其业务人员确认好本次需开票的数据后，最终形成待开票申请单据（将开票单据下推） | 开票申请单 | 异构 |
| 2 | 开票申请单推送 | 发起开票申请 | 系统 | 异构系统的开票申请单数据通过金蝶发票云的二维码转化规则，输出开票链接url并打印在消费小票上供顾客进行扫码开票。 | 消费小票 | 异构 |
| 3 | 用户扫码 | 打开链接 | C端用户 | 顾客扫码打开发票云小程序进行填写购方抬头与收票信息 | 用户扫码 | H5小程序 |
| 4 | 提交开票 | 购方信息 | C端用户 | 提交开票 | 提交开票 | H5小程序 |
| 5 | 接收购方开票信息 | c端用户提交开票 | C端用户 | 根据用户提交的单据号去查询异构系统的订单 | 查询订单请求 | 金蝶发票云 |
| 6 | 查询异构订单 | 业务单据号 | 系统 | 返回业务单据信息，发票行商品信息 | 业务单据信息 | 金蝶发票云 |
| 7 | 发票信息返回 | 发票开具 | 系统 | 返回开票信息到异构系统：包括开票状态、开票时间、开票金额、发票号码、发票代码、发票影像url。 | 发票 | 金蝶发票云 |


## 接口执行顺序
![](https://cdn.nlark.com/yuque/0/2025/png/21778712/1764571971270-246eb811-28c4-4c2e-8fd4-6aabefceeec7.png)

### 获取接口授权
+ 接口名字：1.01.获取app_token
+ 接口地址：[https://open.piaozone.com/api-145421044](https://open.piaozone.com/api-145421044)



+ 接口名字：1.02获取access_token
+ 接口地址：[https://open.piaozone.com/api-145421045](https://open.piaozone.com/api-145421045)

### 调用业务系统组装二维码链接格式
+ 接口名字：3.1.01业务系统组装二维码链接格式
+ 接口地址：[https://open.piaozone.com/api-146003735](https://open.piaozone.com/api-146003735)

### 调用查询订单接口(由客户提供)
+ 接口名字：3.1.02查询订单接口(由客户提供)
+ 接口地址：[https://open.piaozone.com/api-146003736](https://open.piaozone.com/api-146003736)

### 扫码提交购方抬头规则
+ 接口名字：3.1.03 扫码提交购方抬头规则
+ 接口地址：[https://open.piaozone.com/api-146003737](https://open.piaozone.com/api-146003737)

### 调用回调接口-按单回调
+ 接口名字：5.1.04回调接口-按单回调
+ 接口地址：[https://open.piaozone.com/api-146003722](https://open.piaozone.com/api-146003722)

## 接口请求示例（postman）
[扫码开票.docx](https://jdpiaozone.yuque.com/attachments/yuque/0/2025/docx/39256605/1764143194799-5d9058a2-a6cb-4bbd-8357-f5fc17823058.docx)

# 实现效果
以推单星瀚生成二维码链接为例

1. 推单后收到链接：[https://wxaurl.cn/qo4Xb00pPOd](https://wxaurl.cn/qo4Xb00pPOd)
2. 微信扫码
3. 补充发票抬头信息
4. 邮件短信接收发票

![](https://cdn.nlark.com/yuque/0/2025/jpeg/22437992/1736920696650-a0ad086e-8264-4bdd-8ea4-0c978985e8e8.jpeg)![](https://cdn.nlark.com/yuque/0/2025/jpeg/22437992/1736920696834-6f2bef69-f22a-4155-bec6-02cbbed845f7.jpeg)

提交开票



![](https://cdn.nlark.com/yuque/0/2025/jpeg/22437992/1736920697012-4fb2ac4c-02d1-4f95-bc33-038f72463733.jpeg)





















