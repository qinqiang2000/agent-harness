## 操作手册更新版本记录
| 文档版本 | 文档更新日期 | 对应产品版本号/功能更新日期 | 说明 | 更新人 |
| --- | --- | --- | --- | --- |
| V1.0 | 2025.11.18 |  | 初稿发布 |  |
|  |  |  |  |  |


## 开票请求单模板操作路径
【发票云】-【开票管理】-【海外发票】-【系统设置】-【开票请求单模板】

## 开票请求单模板功能设计理念概述
### 功能定位
“开票请求单模板”用于为海外发票业务配置**开票请求单的业务场景与动态表单模板**，包括：

+ 在不同国家/地区、发票类型等条件下，将开票请求自动匹配到对应的业务场景；
+ 为每个场景关联一套或多套请求单模板，并配置表单的字段结构与校验规则。

典型使用角色包括：系统管理员、实施顾问、税务/财务管理员（如 AP Accountant、Tax Specialist 等）。

### 设计理念与使用价值
+ **场景化控制开票请求**：通过“场景编码 + JEXL条件 + 优先级”，实现按国家/地区、发票类型等条件对开票请求进行智能分流，避免手工选择错误模板。
+ **集中维护模板：**在同一界面维护所有开票请求场景及其关联模板，方便实施与运维统一管理。
+ **可视化动态表单配置：**通过「模板动态表单」可视化调整 Section、Group、字段，减少二开，支持按业务要求灵活配置表单结构。
+ **字段级校验与多语言支持：**支持为字段设置是否必填、是否只读、数据类型、正则校验及错误提示，并区分中文/English 标签，适配全球化场景。
+ **适配各国差异又不绑定特定税法：**通过灵活字段和条件配置，支撑根据当地法规配置请求单字段与逻辑。

## 开票请求单模板功能详解
### 开票请求单模板关键字段说明
#### 场景管理
| **字段名称** | **业务含义** | **字段规则说明** | **其他说明** |
| --- | --- | --- | --- |
| <font style="color:#000000;">场景编码</font> | <font style="color:#000000;">场景的唯一编码</font> | <font style="color:#000000;">新增场景时由用户填写。显示每条场景的系统编码。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">场景名称</font> | <font style="color:#000000;">场景的名称</font> | <font style="color:#000000;">用于向业务用户展示该开票场景的业务含义，如“欧盟发票”“荷兰商业发票”等。建议与实际业务场景保持一致。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">英文名称</font> | <font style="color:#000000;">场景的英文名称</font> | <font style="color:#000000;">用于多语言环境中展示的英文名称，如 “EU Invoice”。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">JEXL条件</font> | <font style="color:#000000;">场景生效条件</font> | <font style="color:#000000;">使用 JEXL 表达式书写的匹配条件，例如根据 country、invoiceType 等字段判断是否命中该场景。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">优先级</font> | <font style="color:#000000;">场景匹配优先级</font> | <font style="color:#000000;">数值越大代表优先匹配顺序。当多个场景同时满足 JEXL 条件时按优先级决定选用哪个场景。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">状态</font> | <font style="color:#000000;">场景启用状态</font> | <font style="color:#000000;">含：启用、停用、草稿。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">关联模板</font> | <font style="color:#000000;">选择与场景绑定的开票请求单模板</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">关联模板数</font> | <font style="color:#000000;">与场景绑定的模板数量</font> | <font style="color:#000000;">显示当前场景下已关联的模板数量（如 1、2）。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">描述</font> | <font style="color:#000000;">场景说明</font> | <font style="color:#000000;">记录该场景适用的业务背景、特殊说明等。</font> | <font style="color:#000000;">便于后期维护与交接。</font> |


#### 模板动态表单
| **字段名称** | **业务含义** | **字段规则说明** | **其他说明** |
| --- | --- | --- | --- |
| <font style="color:#000000;">基础信息</font> | <font style="color:#000000;">描述一张开票请求单的基础属性、归属组织与环境信息。主要决定请求单在系统中的唯一性、开具信息、归属以及与上游业务单据的关联关系。</font> | <font style="color:#000000;"> 例如：</font><br/><font style="color:#000000;">「基础信息」：单据编号、单据日期、数据来源、创建人、国家/地区、组织；</font><br/><font style="color:#000000;">「开具信息」：业务场景、文件标识、开具日期、发票类型、发票币种、付款日期、计税币种、计算汇率、备注等；</font><br/><font style="color:#000000;">「关联信息」：关联订单号等。  </font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">交易方信息</font> | <font style="color:#000000;">维护开票请求涉及的各类主体信息，包括购方、销方以及（如有）税务代表等，是后续生成发票抬头信息的主要来源。用于支撑跨国交易场景下的买方/卖方信息填报以及税务代理人的记录。</font> | <font style="color:#000000;">例如：</font><br/><font style="color:#000000;">「购方信息」：公司名称、税务编号、地址、国家、联系人姓名、电话、邮箱、收件邮箱地址等；</font><br/><font style="color:#000000;">「销方信息」：公司名称、税务编号、地址、国家、联系人信息等；</font><br/><font style="color:#000000;">「税务代表」：税务代理名称、税务标识、邮寄地址、国家等。</font> |  |
| <font style="color:#000000;">商品详情</font> | <font style="color:#000000;">记录本次开票请求对应的商品或服务明细，是后续计算金额、税额的基础数据来源。</font> | <font style="color:#000000;">例如：序号、名称、开票数量、计量单位代码、单价金额、税码、税率、明细行扩展金额（不含税金额）等。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">金额信息</font> | <font style="color:#000000;">汇总与展示本次开票请求的折扣/手收费、税额明细以及总价信息，便于核对开票金额与税额是否正确。通常由系统根据商品明细和配置规则自动计算。</font> | <font style="color:#000000;">例如：</font><br/><font style="color:#000000;">「折扣/收费」：折扣比例、金额、税率百分比、免税原因说明等；</font><br/><font style="color:#000000;">「税额信息」：总税额、税额明细-各税码对应的不含税金额、税额、税率等；</font><br/><font style="color:#000000;">「计总信息」：不含税总金额、含税总金额、折扣总金额、税额总金额等汇总字段。</font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">附加信息</font> | <font style="color:#000000;">记录与支付条款、交付、支付方式及发运相关的补充信息，用于满足一些国家/业务对发票附加字段的要求。</font> | <font style="color:#000000;">例如：</font><br/><font style="color:#000000;">「Paymentterm」：付款条款/付款条件说明；</font><br/><font style="color:#000000;">「Delivery」：实际交付日期、交付地点、交付地点国家等；</font><br/><font style="color:#000000;">「Payment」：支付方式或代码名称、收款账户名称、收款账号、银行机构 ID、银行机构名称等；</font><br/><font style="color:#000000;">「Shipment」：发货地址、国家、Shipment Id 等。</font> | <font style="color:#000000;"></font> |




### 开票请求单模板按钮说明
#### 场景管理
| **按钮名称*** | **功能描述*** | **使用条件** | **其他说明** |
| --- | --- | --- | --- |
| <font style="color:#000000;">新增场景</font> | <font style="color:#000000;">打开“新增场景”弹窗，新建一条业务场景。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">编辑</font> | <font style="color:#000000;">打开“编辑场景”弹窗，载入当前行场景信息以便修改。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">删除</font> | <font style="color:#000000;">删除当前行场景。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |


#### 模板动态表单
| **按钮名称*** | **功能描述*** | **使用条件** | **其他说明** |
| --- | --- | --- | --- |
| <font style="color:#000000;">查询</font> | <font style="color:#000000;">根据上方“请选择场景”“请选择模板”的选择，加载对应模板的动态表单配置。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |
| <font style="color:#000000;">+ 添加Section</font> | <font style="color:#000000;">在当前模板下新增一个 Section。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;">新增的 Section 会出现在左侧导航列表中。</font> |
| <font style="color:#000000;">保存</font> | <font style="color:#000000;">将当前模板的动态表单配置保存到系统。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;">保存将覆盖当前模板配置。</font> |
| <font style="color:#000000;">另存为</font> | <font style="color:#000000;">将当前配置另存为新模板。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;">便于在现有模板基础上快速复制。</font> |
| <font style="color:#000000;">添加Group</font> | <font style="color:#000000;">在当前 Section 中新增字段组。</font> |  |  |
| <font style="color:#000000;">添加字段</font> | <font style="color:#000000;">在当前 Group 中新增一个字段。</font> | <font style="color:#000000;"></font> | <font style="color:#000000;"></font> |


### 开票请求单模板主要操作说明
#### 新增开票请求场景并关联模板
**操作目标**：为某类业务（如特定国家/地区 + 发票类型组合）新增一条开票请求场景，并关联对应的请求单模板。

**操作步骤**

1. 点击页面上方搜索框右侧的 **「新增场景」**。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449051640-3f5adce7-23c8-4838-a3fb-1ee0d2aa8e69.png)

2. 在弹出的 **「编辑场景」** 弹窗中填写：
    1. 在 **「场景编码」** 中输入唯一编码，例如 `SCENARIO_DE`。
    2. 在 **「场景名称」** 中输入中文名称，如“欧盟发票”。
    3. 在 **「英文名称」** 中输入英文名称，如“EU Invoice”。
    4. 在 **「描述」** 中补充该场景的适用范围（可选）。
    5. 在 **「JEXL条件」** 中填写匹配条件表达式，例如根据 `country` 与 `invoiceType` 字段判断是否命中该场景。
    6. 在 **「优先级」** 中输入数字，用于控制匹配顺序。
    7. 在 **「状态」** 中选择“启用”，使该场景生效。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449094636-716b8b9d-37ca-4bff-9a2f-84fbda115698.png)

3. 在 **「关联模板」** 区域：
    1. 在 **「选择要添加的模板」** 输入框中选择需要绑定的模板。
    2. 若需要调整模板顺序，在相应行的数字框中修改顺序值。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449117726-bc467d6c-e2e5-407c-a2d0-9bec7bda56b2.png)

4. 检查信息无误后，点击弹窗右下角 **「确认」**，保存场景配置。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449127652-33bccaeb-bd98-4c93-baee-31345186e84f.png)

5. 返回列表确认新场景已出现在「场景管理」列表中，状态为“启用”。

**结果说明**：

+ 新增的场景会参与后续开票请求单的匹配逻辑。

#### 编辑或删除已有开票请求场景
**操作目标**：调整已有场景的条件、优先级、状态或关联模板，或删除不再使用的场景。

**编辑场景**

1. 在「场景管理」列表中，通过 **「搜索场景编码或名称」** 定位目标场景。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449176603-a750c74a-9ab3-4b63-aabf-a7aed86d8c54.png)

2. 在目标行的 **「编辑」** 按钮上点击。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449167052-a5b4a6fb-3807-43a2-9706-39900dab07b6.png)

3. 在「编辑场景」弹窗中，按需修改：
    - JEXL 条件（如增加新的国家/地区或发票类型）；
    - 优先级；
    - 状态（启用/停用）；
    - 关联模板列表（增加、删除或调整顺序）。
4. 修改完成后点击 **「确认」** 保存。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449203755-c9b450d8-eeca-49d6-8838-83ba9a4ab97c.png)

**删除场景**

1. 在列表中定位目标场景。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449176603-a750c74a-9ab3-4b63-aabf-a7aed86d8c54.png?x-oss-process=image%2Fformat%2Cwebp)

2. 点击该行的 **「删除」**。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449236723-80b2a3f0-50f7-4c00-940e-da88dace56db.png)

3. 在弹出的确认提示（<font style="color:rgba(0, 0, 0, 0.88);">删除场景将同时删除其关联的模板关系，是否继续？</font>）中确认删除。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449256507-de1d90b3-062a-493d-a560-cf3ab02c84c8.png)

**结果说明**：

+ 被停用或删除的场景将不再参与开票请求匹配。

#### 配置开票请求单的模板动态表单
**操作目标**：为某个场景下的模板配置或调整开票请求单的字段结构（Section / Group / 字段）。

**操作步骤**

1. 进入模块后，切换到页签 **「模板动态表单」**。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449315359-671786f2-8544-4cda-9918-ab97162cb0f0.png)

2. 在顶部依次选择：
    1. 在 **「请选择场景」** 下拉框中选择目标场景；
    2. 在 **「请选择模板」** 下拉框中选择该场景下的具体模板。
3. 点击 **「查询」** 按钮，加载当前模板的动态表单配置。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449336143-be4db882-ec47-4082-9667-348eb6055a95.png)

4. 在左侧 **Section 导航** 中，点击需要配置的 Section（如“金额信息”）。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449350375-39087740-0c7d-4c3a-aa6d-c8461b722d7a.png)

5. 在右侧：
    1. 如需新增字段组，点击当前 Section 区域右上方的 **「添加Group」**并进行编辑；
    2. 如需调整 Group 顺序，使用 Group 标题右侧的 **下移** 图标。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449386130-d9c2da05-ba13-4fbc-9c0d-161747fddf82.png)

6. 在某个 Group 内：
    1. 如需新增字段，点击 **「添加字段」**并进行编辑；
    2. 如需调整字段顺序，使用字段标题右侧的 **下移** 图标。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449627561-8ea669de-3796-42a8-8f5d-5df4edcaa36b.png)

7. 完成所有 Section / Group / 字段结构调整后，点击页面右上方 **「保存」**。
8. 如希望在现有模板基础上生成新模板，可点击 **「另存为」**。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449645044-652eb036-8bc2-4945-832c-323ae08fae64.png)

**结果说明**：

+ 保存成功后，后续新建开票请求单时，将按配置展示字段结构。

#### 设置字段属性与校验规则（以“单据编号”为例）
**操作目标**：定义特定字段（如“单据编号”）的必填性、读写属性、数据类型及校验规则。

**操作步骤**

1. 在「模板动态表单」中，按3.3.3选择场景与模板，并加载表单。
2. 在右侧对应 Group（如“基础信息”）中，找到字段（如“单据编号”）。
3. 点击 **「设置」** 进入 **「字段设置」** 弹窗。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763449773585-67c9a0db-6052-4750-a9d6-83f9318e2172.png)

4. 在弹窗顶部根据业务需求设置：
    - 打开 **「是否必填」**，要求用户必须填写单据编号；
    - 根据实际需要选择 **「是否只读」**（只读字段将显示为纯文本，不显示输入框） 或 **「是否禁用」**（禁用字段显示为灰色输入框，不允许编辑）；
    - 对金额字段可勾选 **「触发金额计算」**（当该字段值变化时，是否触发金额的重新计算）。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450077926-f012b4e0-6abf-4dca-bde3-ba170b195316.png)

5. 在 **「数据类型」** 下拉框中选择合适类型（如“字符串 (String)”），配置字段<font style="color:rgba(0, 0, 0, 0.88);">最</font>小出现次数（字段至少出现的次数）、最大出现次数（字段最多可以重复的次数，-1 表示无限制）。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450212307-bc442fd7-1fde-4988-8e27-42a52b21f1e8.png)

6. 如需限制编号格式，在“校验规则（可选）”区域：
    1. 在 **「正则表达式」** 中用于验证字段值格式的正则表达式；
    2. 在 **「最小长度」**、**「最大长度」** 中设置可容纳字符数范围。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450262548-cc1e120e-ab2d-4255-a2d1-d33a18eafbf3.png)

7. 在下方 **「错误提示信息」** 区域：
    1. 在 **「中文」** 页签中输入校验失败时的中文提示；
    2. 切换到 **「English」** 页签，输入对应英文提示（如需多语言）。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450612720-ad56e5b8-f3a7-4a17-b065-fca5900755e8.png)

8. 检查配置无误后，点击 **「保存」**，返回模板动态表单页面。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450627810-dfb02664-904b-4c8f-a872-484b6f7c800b.png)

9. 最终在模板动态表单页面点击 **「保存」** 整体模板配置。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1763450639924-30ccb00e-38fe-4d9c-9218-5389ade87175.png)

**结果说明**：

+ 后续用户在填写开票请求单时，将根据配置对字段进行校验并显示对应错误提示。

