文档适用范围：星空旗舰版开票

## 操作手册更新版本记录
| 文档版本 | 文档更新日期 | 对应产品版本号/功能更新日期 | 说明 | 更新人 |
| --- | --- | --- | --- | --- |
| V1.0 | 2025.11.05 |  | 初稿发布 |  |




## 开票其他信息设置操作路径及所属模块编码
操作路径：【发票服务】→【基础资料】→【开票参数设置】→【开票其它信息设置】→【开票其他信息设置】

所属模块编码：F17025

所属模块名称：开票参数设置

## 开票其他信息设置功能设计理念概述
进行开票相关配置，大多数为开票引擎类配置。包含：<font style="color:rgb(0, 0, 0);">开票项业务规则、批量开票规则、购方抬头规则、</font>短信推送设置、发票文件下载名称设置等。

## 开票其他信息设置功能详解
### 开票其他信息设置关键字段说明
业务规则详见4.3节

| **序号*** | **<font style="color:rgb(26, 26, 26);">字段名称*</font>** | **<font style="color:rgb(26, 26, 26);">业务含义*</font>** | **<font style="color:rgb(26, 26, 26);">赋值规则*</font>** | **<font style="color:rgb(26, 26, 26);">控制规则*</font>** | **<font style="color:rgb(26, 26, 26);">其他属性说明</font>** |
| --- | --- | --- | --- | --- | --- |
| 1 |  |  |  |  |  |
| 2 |  |  |  |  |  |


### 开票其他信息设置按钮说明
业务规则详见4.3节

| **序号*** | **<font style="color:rgb(26, 26, 26);">按钮名称*</font>** | **<font style="color:rgb(26, 26, 26);">功能描述*</font>** | **<font style="color:rgb(26, 26, 26);">使用条件</font>** | **<font style="color:rgb(26, 26, 26);">其他说明</font>** |
| --- | --- | --- | --- | --- |
| 1 |  |  |  |  |
| 2 |  |  |  |  |


### 开票其他信息设置主要操作说明
##### 基础设置
![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748596787825-aedf9ebf-6e42-4bc6-b798-d30eb79b419d.png)

###### 开票项业务规则设置
点击”编辑“，即可调整详情。

开票项业务规则设置包含映射、补全、以及保存企业开票项。同时<font style="color:rgb(0, 0, 0);">开启补全和映射时，只执行映射。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597315863-50b9b5f3-95de-4988-9996-ab844d339063.png)

<font style="color:rgb(0, 0, 0);">映射和补全时，按优先级升序、管控策略（私有＞管控范围＞全局共享）查询开票项。</font>

<font style="color:rgb(0, 0, 0);">Excel导入、接口推送开票申请单时，映射和补全均不支持开票项管理下方的匹配项面板。</font>

![](https://cdn.nlark.com/yuque/0/2024/png/38481329/1721984129279-4b757178-ca7e-401b-afb6-c9d6d186b000.png)

**开票项目自动补全**：上游业务系统有部分开票项数据，需要在下游配置部分数据，取下游数据补全上游缺失的数据时开启。<font style="color:#000000;">补全规格型号、单位、税收分类编码等字段。</font>当开票项映射参数开启时，本参数开启不生效。<font style="color:rgb(0, 0, 0);">如果只开启补全，</font><font style="color:#000000;">未开启</font><font style="color:rgb(0, 0, 0);">开票项映射，则此参数生效</font><font style="color:#000000;">，补全逻辑（接口推开票申请单、EXCEL导入开票申请单处理逻辑）如下：</font>

<font style="color:rgb(0, 0, 0);">①优先按商品编码补全，商品编码为空，则按照商品名称补全。</font>

<font style="color:rgb(0, 0, 0);">旧版：当相同名称、不同规格型号及不同商品编码的情况，按照管控策略+优先级获取开票项进行补全。（存在同商品名称多编码的情况，建议传输商品编码，补全最准确。）</font>

<font style="color:rgb(0, 0, 0);">新版：按照商品编码或商品名称补全时，如匹配到多条开票项：若已传输税率，使用商品编码或商品名称+税率进行匹配，如仍存在多个开票项，按照优先级获取开票项；若未传输税率，按照优先级获取开票项。</font>

<font style="color:rgb(0, 0, 0);">②如果根据商品编码或者商品名称没有找到对应的开票项直接不进行补全。</font>

<font style="color:rgb(0, 0, 0);">③补全时若传入了商品名称、商品编码、税率、税收分类编码、规格型号、单位，则以传入的为准，若传入字段值为空时，则使用配置的开票项信息补全。</font>

<font style="color:black;background-color:#FFFFFF;">④如果关闭补全优惠政策配置，不匹配优惠政策。如果开启补全优惠政策，补全逻辑如下：</font>

+ <font style="color:black;"> </font><font style="color:black;background-color:#FFFFFF;">原数据的是否享受优惠政策为空，按开票项补全是否享受优惠政策和优惠政策内容。</font>
+ <font style="color:black;"> </font><font style="color:black;background-color:#FFFFFF;">原数据为享受优惠政策，但优惠政策内容为空时，按开票项补全优惠政策内容。</font>
+ <font style="color:black;background-color:#FFFFFF;"> 原数据为享受优惠政策，且优惠政策内容不为空，不补全。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597349830-38fc16b9-3a86-498d-9d8f-ede321fbdc78.png)

**<font style="color:rgb(0, 0, 0);">保存企业开票项</font>**<font style="color:rgb(0, 0, 0);">：开启此配置，</font>开票申请单推开票成功后，若此条明细未在开票项管理配置过，自动将此条明细保存添加为一条新的开票项。

![](https://cdn.nlark.com/yuque/0/2024/png/38481329/1722239615489-54a2f26f-a84e-4f3e-af7c-60493071a10f.png)

**开票项映射**：<font style="color:#000000;">勾选指定入口进入的数据，当从这个入口进入的数据，传入A开票项，开票时会开成B开票项。</font>

**--开票项映射（开票申请单导入）**，逻辑如下：

<font style="color:rgb(0, 0, 0);">① 如果只开启映射，先判断传入的商品名称、商品编码、税率、税收分类编码都不为空时，直接不进行映射。</font>

<font style="color:rgb(0, 0, 0);">② 如果不满足上面的条件（四个字段不都为空），进行开票项的映射，优先以开票项的商品编码映射，商品编码为空时，以商品名称映射。</font>

<font style="color:rgb(0, 0, 0);">按照商品编码或商品名称映射时，如匹配到多条开票项：若已传输税率，使用商品编码或商品名称+税率进行匹配，如仍存在多个开票项，按照优先级获取开票项；若未传输税率，按照优先级获取开票项。</font>

<font style="color:rgb(0, 0, 0);">③ 如果步骤②没有找到对应的开票项。配置的信息，按照商品＞物料＞物料分类＞费用项目的顺序进行映射，按名称+编码＞编码＞名称的顺序执行匹配，匹配开票项下面配置的信息，找到开票项后进行映射。</font>

<font style="color:rgb(0, 0, 0);">④ 映射时，如果文件填了税率就取填入的税率，否则取开票项的税率（</font><font style="color:rgb(0, 0, 0);">由于涉及开票税额，税率以原数据为准</font><font style="color:rgb(0, 0, 0);">）。商品名称、商品编码、税收分类编码、是否享受优惠政策、优惠政策内容、规格型号、单位以配置的开票项为准。</font>

**<font style="color:rgb(0, 0, 0);">--开票项映射（</font>****开票申请单API新增****<font style="color:rgb(0, 0, 0);">）</font>**<font style="color:rgb(0, 0, 0);">，逻辑如下：</font>

<font style="color:rgb(0, 0, 0);">① 根据开票申请单接口参数pushMatchRules判断应按照物料、物料分类、商品或开票项进行匹配。</font>

<font style="color:rgb(0, 0, 0);">② 按传输的信息进行匹配，如果名称+编码均有值，按名称+编码进行匹配，如果名称有值，只按照商品名称匹配，如果只有编码，按照编码匹配。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597377504-487bd0d4-1e9a-4a6a-8052-eb5842cd1ad2.png)

###### 购方抬头规则设置
点击”编辑“，即可调整详情。

购方抬头规则设置包含映射、补全、以及保存抬头、强制映射。

**导入购方数据补全：**<font style="color:#000000;">此开关开时，购方数据为空时会自动补全，EXCEL导入开票申请单的补全逻辑如下，接口目前暂不支持补全逻辑：</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597407051-33969d23-99d5-47ab-b1c8-a1bcbdea5f97.png)

<font style="color:#000000;">① </font><font style="color:black;background-color:#FFFFFF;">按购方名称补全，可补全购方税号、地址、电话、开户行、账号、交付邮箱、交付手机。</font>发票服务不校验税号、名称是否正确，当前仅按照名称补全，如名称未匹配到，不进行补全。如按名称匹配到，Excel有税号时，以Excel为准，Excel没有，以抬头配置内容为准。

<font style="color:black;background-color:#FFFFFF;">② 地址、电话、开户行、账号、交付邮箱、交付手机不支持匹配条件</font> <font style="color:black;background-color:#FFFFFF;">，仅支持取默认的购方抬头信息。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597516024-ed07ba85-96ff-48cb-a8c6-1d01448ad45f.png)

**<font style="color:rgb(0, 0, 0);">保存抬头数据来源</font>**<font style="color:rgb(0, 0, 0);">：开启此配置，通过这些入口进入的数据，在开票成功后，若此条抬头数据未在开票抬头管理配置过，自动将此条数据保存添加为一条新的开票抬头。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597535980-85b61ded-af03-4773-8e3d-ab55779d021c.png)

**抬头映射：**<font style="color:#000000;">勾选指定入口进入的数据，当从这个入口进入的数据，传入A抬头，开票时会开成B抬头。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1755769713737-0c28a0fe-7cb6-4656-bcad-de201f65b152.png)

**<font style="color:#000000;">--抬头映射（开票申请单导入），</font>**<font style="color:#000000;">同时开启补全和映射时，先执行映射，再执行补全。具体映射逻辑如下：</font>

① 判断是否开启映射。

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1755769958482-b0276231-6e37-46df-bf08-31790342a8af.png)

<font style="color:#000000;">② 如果购方名称、购方税号均未传输，不进行映射；如果信息完整不走映射，是否完整判断条件：</font>

+ <font style="color:#000000;">购方为个人：身份证、名称都有。</font>
+ <font style="color:#000000;">购方为企业：名称、税号、地址电话、银行账号都有。</font>

<font style="color:#000000;">③ 不完整时进行映射，如果购方名称不为空，按照购方名称进行映射，如果购方税号不为空，按购方税号查询；如果两者都不为空，按照购方名称或购方税号映射。无优先级，发票服务不校验名称、税号是否正确。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597578416-b2149723-e607-4832-950d-8118b77e6d1c.png)<font style="color:#000000;">④如果购方名称、税号未映射到，按下方的客户信息进行映射，如果客户税号不为空，按客户税号查询；如果客户名称不为空，按客户名称查询；如果两者都为空，按照客户名称或客户名称映射，找对应的购方信息进行映射。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597600985-074afdea-ff99-46d7-b58f-290e63e1ad12.png)

<font style="color:black;background-color:#FFFFFF;"> ⑤客户信息未匹配到购方抬头时，如果客户类型是个人，且身份证为空，匹配平台客户主数据中，伙伴类型为个人的信息。</font>

<font style="color:black;background-color:#FFFFFF;"> ⑥无论是根据购方还是客户进行匹配，</font><font style="color:#000000;">走下方截图的匹配条件，用于获取开户行账号、地址电话、交付手机、交付邮箱。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597626930-d76e7bf2-95f8-461e-81c9-815f07fb0ef0.png)

**<font style="color:rgb(0, 0, 0);">--抬头映射（</font>****开票申请单API新增****<font style="color:#000000;">、扫码开票）</font>**<font style="color:#000000;">，</font><font style="color:rgba(0, 0, 0, 0.85);">为防止扫码开票时提交的购方信息中的手机号和邮箱被替换为之前维护的购方信息，支持独立配置扫码开票来源的开票申请单是否进行映射。若勾选扫码开票选项，则扫码开票来源的申请单会执行映射；若不勾选该选项，则不执行映射。</font><font style="color:#000000;">具体映射逻辑如下：</font>

①判断是否补全。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597647497-79524a3b-87ed-41d8-872d-fc1f122e1cfa.png)

②当购方为企业/个人，根据购方编码映射，购方编码未找到，按照购方名称或购方税号进行映射，如果购方编码、购方名称、购方税号均未传输，不进行映射；当购方为个人，且名称、身份证均传输，不进行映射；

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597674289-a3a8223f-5306-4da6-af2b-57cb80bb0b15.png)

③如果购方名称、税号未映射到，按下方的客户信息进行映射，如果客户税号不为空，按客户税号查询；如果客户名称不为空，按客户名称查询；如果两者都为空，按照客户名称或客户名称映射，找对应的购方信息进行映射。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597701735-29bd1502-d43e-4027-b4fd-3957649e7cb8.png)

④<font style="color:black;background-color:#FFFFFF;">无论根据购方或客户匹配到，走匹配条件、优先级获取银行账号、地址电话、开户行、账号、交付手机、交付邮箱。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597730084-a06bed87-c58c-4efe-b41b-9ab91ea9773d.png)

**强制映射：**<font style="color:rgb(0, 0, 0);">勾选抬头映射后，将展示强制映射按钮。</font><font style="color:#000000;">  
</font><font style="color:rgb(0, 0, 0);">开启后，接口或Excel导入时，必须找到可映射的抬头数据，未找到数据时，报错：未找到可映射的开票抬头，请查证后再导入开票申请单。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/38481329/1755770786987-f78ced0a-870a-422e-ba0f-a1a171047bd0.png)

###### 设置批量开票规则
**开票失败后继续开票**：在批量开票场景中，当出现一些意外情况如断电，网络不稳，服务异常造成的开票失败，是继续开票还是终止开票。默认不勾选中断开票，勾选则继续开票。 此规则仅针对纸票开具生效。电票开具统一按照继续开票规则处理。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597778000-21214366-ff37-497d-b419-66cb35d41b4c.png)

**开票顺序规则**：在批量开票场景中，可以按照自定义规则处理开票顺序，有以下五种方式：

+ 待开单据编号：默认按照待开单据编号排序开票。
+ 购方名称排序：按照购方名称排序开票。
+ 销售方排序：按照销售方开户行及账号信息排序开票。
+ 开票申请单编号排序：按照开票申请单单据编号顺序开票。
+ 拆分顺序：默认按照待开发票的单据编号排序开票，当单据拆分开票时，按单据被拆分的顺序开票。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597800002-19404e00-1313-42e2-af29-e7d508daba32.png)

**字段超长处理规则：**开票进入系统时，当票面字段超过指定长度时，开票时系统提示或进行自动截断。

包含以下字段：开票项：商品名称，规格型号，计量单位、单价、备注。

![](https://cdn.nlark.com/yuque/0/2025/png/12881570/1736924491788-01d8e996-883f-4171-8086-79f378d59bd2.png)

备注、单价超过税局允许长度时，进入待开进行超长截取、或超长提示。

1、备注：

<font style="color:rgb(0, 0, 0);">（1）数电蓝票：乐企开票最长450位，电子税局RPA开票最长200位，一个汉字、数字、英文、特殊字符算1位。</font>

<font style="color:rgb(0, 0, 0);">（2）数电红票：RPA不允许填写自定义备注，乐企的控制如下：</font>

+ <font style="color:rgb(0, 0, 0);">原蓝票是数电时，自定义长度按385控制，如果超长提示，提示：红票自定义备注（不含原蓝票号码、红字确认单编号）不能超过385个字符，</font>
+ 原蓝票是税控时，自定义长度按378个字符控制  
<font style="color:rgb(0, 0, 0);"></font>

2、单价：单据保存最长按25位控制，处理时根据发票类型、通道控制。

（1）RPA开具数电发票：

+ 开具正数发票：最长16位（带小数点），精度最大13位
+ 开具负数发票：最长25位（带小数点），整数位最长12位，精度最大13位

（2）乐企开具数电发票：

无论正数负数发票，最长25位（带小数点），整数位最长12位，精度最大13位

![](https://cdn.nlark.com/yuque/0/2025/png/12881570/1736924505271-e3cf31e6-3000-49c6-a2f2-2a5219046df4.png)

##### 短信推送设置
开启后使用发票服务短信服务推送短信，关闭则不使用发票服务短信服务。

若使用短信推送，支持对短信推送方式及短信签名进行配置，详见：[短信设置 (yuque.com)](https://jdpiaozone.yuque.com/nbklz3/tadboa/qzptezab4z3ivcsy)  
![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597830191-45572c59-b615-4a1c-8f27-de13017f458e.png)

开启“短信推送服务”后，可以在下方选企业列表中择一个或者多个需要短信推送的企业，还可以在企业列表中新增需要短信推送的企业。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597865989-bec66316-ce92-4072-9d01-0dc120805430.png)

“新增”就是直接点击该按钮，然后在新增行的企业名称栏的右侧，点击形如“放大镜”的按钮即可选择企业到列表中。

##### ![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597887732-4480325d-b700-4f2a-924c-8bf7cdf4a76d.png)  

##### 发票推送设置
此配置是针对开票申请单、单张开票时，是否要填写交付邮箱、手机设置的。

开票申请单在单据保存时进行校验（BOTP下推：若不符合条件，开票申请单点击保存时会进行提示。EXCEL导入：若不符合条件，则异常单据无法导入，剩余符合条件的单据可以导入。）

单张开票在点击开票时进行校验。

发票推送设置支持配置以下两种类型：

+ 邮箱、手机号二选一：邮箱、手机号至少一个必填。
+ 邮箱、手机号非必填：邮箱、手机号均允许不填。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597911546-2ceb1414-fc49-4f58-9edd-417bd368ff84.png)

##### <font style="color:#000000;">发票文件下载名称设置</font>
发票文件下载名称设置：用于自定义配置发票查询列表下载发票文件至本地的文件命名，配置步骤如下：

<font style="color:#000000;">设置分隔符。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597935704-77ba43be-e805-411a-a015-37c62ff93406.png)

设置发票名称字段。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597960968-1b9e5f5b-d877-4b5c-a176-fc9b1d2c0c6b.png)

在可选列表中选择要命名的字段点击箭头所示按钮将字段移至已选列表中。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748597985871-58b38a74-3405-4a54-b780-a611941b5167.png)

在已选列表中选择要参与命名的字段并点击”确认“。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598009047-301dcb23-2530-4461-a098-a61c42c10580.png)

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598031791-3289150b-aa39-4549-92f2-0185c0653d99.png)

##### 设置含税金额拆分规则
<font style="color:#000000;">设置对应的组织不同票种对应的含税金额拆分限额，在【开票管理】-【单据开票】-【开票申请单】，单据处理时，在工作台选“自定义金额拆分”时，超过自定义含税金额，会自动拆分成多张对应设置限额的发票。</font>

<font style="color:#000000;">点击“增行”，在新增的一行里填写各个票种的金额，点击“适用组织”，把对应要设置限额的组织勾选上，“确定”后，点右边的“保存”即可。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598060119-19b706bc-34e7-4618-9dc6-7c78b2e011e9.png)

> <font style="color:#000000;">该配置的处理效果展示：</font>
>
> ![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598094996-bcaa792d-bacd-42f0-81d6-2fa708741ff1.png)    ![](https://cdn.nlark.com/yuque/0/2023/png/34387723/1702878785160-5c728cee-d0e5-4db7-823f-d8bc7198431f.png)   ![](https://cdn.nlark.com/yuque/0/2023/png/34387723/1702878785602-ffc3936a-c2a8-40f0-a698-25f527f3c778.png)
>

点击“含税规则设置”进入到含税规则设置界面。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598172334-1333f890-a3a5-4c61-bcb0-9637b705d671.png)

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598194272-2b4e70d5-725b-4a27-844e-9a982fff445c.png)

<font style="color:#000000;">含税拆分开票仅支持全额开票。含税金额拆分时，商品行拆分规则（由传入的含税标识决定相关设置中的单价是否含税）有两种：按单价拆分、按数量拆分。</font>

**<font style="color:#000000;">①按单价拆分：</font>**

+ <font style="color:#000000;">拆分单价，数量不变；商品行需要拆分时，拆出的商品行数量不变，反算单价，涉及明细行需要拆分时，单行的数量不变；示例：明细A：数量1，单价100，含税金额100，发票限额80。拆分后：明细A1：数量1，单价80，含税金额80明细A2：数量1，单价20，含税金额20开票后，数量按原数量反写开票申请单。</font>
+ <font style="color:#000000;">拆分单价，数量不变；商品行需要拆分时，拆出的商品行数量为固定值X,反算单价，涉及明细行需拆分时，单行的数量获取设置的固定数量，根据拆分出的含税金额，除以数量反算单价。示例：明细B：数量1，单价100，含税金额100，发票限额80，配置拆分数量为2.拆分后：明细B1：数量2，单价40，含税金额80明细B2：数量2，单价10，含税金额20开票后，数量按原数量反写开票申请单。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598216701-b7118425-0a3f-4e27-a811-010639d5b106.png)**②按数量拆分：**

+ 拆分数量、单价不变；按照配置的含税限额进行拆分，顶额开具，单价不变，反算数量。

此种方式还支持设置：

    - 保留小数位设置：可设置范围为0-10位
    - 数量位数处理（共两种）：a：单行商品税额误差超过范围时，以系统计算为准。b：单行商品税额误差超过范围时，若还需强制保留位数，则反算不含税单价。
+ 拆分数量、单价不变；在保证数量、单价为整数的情况下按照配置的含税限额进行拆分，保证发票接近顶额开具。

![](https://cdn.nlark.com/yuque/0/2025/png/56650036/1748598246707-ec7861af-a8df-4393-8e33-58f5703bdd8a.png)

## 开票其他信息设置相关配置说明
1. 短信设置说明文档：[短信设置 (yuque.com)](https://jdpiaozone.yuque.com/nbklz3/tadboa/qzptezab4z3ivcsy)

## 开票其他信息设置相关接口说明【暂无接口】
| 编号 | 接口名称 | 接口用途 | 接口链接 |
| --- | --- | --- | --- |
|  |  |  |  |
|  |  |  |  |


## 
