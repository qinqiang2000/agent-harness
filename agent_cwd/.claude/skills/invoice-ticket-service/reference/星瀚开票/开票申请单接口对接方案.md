| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **7.0以上** | **公开** | **创建** | **2025-11-13** | **支三垒** |


# 开票申请单异构对接说明
本文档旨在方便各异构的系统与金蝶发票云系统功能结合，使对接上游系统可以快速、高效的完成开票申请单异构对接，以适应该税改政策，完成全电发票的开具。如有异议请予指正。

# 开票申请单适用场景
**开票场景：**

+ 调用方通过上传发票销售单接口上传销售单信息到发票云（支持拆分合并，如按限额拆票，等进行自动开票）
+ 发票云返回推单状态。
+ 发票云调用回调方法将单据开票信息返回给调用方（回调方法由调用方提供）
+ 支持根据单据销售单号查询发票

<font style="background-color:#E8F7CF;">注意：开票申请单未进行下推开票的支持主动撤回</font>

**适用范围：**

+ 支持企业上传销售订单，由发票云存储后，根据单据开票
+ 支持开票类型：数电票（普票）、数电票（专票）、专用发票、普通发票、卷式发票、电子发票、电子专票 (税务 ukey才能开具)
+ 所有开票数据支持反写客户ERP 系统

## 业务流程图
![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764123796842-1a3a6679-e22e-486e-89be-cb3eab832c46.png)

## 流程说明
| **编号** | **步骤** | **前置条件** | **操作人** | **工作说明** | **输出** | **系统** |
| :---: | :---: | :---: | --- | --- | :---: | :---: |
| 1 | 发起开票申请 | 应收系统存在业务单据 | 业务部门/应收 | 应收业务人员在异构系统里进行业务单据的处理，异构系统可支持应收业务人员对业务单据拆分、合并的操作，待其业务人员确认好本次需开票的数据后，最终形成待开票申请单据（需确认开票类型及金额，填写完整可靠的开票信息） | 开票申请单 | 异构系统 |
| 2 | 开票申请单推送 | 发起开票申请 | 系统 | 异构系统的开票申请单数据通过金蝶发票云的开票申请单上传接口进行同步数据，把数据传给金蝶发票云进行发票开具处理。<br/> | 开票申请单 | 金蝶 |
| 3 | 发票开具 | 开票申请单推送成功 | 系统 | 金蝶发票云系统对开票申请单信息补充完成后，并根据此单据里的自动开票标记，进行发票的自动开具；调用此税号下的对应税盘或乐企平台或省电子税局，进行发票的开具。 | 发票 | 税控 |
| 4 | 发票信息返回 | 发票开具 | 系统 | 返回开票信息到异构系统：包括开票状态、开票时间、开票金额、发票号码、发票代码、发票影像url。 | 发票 | 异构系统 |
| 5 | 申请单撤回 | 自动开票失败 | 开票人员 | 金蝶支持销方地址、电话、开户修改。<br/>若需要修改其余信息，需要在待开发票列表，点击退回，将数据退回至开票申请单页面，再点击退回至异构系统修改。（保证数据一致性） | 开票申请单 | 金蝶 |
| 6 | 发票查询 | 发票开具成功 | 开票人员 | 企业正常开具的发票集中在销项池的发票查询中，支持查询管理重发等操作。 | 发票 | 金蝶 |


# 接口执行顺序
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920678325-97b2e3a1-6f32-4106-8028-c7c93f0dbad1.png)

## 获取接口授权
1. **接口名字：1.01.获取app_token**
+ 接口地址：[https://open.piaozone.com/api-145421044](https://open.piaozone.com/api-145421044)

```json
"appId": "xxx",
"appSecuret": "xxxx",
"accountId": "xxx"
```

**<font style="color:#117CEE;">8.0路径</font>**<font style="color:#117CEE;">：【开放服务云】→【OpenApi】→【安全策略】→【第三方应用】  </font>

首次对接可根据对接系统不同创建不同的应用id

![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764123926005-d125f176-ad86-4e45-9dd8-0ca543e82174.png)

Appid与appSecuret为个性化设置

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920678718-074ad759-4952-40e1-a01c-d969f631d984.png)

点击获取获取Token示例

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920679008-cdb637f4-d237-444f-931b-d7a8cc1c03a4.png)

只需替换appSecret与apptoken即可调通获取当前登录系统用户的授权接口

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920679273-4326f8c2-4e36-48c6-8c6f-557bb321fca3.png)

**<font style="background-color:#FBDE28;">常见异常</font>**

+ 数据中心accountId参数不对

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920679492-741ed711-2cfc-4dff-afd0-efb2cb7e46db.png)

+ appid/appsecuret参数不对

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920679730-e6ed2241-b72a-4827-b74e-40293a8b821c.png)



2. **接口名字：1.02获取access_token**
+ 接口地址：[https://open.piaozone.com/api-145421045](https://open.piaozone.com/api-145421045)

## 调用开票申请单接口
+ 接口名字：1.1.01 开票申请单生成及开票（支持拆分合并后，再开票）
+ 接口地址：[https://open.piaozone.com/api-146003727](https://open.piaozone.com/api-146003727)



**<font style="background-color:#FBDE28;">常见报错1：</font>**未进行接口授权

解决方式：打开授权

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920679917-7f8b0da1-bb47-4f41-8b19-ee9d437f035b.png)



![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920680196-b8466a11-df7d-463a-9f7a-25da422dc4c4.png)

**<font style="background-color:#FBDE28;">常见报错2：</font>****未进行接口授权**

解决方式：access_token 过期，重新获取授权

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920680505-94852c31-7240-44cb-93ba-dca36df4cee4.png)

**<font style="background-color:#FBDE28;">常见报错3：</font>**价税合计金额不对

解决方案：重新调整传入的价税合计金额重新推单

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920680845-8ab767ce-24a9-4402-8315-477de9960e41.png)

**<font style="background-color:#C1E77E;">推单成功</font>**

<font style="color:#117CEE;">查看路径：发票云-开票管理-单据开票-开票申请单</font>

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920681110-b056b874-b4db-4d3b-86bd-ad8f688aca2c.png)

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920681383-fce4b7e0-f3dd-4f48-8fc4-25db6e77cf37.png)

## 调用开票申请单撤回
<font style="color:#8A8F8D;">注意：开票申请单未进行开票的单据可调用该接口进行撤回开票申请单</font>

+ 接口名字：1.1.02 开票申请单撤回
+ 接口地址：[https://open.piaozone.com/api-146003696](https://open.piaozone.com/api-146003696)

**<font style="background-color:#C1E77E;">撤销成功：</font>**

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920681628-dce06610-04a4-481b-80a4-dfc732e5a47a.png)

根据单据号去开票申请单查询 ：无记录

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920681879-d4ced796-7220-4781-9644-21f3cafa8c18.png)

## 调用开票申请单发票查询接口
+ 接口名字：1.1.03 开票申请单发票查询
+ 接口地址：[https://open.piaozone.com/api-146003729](https://open.piaozone.com/api-146003729)

根据单据号和销方税号获取单据开票后的发票信息

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920682168-88457b64-1c9c-457c-8848-958d0fe401ba.png)

## 调用回调接口-按单回调
+ 接口名字：5.1.03回调接口-按单回调
+ 接口地址：[https://open.piaozone.com/api-146003722](https://open.piaozone.com/api-146003722)

<font style="background-color:#D8DAD9;">注意：开票申请单回调为对接异构系统提供，（并不需要鉴权）在星瀚发票云进行配置，当开票接收到开票请求（或开票完成后触发开票申请单回调接口）</font>

<font style="color:#117CEE;">配置回调接口路径：</font><font style="color:#117CEE;">发票云-系统管理-业务系统列表</font>

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920682530-3963f092-e62c-46cf-b509-70e6c9676569.png)

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920682812-8575d8ad-2952-4ba1-8777-179da65e1150.png)

# 接口请求示例（postman）
## 接口示例
[开票申请单.json](https://jdpiaozone.yuque.com/attachments/yuque/0/2025/json/39256605/1764124102538-ac274f0b-a585-4ef8-bfc5-59487b46497c.json)

## 回调接口配置路径
<font style="color:#117CEE;">配置回调接口路径：</font><font style="color:#117CEE;">发票云->系统管理->业务系统列表</font>

![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764143361349-23641b91-3190-43d5-858d-bc39a567da0d.png)

# 实现效果
<font style="color:#117CEE;">路径：发票云->开票管理->单据开票->所有开票申请单</font>

可以查询到相应的开票申请单

![](https://cdn.nlark.com/yuque/0/2025/png/39256605/1764143975556-885f5d72-b324-4a84-9260-06fe573d8b15.png)

## 调用开票申请单推单->开票申请单
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920683119-e8b8bf21-84df-42d4-9c89-77f142c9ca65.png)

## 非自动开票点击一键开票或工作台->单据处理开票
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920683357-a595ad58-17cb-4b52-b0a2-da102b5f1af2.png)

## 自动开票或手动开票失败->待开单据列表
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920683590-b31b2b6e-2a63-4ee0-898c-8d4a87fe0e29.png)

![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920683862-aeb7bd9d-c411-473b-a949-5b19797a72a3.png)

## 对单据进行更正重新开票后->销项全票池
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920684115-ea4d126f-4212-4c10-8e12-5605042e9d1d.png)

## 开票后回调:发票云->系统管理->发票回调日志
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920684385-60fa22e2-85a6-4c72-8e7f-e53eee989ed2.png)

## 异构系统接收开票回调数据
![](https://cdn.nlark.com/yuque/0/2025/png/22437992/1736920684637-6b249055-8e5c-49be-a6e6-b70806df46ee.png)





