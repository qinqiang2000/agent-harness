| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建/更新时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **标准版影像** | **公开** | 创建 | **2025-11-10** | **欧浩斌** |


# 文档说明
本文档适用于私有化影像系统日常运维操作。私有化影像系统部署内容包含三个核心组件：应用层、数据层、存储层。本文档根据这三个核心组件以及linux操作系统运维维度来编写运维操作指导。

# linux基础运维
参照文档： [Linux常用命令](https://jdpiaozone.yuque.com/nbklz3/tadboa/tys4e5snmk253ob4) 

# 应用层运维
标准版影像系统是基于docker容器部署，主要应用组件包括： docker、zookeeper、redis、nginx。

其中，标准版部署架构下，zookeeper和redis采用docker容器部署。

## 影像应用服务运行路径： /安装路径/kingdee/
安装路径获取命令：

```shell
df -h| grep 'docker-data/containers/' |head -1 | sed 's#docker-data/containers# #g' |awk '{print $6}'
```

## 影像服务对应路径
| 服务运行目录 | 服务中文简介 | 服务日志路径 |
| --- | --- | --- |
| api-archive | 档案系统后台服务 | /安装目录/kingdee/api-archive/logs |
| api-archive-scan | 影像系统后台服务 | /安装目录/kingdee/ api-archive-scan /logs |
| api-archive-invoice | 租户相关服务 | /安装目录/kingdee/api-archive-invoice/logs |
| api-archive-xxl-job-admin | 影像档案定时任务服务 | /安装目录/kingdee/pi-archive-xxl-job-admin/logs |
| api-archive-organization | 许可、鉴权、组织服务 | /安装目录/kingdee/api-archive-organization/logs |
| api-gateway | 网关服务 | /安装目录/kingdee/api-gateway/logs |
| bill-eureka | 注册中心服务 | /安装目录/kingdee/archive-system/logs |
| base-ai-file-cls | 影像前置识别附件和发票 | /安装目录/kingdee/base-ai-file-cls/logs |
| archive-system | 档案前端服务 | /安装目录/kingdee/archive-system/logs |
| doc-view | 文件预览插件 | /安装目录/kingdee/api-archive/logs |
| image-asst | 影像助手前端服务 | /安装目录/kingdee/aimage-asst/logs |
| image-mobile | 影像手机端调阅服务 | /安装目录/kingdee/image-mobile/logs |
| image-system | 影像前端服务 | /安装目录/kingdee/image-system/logs |
| base-online-view | 文件预览插件 | /安装目录/kingdee/base-online-view/logs |


## 应用服务启停
+ **单个微服务启停：**

cd /安装目录/kingdee/对应服务

停止单个服务：docker-compose down

启动单个服务：docker-compose up -d



+ **所有微服务的启停：**

cd /安装目录/kingdee/script

停止所有服务：sh stop.sh

启动所有服务：sh start.sh



+ **微服务的重启：**

cd /安装目录/kingdee/script

sh restart.sh

出现如下页面，输入对应数字即可重启对应的服务

![](https://cdn.nlark.com/yuque/0/2024/png/21778712/1725584967189-29753a6a-4840-4162-a6b8-431f27ea66da.png)

## zookeeper运维
+ **zookeeper启停：**

cd /安装目录/kingdee/zookeeper

停止zookeeper服务：docker-compose down

启动zookeeper服务：docker-compose up -d



+ **客户端连接zookeeper：**

docker exec -it zk1 zkCli.sh

+ **查看根目录下有哪些节点**：

ls /

+ **查看zookeeper中的键值对：**

get /api-archive-scan/pri/invoiceUrl			#替换为需要查看的键值对

+ **修改zookeeper中的键值：**

set /api-archive-scan/pri/invoiceUrl http://api.piaozone.com/

+ **创建zookeeper键值：**

create /api-archive-scan/pri/review 1

## redis运维
+ r**edis启停：**

cd /安装目录/kingdee/redis

停止redis服务：docker-compose down

启动redis服务：docker-compose up -d



+ **客户端连接redis：**

cd /安装目录/kingdee/redis

./redis-cli



+ **登录认证：**

auth passwd



+ **进入库：**

select 1



+ **查看键值：**

get keys



+ **修改键值：**

set keys value

## nginx运维
nginx安装目录： /usr/local/nginx

nginx日志文件目录： /usr/local/nginx/logs/

nginx主配置文件： /usr/local/nginx/conf/nginx.conf

nginx子配置文件目录： /usr/local/nginx/conf/conf.d

nginx启停：

启动nginx服务： /usr/local/nginx/sbin/nginx

停止nginx服务： /usr/local/nginx/sbin/nginx -s stop

重载nginx配置： /usr/local/nginx/sbin/nginx -s reload

# 数据层运维
## 数据库服务管理
+ **数据库启停：**

启动mysql数据库： service mysqld start

停止mysql数据库： service mysqld stop

+ **数据库连接：**

mysql -h mysql-ip -uuser -ppasswd

## 数据库常用命令
数据库和表管理：

+ 创建数据库：
    - CREATE  DATABASE database_name;
+ 创建表：
    - CREATE TABLE table_name (id INT AUTO_INCREMENT PRIMARY KEY, name varchar(100),created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
+ 删除数据库
    - DROP DATABASE database_name;
+ 删除表：
    - DROP TABLE table_name;
+ 修改表结构：
    - 修改数据表名称
        * alter table 旧表名 rename 新表名
    - 修改字段名：
        * alter table 表名 change 旧字段名 新字段名 类型
    - 修改字段类型：
        * alter table 表名 modify 字段 新类型
    - 增加字段：
        * alter table 表名 add 字段 类型
    - 删除字段：
        * alter table 表名 drop 字段
    - 修改表数据：
        * update 表名 set 字段名=新数据 where 条件表达式
    - 删除表数据：
        * delete from 表名 where 条件表达式
+ 查看当前数据库
    - SELECT DATABASE();
+ 查看表结构：
    - DESCRIBE table_name;
+ 查看表数据：
    - select 字段名 from table_name where 条件表达式

## 数据库备份与还原
+ **备份数据库：**
    - **使用mysqldump备份单个库或单个表：**

mysqldump -h mysql-ip -uroot -ppasswd database_name > backup.sql

mysqldump -h mysqp-ip -uroot -ppasswd database_name.table_name > backup.sql

    - **使用mysqldump备份整个数据库：**

mysqldump -h mysql-ip -uroot -ppasswd --all-databases --set-gtid-purged=OFF > all_data.sql



+ **恢复数据库：**

mysql -h mysql-ip -uroot -ppasswd < backup.sql

# 存储层运维
标准版影像系统使用的存储服务是minio，下面介绍minio的运维操作：

+ **容器部署minio服务启停：**

cd /安装目录/kingdee/minio

停止minio服务：docker-compose down

启动minio服务：docker-compose up -d



+ **非容器部署minio服务启停：**

cd /安装目录/minio

启动minio服务： sh minio_run.sh

停止minio服务： sh minio_stop.sh



minio通过环境变量设置accesskey、secretkey，使用mc客户端管理

+ **配置minio客户端：**

mc alias set myminio http://localhost:9000 myaccesskey mysecretkey

myminio： 设置minio别名，自定义

http://localhost:9000 ：minio连接地址

myaccesskey： accesskey，通过环境变量设置

mysecretkey： secretkey，通过环境变量配置

+ **列出minio上的桶：**

mc ls myminio

+ **创建桶：**

mc mb myminio/mybucket

+ **上传文件：**

mc cp /path/to/local/file myminio/mybucket

+ **下载文件：**

mc cp myminio/bucket/file /path/to/local/

+ **删除文件：**

mc rm myminio/bucket/file

+ **列出桶中文件：**

mc ls myminio/bucket

+ **删除桶：**  
	mc rb myminio/bucket --force
+ **同步文件：**

mc mirror /path/to/local/dir myminio/mybucket/

