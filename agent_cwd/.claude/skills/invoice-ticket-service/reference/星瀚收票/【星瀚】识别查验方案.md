| **文档编号** | **适用产品版本** | **使用范围** | **更新内容** | **创建（修改）时间** | **责任人** |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **v25.0.01** | **7.0以上** | **公开** | **创建** | **2025-11-13** | **支三垒** |


# 识别+查验+数据入库
#### 业务逻辑图：报销单为例
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764060360655-9b13471a-ee95-4d1e-a78d-2aefe6e1e0ab.png)

#### 适用常见场景
<font style="color:#DF2A3F;">适用于客户有发票采集功能，</font>**<font style="color:#DF2A3F;">只需要提供识别和查验功能</font>**。

#### 注意事项
发票查验分为发票云公网查验（对接税局查验平台）和乐企平台查验

乐企查验目前存在着比较大的局限性：

    1. 乐企查验仅支持发票购方或销方是本企业的发票，不支持个人抬头发票查验。 
    2. 图片格式的票乐企查验难度提高，依赖税号识别准确才能查验成功；
    3. 乐企查验信息不全。乐企查验不返回发票状态（红冲/作废等），原税局查验平台支持，乐企需要额外调用乐企用途状态查询接口补偿，该接口为异步接口。
    4. 乐企查验性能慢。整体查验效率偏低，预计等待时间是原来2倍及以上； 建议时效性要求高建议保留使用原查验通道，而税局下载时查验目前产品已经是免费了，后续可作为电子税局下载的补偿能力使用。

<font style="color:#DF2A3F;">总体建议：客户使用发票云公网查验，客户必须要求使用乐企查验也建议</font>**<font style="color:#DF2A3F;">开通公网查验作为补偿</font>**<font style="color:#DF2A3F;">。</font>

设置查验通道为乐企的路径：<font style="color:#117CEE;">发票云->基础资料->企业管理->企业信息</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764053332366-5fc8874c-4552-4a27-b418-e7b70157e254.png)

#### 调用识别查验接口接口前需要完成的系统配置：
    1. 基础信息配置 （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#HnCqj)）
    2. 完成授权配置   （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#nvXNR)）
    3. 企业信息配置  （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#QG9BX)）  
    4. 私有化网络开通策略   （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/gc41ww3ghrpxs2sb)）
    5. 第三方对接配置 （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/wxnbv19k6qdmpvze)）
    6. 合规性校验配置（[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/zabzxce5n94bpe47#wDk4h)）

#### 接口调用时序图：
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764053046471-0ed654a2-ea36-4a0d-8ab8-45f0d6f0a7f4.png)

#### 接口清单：
1.01 获取app_token（[接口文档](https://open-ultimate.piaozone.com/api-145421044)）

1.02 获取access_token（[接口文档](https://open-ultimate.piaozone.com/api-145421045)）

2.01 发票查验（[接口文档](https://open-ultimate.piaozone.com/api-145421072)）

2.02 发票识别查验（[接口文档](https://open-ultimate.piaozone.com/api-145421073)）

2.04 发票编辑（[接口文档](https://open-ultimate.piaozone.com/api-145421075)）

###### 获取apptoken调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/api/getAppToken.do](https://xinghan-test.piaozone.com/test01/api/getAppToken.do)

```json
{
  "appId" : "FPYtest01",
  "appSecret" : "Fqy1278129485@FPY",
  "tenantid" : "test01",
  "accountId" : "1640678884833757184"
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055261122-7b0eed34-1fa8-4f6e-b979-d9cb346abaf0.png)

###### 获取access_token 调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/api/login.do](https://xinghan-test.piaozone.com/test01/api/login.do)

```json
{
  "user" : "18073315374",
  "usertype" : "Mobile",
  "apptoken" : "73b2c66f-9bc7-4cb9-834a-140e6f8a79c3",
  "tenantid" : "test01",
  "accountId" : "1640678884833757184",
  "language" : "zh_CN"
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055290555-e86107ba-ac7b-4d03-ad94-68be49f99086.png)

###### 发票识别查验调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07](https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07)

```json
{
    "messageType": "recognitionCheck",
    "messageId": "1693536483080",
    "data": {
        "base64": "",
        "fileDownUrl": "发票文件",
        "fileType": "2",
        "verifyFlag": "1",
        "notCheck": "",
        "saveFlag": "0",
        "billType": "er_checkingpaybill",
        "companyInfo": [
            {
                "taxNo": "91500000MA60QJ5T0G",
                "name": "重庆小传实业有限公司"
            }
        ]
    }
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055498624-58a195d6-6f29-46b0-adb8-4d5e9008c573.png)

<font style="background-color:#FBDE28;">实现效果：</font>

成功后在<font style="color:#117CEE;">发票云-收票管理-全票池查询-进项全票池</font>中可以看到这张票并且为已验状态

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764056405065-ac9a8870-6e03-4f1f-89e4-ee6db6d3a761.png)

###### 发票查验调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07](https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07)

```json
{
    "messageType": "invoiceCheck",
    "messageId": "1",
    "data": {
        "invoiceCode": "",
        "invoiceNo": "23952000000009533823",
        "invoiceDate": "2023-08-12",
        "checkCode": "",
        "invoiceAmount": 507
    }
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055312223-8d7842c8-2f3e-458f-89a0-68acc8b77e99.png)

###### 发票编辑调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07](https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07)

```json
{
    "messageType": "invoiceEdit",
    "messageId": "1693536483081",
    "data": {
        "invoiceType": "23",
        "invoiceCode": "233002530111",
        "invoiceNo": "63408984",
        "invoiceDate": "2023-08-12",
        "checkCode": "",
        "totalAmount": 43
    }
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764119227833-7678c3e6-f61d-4f53-bee0-784a77dc38ae.png)

<font style="background-color:#FBDE28;">实现效果：</font>

调用接口前，这张机打电子发票的开票日期为2025-07-26

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764056598393-b14a986e-e868-4e90-8a65-cc1128337dcc.png)

调用成功后，修改开票日期为2023-08-12，并有已改标识

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764056623815-fb4c46d7-3355-4942-8b60-5e93fd614f95.png)

# 单查验
#### 业务逻辑图：报销单为例
![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764060369828-d556bc56-40a8-41f6-8057-38bb0a5d9041.png)

1. 适用常见场景：**适用于客户有发票采集功能和发票OCR识别能力，只需要提供查验。**
2. 需要完成系统配置：
    1. 查验通道支持发票云公网查验和税局乐企平台查验，具体区别见方案一说明。
    2. 对接第三方识别需要二开对接
3. 需要完成系统配置：
    1. 基础信息配置 （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#HnCqj)）
    2. 完成授权配置   （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#nvXNR)）
    3. 企业信息配置  （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/yq1xe0pg6dmn3fgp#QG9BX)）  
    4. 私有化网络开通策略   （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/gc41ww3ghrpxs2sb)）
    5. 第三方对接配置 （[指导手册](https://jdpiaozone.yuque.com/nbklz3/tadboa/wxnbv19k6qdmpvze)）
4. 时序图：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764053022074-bf369d70-c9cd-4497-88e2-f6b26888a1ec.png)

5. 接口清单：
+ 1.01 获取app_token（[接口文档](https://open-ultimate.piaozone.com/api-145421044)）
+ 1.02 获取access_token（[接口文档](https://open-ultimate.piaozone.com/api-145421045)）
+ 2.01 发票查验（[接口文档](https://open-ultimate.piaozone.com/api-145421072)）
6. 调用样例：

###### 获取apptoken调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/api/getAppToken.do](https://xinghan-test.piaozone.com/test01/api/getAppToken.do)

```json
{
  "appId" : "FPYtest01",
  "appSecret" : "Fqy1278129485@FPY",
  "tenantid" : "test01",
  "accountId" : "1640678884833757184"
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055261122-7b0eed34-1fa8-4f6e-b979-d9cb346abaf0.png)

###### 获取access_token 调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/api/login.do](https://xinghan-test.piaozone.com/test01/api/login.do)

```json
{
  "user" : "18073315374",
  "usertype" : "Mobile",
  "apptoken" : "73b2c66f-9bc7-4cb9-834a-140e6f8a79c3",
  "tenantid" : "test01",
  "accountId" : "1640678884833757184",
  "language" : "zh_CN"
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055290555-e86107ba-ac7b-4d03-ad94-68be49f99086.png)

###### 发票查验调用样例
请求地址：[https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07](https://xinghan-test.piaozone.com/test01/kapi/app/rim/message?access_token=1640678884833757184_kP4zzsALOItxCV4rXWyGWmn0Xjx52cYs9itIaykBHInKnl2uPpjlDRGjPK1gC3sbYP35FMU2iUGJlrEcbULB7BKtSVGsc26rS4ub07)

```json
{
    "messageType": "invoiceCheck",
    "messageId": "1",
    "data": {
        "invoiceCode": "",
        "invoiceNo": "23952000000009533823",
        "invoiceDate": "2023-08-12",
        "checkCode": "",
        "invoiceAmount": 507
    }
}
```

返回响应：

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055312223-8d7842c8-2f3e-458f-89a0-68acc8b77e99.png)

<font style="background-color:#FBDE28;">实现效果：</font>

成功后在发票云-收票管理-全票池查询-进项全票池中可以看到这张票并且为已验状态

![](https://cdn.nlark.com/yuque/0/2025/png/35533825/1764055348493-2f838575-4a12-41f3-907e-5f1b331b5633.png)















