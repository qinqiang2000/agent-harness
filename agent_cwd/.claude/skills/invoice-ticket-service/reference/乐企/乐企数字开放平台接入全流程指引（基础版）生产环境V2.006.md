乐企数字开放平台

接入全流程指引

**2024年03月22日**



**修改说明**

| **版本** | **章节编号** | **修订内容简述** | **生效日期** |
| --- | --- | --- | --- |
| V2.000 | 全部 | 重建文档 | 2024-3-22 |
| V2.001 | 2.2.8 | 新增2.2.8.发布情况查询 | 2024-06-20 |
| V2.002 | 2.2.7 | 他用、联用授权认证流程切换 | 2024-07-17 |
| V2.003 | 2.2.3.2、2.2.4 | 请求头新增clientTid | 2024-11-04 |
| V2.004 | 2.2.3.2 | 调整乐企平台沙箱环境的数字服务请求地址URL | 2024-11-13 |
| V2.005 | 2.2.3.2、2.2.4 | 请求头新增ptlx | 2024-11-21 |
| V2.006 | 2.2.3.2、2.2.4 | 请求头ptlx描述调整 | 2025-03-28 |




**目录**

1.概述	1

2.直连单位接入指引	1

2.1.直连单位接入申请	1

2.2.能力订阅管理	1

2.2.1.能力开通请求发起	1

2.2.2.获取平台编号以及密钥	2

2.2.3.沙箱测试	3

2.2.4.能力正式开通	8

2.2.5.返回报文示例	9

2.2.6.流量控制	11

2.2.7.他用、联用授权认证（仅他用、联用试点企业）	11

2.2.8.发布情况查询	22

2.3.邀请使用单位	31

2.4.邀请使用单位使用能力	31

3.使用单位接入指引	31

3.1.使用单位接入确认	31

3.2.使用单位申请使用能力	32

附件：	33



# 1.概述
本文档主要针对乐企直连单位对接乐企数字开放平台（以下简称：乐企平台）进行指引，乐企直连单位需按照图中步骤完成乐企直连全流程技术对接：

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114477589-778ccbe6-9ebf-4177-900a-71d1bcd666f4.png)

# 2.直连单位接入指引
## 2.1.直连单位接入申请
乐企直连单位登录电子税务局（电子税务局>我要办税>乐企数字开放平台），提交接入资料，等待税务部门确认。税务部门确认接入申请后，直连单位可开展后续的能力订阅、沙箱测试等工作。直连单位申请接入的具体操作步骤参照《附件1-1：乐企数字开放平台操作手册-纳税人端自用申请分册》。

## 2.2.能力订阅管理
### 2.2.1.能力开通请求发起
1.直连单位点击【能力中心】模块下的【我的能力】功能菜单，根据企业实际业务需要，在非公用基础能力中选择一项状态为“未开通”的能力，进入能力详情界面；

2.点击能力详情界面的【申请开通】按钮，进入能力开通界面；

3.直连单位录入能力开通有效期止、拟嵌入自有业务系统名称、每项能力日使用量(次/天)（<font style="color:#FF0000;">2024年4月一般版本GT4_LQPT_SZNL_V1.2412.00.00已对日使用量做了隐藏，不需要企业再填写</font>）、能力使用业务范围，点击【提交】按钮；

4.能力订阅的开通请求提交成功，能力状态变更为“待测试”。

具体操作步骤可参考《附件2：乐企数字开放平台操作手册-能力中心分册》。后续企业可以开展沙箱测试工作，详见本文2.2.3沙箱测试部分。

### 2.2.2.获取平台编号以及密钥
平台编号及密钥是企业进行沙箱测试及后期生产环境正式运行时必不可少的数据信息。

1.平台编号获取：乐企直连单位接入确认后，进入乐企平台，进入【接入管理】模块，进入【接入申请】页面，会展示企业相关信息。其中“乐企ID”就是沙箱测试以及能力调用时所需的“ptbh”。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114478586-c1a5e6a6-146b-4ca0-b948-7e7d0087f71c.png)

2.密钥获取：直连单位进行沙箱测试以及能力调用时，需要沙箱密钥以及能力密钥。进入【接入管理】模块，进入【密钥管理】页面，“正式环境密钥”对应生产环境能力调用时所需要的密钥，“测试环境密钥”对应的是沙箱环境请求时所需要的密钥。在沙箱请求或能力请求时，请求报文需要使用对应密钥进行加密，返回报文需要使用密钥进行解密，请参照：《附件4:安全中心加密示例》。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114479581-bf12fc0a-46d6-427b-ad85-6c84a1849951.png)

### 2.2.3.沙箱测试
直连单位在进行自有业务系统改造时，可前往测试中心模块查看测试指引与测试用例，对自有业务系统改造情况进行仿真测试，测试通过后生成测试报告提交税务部门进行确认，确认通过后能力正式开通。具体操作步骤可参考《附件3：乐企数字开放平台操作手册-测试中心分册》。

乐企沙箱基于场景化测试要求，为直连单位提供【沙箱控制服务】和【沙箱数字能力】。【沙箱控制服务】为企业提供修改返回结果和关联条件的功能，用于测试不同的业务场景；【沙箱数字能力】用于企业做业务联调测试。企业在使用乐企沙箱时，要结合测试场景，需要初始化的，要先调用【沙箱控制服务】完成初始化，再按照测试场景要求调用【沙箱数字能力】进行业务联调。

#### 2.2.3.1.沙箱测试的前置步骤
企业使用乐企沙箱，需要满足以下条件：

（1）直连单位需发起直连单位接入申请，且税务机关已经确认接入申请，之后直连单位可用线上接入申请时报备的沙箱地址IP访问乐企沙箱环境。

（2）直连单位需发起能力订阅的开通请求（详见本文2.2.1能力开通请求发起部分）。

（3）直连单位需要获取自身平台编号（乐企 ID）、以及沙箱密钥用于报文请求加密（详见本文2.2.2获取平台编号以及密钥部分）。

（4）完成虚拟使用单位初始化，获取虚拟单位平台编号及相关信息。在沙箱环境，一个直连单位默认分配一个虚拟使用单位，虚拟使用单位无需订阅能力。企业可调用“虚拟单位企业数据查询”接口查询虚拟单位企业数据，并保存到单位本地，完成虚拟单位信息初始化。

（5）开票能力的沙箱环境，直连单位只能给虚拟使用单位开票，或接收虚拟使用单位开票；用票能力的沙箱环境，需先按照《附件5-2：乐企数字开放平台-沙箱操作指引2（用票）》的内容，完成用票数据初始化。

沙箱测试操作步骤可参考《附件5-1：乐企数字开放平台-沙箱操作指引1（开票及基础）》、《附件5-2：乐企数字开放平台-沙箱操作指引2（用票）》。

#### 2.2.3.2.沙箱测试的报文组成
直连单位需要以报文的形式进行沙箱测试，报文包括：请求地址，报文头，报文体。

（1）沙箱测试的请求地址（URL）

乐企平台沙箱环境的控制服务请求地址（URL）：	

[https://lqpt.chinatax.gov.cn:8443/access/sandbox_kzfw/v1/服务编码/](https://lqpt.chinatax.gov.cn:8443/access/sandbox_kzfw/v1/服务编码/)

乐企平台沙箱环境的数字服务请求地址（URL）：

[https://lqpt.chinatax.gov.cn:8443/access/sandbox/v2/invoke/](https://lqpt.chinatax.gov.cn:8443/access/sandbox/v2/invoke/)能力编码/服务编码/ 

能力编码：能力是乐企平台提供某一具体业务的形式，某一具体能力由一个或多个相互关联的服务（接口）和调用规则组成，能力编码是乐企平台对某一具体能力的唯一识别编号。

服务编码：服务是构成乐企平台某一具体能力的接口，服务（接口）分为实时和异步，实时接口可实时返回请求所需数据，异步接口返回流水号或批次流水号，可在处理完成后调用对应查询接口获得所需数据，服务编码是乐企平台某一具体能力中的服务(接口)的唯一识别码。

沙箱控制服务的服务编码可参考《附件5-1：乐企数字开放平台-沙箱操作指引1（开票及基础）》、《附件5-2：乐企数字开放平台-沙箱操作指引2（用票）》的3.2.1请求地址章节或5.2沙箱控制服务章节。

沙箱数字服务的能力编码和服务编码可在能力详情页面和测试中心详情页查询，如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114479865-eb7adac0-a209-4697-9b96-577ee4a240b6.png)

以乐企数字化电子发票（基础版）开票能力例（请以页面实际内容为准）：

能力编码（nlbm）：202007

用例编码（ylbm）：911001

| **序号** | **服务名称（fwmc）** | **服务编码（fwbm）** |
| :---: | --- | --- |
| 1 | 获取数字化电子发票批量预赋码信息 | QDFPPLFM |
| 2 | 查询税收分类编码信息 | CXSSFLBM |
| 3 | 查询可用税率信息 | CXKYSL |
| 4 | 查询授信额度 | CXSXED |
| 5 | 下载或退回授信额度 | XZTHSXED |
| 6 | 调整授信额度有效期 | TZSXEDYXQ |
| 7 | 查询纳税人风险信息 | CXNSRFXXX |
| 8 | 查询纳税人基本信息 | CXNSRJBXX |
| 9 | 数字化电子发票上传 | QDFPSC |
| 10 | 查询数字化电子发票上传结果 | CXQDFPSCJG |
| 11 | 数字化电子发票红字确认单申请 | QDHZQRDSQ  |
| 12 | 数字化电子发票红字确认单确认 | QDHZQRDQR |
| 13 | 查询数字化电子发票红字确认单列表查询 | CXQDHZQRDLB |
| 14 | 查询数字化电子发票红字确认单明细查询 | CXQDHZQRDMX |
| 15 | 上传发票汇总确认信息 | SCFPHZQRXX |
| 16 | 查询发票汇总确认信息 | CXFPHZQRXX |
| 17 | 查询差额征税编码 | CXCEZSBM |




（2）请求报文头（header）示例:

| **Key** | **名称** | **值** | **说明** |
| --- | --- | --- | --- |
| jrdwptbh | 直连单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| sydwptbh | 使用单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| ylbm | 用例编码 | XXXXXXXX | 用例编码是乐企平台对某一具体用例的唯一标识码。 |
| sxcsbz | 沙箱测试标志 | 1 | **特别注意**：初次沙箱测试完成提交审核之前，请务必不要加上此参数；该参数仅适用于能力开通后或能力正在审核时企业再次进行沙箱测试时使用。 |
| access_signature | 签名加密串 | XXXXXX | 暂不填写 |
| clientTid | 客户端交易ID | 32位字母、数字组合 | **非必录**，用于企业侧与乐企侧之间的请求响应时长监测或其他业务跟踪。<br/>**特别注意：**建议使用UUID或自有业务系统会话ID，以减少重复概率。 |
| ptlx | 平台类型 | 0（自用）、1（他用）、2（联用） | **非必录**，当使用单位为直连单位自身且直连单位存在多种接入类型时必录，用于区分使用单位采用何种直连平台接入类型进行能力服务调用 |


用例编码：用例是直连单位在乐企平台订阅能力时，进行沙箱测试的场景和要求，用例编码是乐企平台对某一具体用例的唯一标识码，用例编码需要放入请求头中，可在测试中心详情页查询。如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114480225-aa7c2fde-10a9-4ea6-952d-4cb834327993.png)

以乐企数字化电子发票（基础版）开票能力例（请以页面实际内容为准）：

用例编码（ylbm）：911001

（3）请求报文体示例:

{

	"gfsbh": "购买方统一社会信用代码/纳税人识别号"

}



以下以基础开票能力中查询可用税率（接口）举例：

请求地址：[https://lqpt.chinatax.gov.cn:8443/access/sandbox/v2/invoke/202007/CXKYSL/](https://lqpt.chinatax.gov.cn:8443/access/sandbox/v2/invoke/202007/CXKYSL/)

报文头：

jrdwptbh:1fc411*******afe0f10

sydwptbh:1fc411*******afe0f10

ylbm:911001

报文体：

{

	"nsrsbh": "91****************H"

}

### 2.2.4.能力正式开通
沙箱测试及能力开通申请审核通过后，可判断订阅的能力服务已正式生效，可以进行乐企订阅的能力服务与自有系统后端功能的业务办理。

直连单位如果要正式使用订阅的能力，需要给自己进行能力授权：先通过“授权我的能力”功能对自己发起能力授权邀请，然后通过“能力受理管理”功能接收能力授权邀请。具体操作步骤参照《附件2：乐企数字开放平台操作手册-能力中心分册》。

企业需以报文的形式进行正式环境访问，报文同样包括：请求地址，报文头，报文体。

乐企平台能力接口服务URL：

[https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/能力编码/服务编码/](https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/能力编码/服务编码/)

例：

服务名称：查询可用税率信息

服务编码：CXKYSL

请求报文头header:

| **Key** | **名称** | **值** | **说明** |
| --- | --- | --- | --- |
| jrdwptbh | 直连单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| sydwptbh | 使用单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| access_signature | 签名加密串 | XXXXXX | 暂不填写 |
| access_token | 用户令牌 | XXXXXXXXXXXXXXXXXXXX | 仅限他用、联用试点企业在满足如下场景时填写：<br/>1. 请求类型为正式服务；2、请求头中的直连单位乐企ID不等于使用单位乐企ID（即非直连单位自身调用）；3、直连单位接入类型为乐企他用或直连单位接入类型为乐企联用且使用单位关系类型为不具有控制关系。<br/>获取规则见2.2.7他用、联用授权认证章节。 |
| clientTid | 客户端交易ID | 32位字母、数字组合 | **非必录**，用于企业侧与乐企侧之间的请求响应时长监测或其他业务跟踪。<br/>**特别注意：**建议使用UUID或自有业务系统会话ID，以减少重复概率。 |
| ptlx | 平台类型 | 0（自用）、1（他用）、2（联用） | **非必录**，当使用单位为直连单位自身且直连单位存在多种接入类型时必录，用于区分使用单位采用何种直连平台接入类型进行能力服务调用 |


### 2.2.5.返回报文示例
返回报文参数:

| **Key** | **名称** | **值** | **说明** |
| --- | :---: | :---: | --- |
| httpStatusCode | 网络返回码值 | 参照对照表 |  |
| body | 报文体 | |  |
| Response | 响应体 | |  |
| RequestId | 请求唯一码 | |  |
| Data | 返回数据包 | |  |




httpStatusCode码值对照表:

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114480587-ac201f90-8b18-4608-997a-fa0a86960251.png)

返回报文示例（实时）：

{

    "httpStatusCode": "200", 

    "body": {

        "Response": {

            "RequestId": "d8858d32fd3e632d", 

            "Data": "{\"ztsxbz\":\"N\",\"bysxed\":180000.00,\"returnmsg\":\"成功\",\"kysyed\":88963.02,\"returncode\":\"00\",\"yxzed\":91037.12,\"yxzwsyed\":499751180.51,\"sq\":\"202306\"}"

        }

    }

}

返回报文示例（异步）：

{

    "httpStatusCode": "200",

    "body": {

        "Response": {

            "RequestId": "3dbb0f0266b2fe00",

            "Data": "{\"lsh\":\"12345678852452785424\",\"returncode\":\"00\"}"

        }

    }

}

### 2.2.6.流量控制
乐企平台启动流量控制是为了保障乐企数字开放平台稳健运行，避免平台直连单位数字能力访问请求过多，超出平台承载能力。当一秒内的某个能力的请求数量超过流量阈值后，系统会触发流量控制，按照直连单位+能力请求进行流量控制，对超出流量阈值的请求进行阻断，并返回错误提示“当前访问请求较多，请5分钟后重试，将访问并发控制在x以内”。对于处于直连违规被限流的企业，在限流有效期内，会持续限制流量访问。

为避免频繁调用能力触发流量控制，建议企业对于发票上传等可批量操作接口，尽量按时间或数量对明细数据进行汇总后上传，尽量避免单条上传产生较多请求。在企业侧系统架构设计时，也需要支持对访问乐企平台的请求设置消息队列，在收到限流错误返回后，可以快速、灵活的调整并发请求访问量。

### 2.2.7.他用、联用授权认证（仅他用、联用试点企业）
为保障乐企他用、乐企联用（不具有控制关系）的使用单位通过乐企平台发起业务的真实性及合法性，乐企平台将与可信身份体系对接，企业侧系统需协助使用单位完成实人认证授权，使用单位在完成向直连单位的实人认证授权后，企业侧系统可以按需调用乐企平台提供的获取用户令牌信息的接口来获取有效的用户令牌信息，在调用正式能力服务时将用户令牌放入请求头，再发起业务处理报文请求。

其中二维码、授权码、用户令牌都有对应的过期时间，其中二维码过期时间为10分钟；授权码过期时间为使用单位于APP完成实人认证时填写；用户令牌过期时间为60分钟。

当使用单位在10分钟内未完成实人认证时，企业侧需再次调用获取二维码接口重新展示二维码，同时企业侧系统需记录使用单位、授权码、用户令牌的勾稽关系与对应的过期时间，当授权码过期时，需要企业侧系统重新发起授权认证；当用户令牌过期时，需使用有效的授权码再次调用获取用户令牌接口进行获取。相关业务流程如下：

**授权认证**

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114480939-74e93081-ea37-460f-baa6-b246bf76efb4.png)

1、使用单位法定代表人或财务负责人通过电子税务局登录乐企数字开放平台纳税人端-我的授权模块，点击“授权认证”超链接，阅读《乐企授权服务协议书》后，维护授权认证有效期止；

2、企业侧系统调用乐企平台获取实人认证二维码的服务接口；

3、乐企平台接收企业的请求信息，调用可信身份认证体系办税人员校验的服务接口；

4、可信身份体系根据请求信息校验人员是否为使用单位的法定代表人或财务负责人，并将校验结果返回至乐企平台；

5、乐企平台接收可信身份体系返回校验结果，若校验通过，则调用可信身份认证体系获取实人认证二维码的服务接口；

6、可信身份体系根据请求信息生成实人认证二维码信息，并将实人认证二维码信息返回至乐企平台；

7、乐企平台接收可信身份体系返回的实人认证二维码信息，将直连单位、使用单位、人员、二维码信息这四者的关联关系进行保存并将二维码信息反馈给企业；

8、企业侧系统对获取到的实人认证二维码信息在系统前台进行展示；

9、企业通过app扫描企业侧系统展示的实人认证二维码，进行实人认证；

10、可信身份体系记录app产生的实人认证结果；

11、企业侧系统调用乐企平台获取授权码的服务接口，乐企平台接收企业发起的查询授权码信息请求，校验二维码ID是否有效（直连单位与使用单位关系、有效期）；若二维码ID无误，则调用可信身份体系获取校验结果接口获取实人认证校验结果；若实人认证校验通过，乐企生成并记录授权码，并反馈给企业侧应用；

12、企业侧系统对获取到的授权码信息进行后续相关处理。

**获取用户令牌（token）**

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114481213-9f75106d-14b3-47f6-adb7-20a73e223ce0.png)

1、企业侧系统调用乐企平台提供的服务接口发起获取token的请求；

2、乐企平台根据企业的请求，判断授权码是否有效（直连单位与使用单位关系、有效期），若授权码无误，则调用可信身份认证体系办税人员校验的服务接口（R_TYSFGL_LQ_019）；

3、可信身份体系根据请求信息校验人员是否为使用单位的法定代表人或财务负责人，并将校验结果返回至乐企平台；

4、乐企平台接收可信身份体系返回校验结果，若校验通过，乐企生成并记录token与时效信息，并将有效token与时效反馈至企业侧；

5、企业侧系统获取到有效token信息后，可发起业务处理请求。

#### 2.2.7.1流程切换说明
预计将于2024年7月20日切换至新版授权认证流程，新版授权认证流程上线后，使用单位法定代表人或财务负责人需先在乐企数字开放平台纳税人端-我的授权模块完成授权认证，随后使用税务APP扫描直连单位自有系统产生的二维码时，将无需进行授权认证有效期止维护等操作，仅需扫脸认证通过即可完成实人认证。

同时直连单位在新版授权认证切换之前就已经完成授权认证的使用单位，仍可正常使用老版授权码进行用户令牌的获取，待授权认证有效期过后，再进行新版授权认证流程。

#### 2.2.7.2授权认证模块说明
使用单位登录乐企数字开放平台纳税人端-我的授权模块，若使用单位与直连单位之间的单位关系类型为“不具有控制关系”时，操作列将出现“授权认证”超链接，如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114481486-f4ef05f0-b1dc-45f5-acb9-9312e9ff0fbd.png)

“我的授权”页面

点击超链接进入“授权认证”页面，使用单位法定代表人或财务负责人核对个人身份信息并维护授权认证有效期止后，点击“《乐企授权服务协议书》”超链接阅读并同意后，即可点击“确认授权”按钮完成授权认证，如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114481732-d31adbca-0e20-4b41-9f5d-e541e2a5c612.png)

“授权认证”页面

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114482007-c4434b78-75cf-4765-9d4c-8b69238494d2.png)

“乐企授权服务协议书”页面

#### 2.2.7.3授权认证接口说明
与能力接口调用一致，请求头中必须包含如下字段，用于查询直连单位信息与使用单位信息。请求业务报文与返回业务报文中的Data字段需使用正式环境密钥进行加密。

| **Key** | **名称** | **值** | **说明** |
| --- | --- | --- | --- |
| jrdwptbh | 直连单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| sydwptbh | 使用单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |


##### 2.2.7.3.1获取二维码
**接口说明**

他用、联用类直连单位企业侧系统，调用乐企接口获取由税务可信生成的一个二维码，在自己的系统中推送给已绑定关系的使用单位；使用单位的法定代表人或财务负责人（已在税务系统报备）使用税务APP（各省的新老电局APP已经支持）扫描二维码完成实人认证并录入授权有效期。

**请求方式**

请求方式为post，请求路径为：[https://lqpt.chinatax.gov.cn:8443/access/v1/getQRCode](https://lqpt.chinatax.gov.cn:8443/access/v1/getQRCode)

**请求参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | idCard | 授权人证件号码 | varchar | 32 | 是 |  |
| 2 | idCardType | 授权人证件类型 | varchar | 3 | 是 | 码值见对应字典 |
| 3 | relatedType | 自然人类型 | varchar | 2 | 是 | 码值见对应字典 |


**请求报文示例**

{

	"idCard": "授权人证件号码",

	"idCardType": "授权人证件类型",

	"relatedType": "自然人类型"

}

**返回参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | qrcode_id | 二维码id | varchar |  | 是 |  |
| 2 | qrcode | 二维码内容 | varchar |  | 是 |  |


**返回报文示例**

{

    "httpStatusCode": "200",

    "body": {

        "Response": {

            "RequestId": "3dbb0f0266b2fe77",

            "Data": "{\"qrcode_id\":\"二维码id\",\"qrcode\":\"二维码内容\"}"

        }

    }

}

**授权人证件类型字典**

| **序号** | **类型** | **名称** |
| :---: | --- | --- |
| 1 | 201 | 居民身份证 |
| 2 | 208 | 外国护照 |
| 3 | 210 | 港澳居民来往内地通行证 |
| 4 | 213 | 台湾居民来往大陆通行证 |
| 5 | 227 | 中国护照 |
| 6 | 233 | 外国人永久居留证 |
| 7 | 237 | 中华人民共和国港澳居民居住证 |
| 8 | 238 | 中华人民共和国台湾居民居住证 |
| 9 | 239 | 中华人民共和国外国人工作许可证（A类） |
| 10 | 240 | 中华人民共和国外国人工作许可证（B类） |
| 11 | 241 | 中华人民共和国外国人工作许可证（C类） |
| 12 | 299 | 其他个人证件 |


**自然人类型字典**

| **序号** | **类型** | **名称** |
| :---: | --- | --- |
| 1 | 01 | 法定代表人 |
| 2 | 02 | 财务负责人 |


##### 2.2.7.3.2获取授权码
**接口说明**

企业侧系统系统调用乐企平台服务接口获取授权码信息，乐企平台接收企业发起的查询授权码信息请求，调用可信身份体系查询授权码信息接口获取授权码信息，并反馈给企业侧系统。

**请求方式**

请求方式为post，请求路径为：[https://lqpt.chinatax.gov.cn:8443/access/v1/getAuthCode](https://lqpt.chinatax.gov.cn:8443/access/v1/getAuthCode)

**请求参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | qrcode_id | 二维码id | varchar |  | 是 |  |


**请求报文示例**

{

	"qrcode_id": "二维码id"

}

**返回参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | qrcode_status | 二维码状态 | varchar | 1 | 是 | 1：初始状态<br/>2：二维码扫描成功<br/>3：二维码已失效 |
| 2 | code | 授权码 | varchar | 64 | 否 | 当二维码状态为2时返回 |
| 3 | endDate | 授权码有效期止 | varchar | 19 | 否 | 当二维码状态为2时返回，yyyy-MM-dd HH:mm:ss |


**返回报文示例**

{

    "httpStatusCode": "200",

    "body": {

        "Response": {

            "RequestId": "3dbb0f0266b2fe88",

            "Data": "{\"qrcode_status\":\"二维码状态\",\"code\":\"授权码\",\"endDate\":\"授权码有效期止\"}"

        }

    }

}

##### 2.2.7.3.3获取用户令牌
**接口说明**

企业侧系统调用乐企平台服务接口获取用户令牌信息，乐企平台接收企业发起的获取用户令牌请求，调用可信身份体系获取用户令牌接口获取用户令牌信息，乐企平台更新数据库中的直连单位、使用单位、用户令牌关系，并反馈给企业侧系统。

当使用单位发起正式能力调用时，企业侧系统需将获取到的有效的用户令牌放置于请求头中，乐企平台将进行用户令牌校验。

**请求方式**

请求方式为post，请求路径为：[https://lqpt.chinatax.gov.cn:8443/access/v1/getToken](https://lqpt.chinatax.gov.cn:8443/access/v1/getToken)

**请求参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | code | 授权码 | varchar | 64 | 是 |  |


**请求报文示例**

{

	"code": "授权码"

}

**返回参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | access_token | 用户令牌 | varchar |  | 是 |  |
| 2 | expires_in | 令牌有效期 | int | 5 | 是 | 单位：秒 |


**返回报文示例**

{

    "httpStatusCode": "200",

    "body": {

        "Response": {

            "RequestId": "3dbb0f0266b2fe99",

            "Data": "{\"access_token\":\"用户令牌\",\"expires_in\":3600}"

        }

    }

}

### 2.2.8.发布情况查询
为保障企业侧应用能及时了解能力文档与版本发布情况，乐企平台为企业侧应用提供“能力文档发布情况查询”与“版本发布情况查询”两个通用接口，企业侧应用可根据接口返回报文，重新登录乐企数字开放平台纳税人端文档中心获取对应版本能力文档并完成企业侧应用修改。

**能力文档发布情况查询**

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114482245-98de650c-37cd-45ce-a26e-553d12a850cc.png)

1、税务人员事先通过“能力文档在线管理”维护能力文档；

2、企业侧应用调用“能力文档发布情况查询”接口；

3、乐企平台接口到企业侧请求，查询近两月是否存在已发布的能力文档；

4、若存在则组装能力文档发布信息，返回给企业侧应用；

5、企业可根据返回报文内容，登录乐企数字开放平台纳税人端-文档中心，在线阅读或下载对应版本的能力文档。

**版本发布情况查询**

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114482498-c3f1a8de-72a2-4125-ac40-b87a6675f8fb.png)

1、能力开发人员进行沙箱环境业务应用改造；

2、沙箱环境发布前需填写版本发布信息；

3、完成沙箱环境发布；

4、企业侧应用调用“版本发布情况查询”接口；

5、乐企平台接口到企业侧请求，查询当前时间是否存在版本发布信息；

6、若存在则组装版本发布信息，返回给企业侧应用；

7、企业侧应用开发厂商可根据返回报文内容判断企业侧应用是否需要改造，如需改造，则需要正式环境上线时间之前完成。

#### 2.2.8.1发布情况查询接口说明
与能力接口调用一致，请求头中必须包含如下字段，用于查询直连单位信息与使用单位信息。请求业务报文与返回业务报文中的Data字段需使用正式环境密钥进行加密。

| **Key** | **名称** | **值** | **说明** |
| --- | --- | --- | --- |
| jrdwptbh | 直连单位乐企ID | XXXXXXXXXXXXXXXXXXXX |  |
| sydwptbh | 使用单位乐企ID | XXXXXXXXXXXXXXXXXXXX | 建议与直连单位乐企ID一致 |


##### 2.2.8.1.1能力文档发布情况查询
**接口说明**

企业业务系统通过能力文档发布情况查询接口，获取近两个月能力文档发布情况。

**请求方式**

请求方式为post，请求路径为：[https://lqpt.chinatax.gov.cn:8443/access/v1/queryNlwdfbqk](https://lqpt.chinatax.gov.cn:8443/access/v1/queryNlwdfbqk)

**请求参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | nlbm | 能力编码 | varchar | 6 | 否 |  |


**请求报文示例**

{

    "nlbm": "能力编码"

}

**返回参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | varchar | 2 | 是 | 00：成功<br/>其它：失败 |
| 2 | returnmsg | 返回信息 | varchar | 2000 | 否 | 错误信息说明 |
| 能力文档发布情况列表（nlwdfbqkList） | | | | | | |
| 1 | nlbm | 能力编码 | varchar | 6 | 是 |  |
| 2 | nlmc | 能力名称 | varchar | 450 | 是 |  |
| 3 | nlwdmc | 能力文档名称 | varchar | 500 | 是 |  |
| 4 | nlwdbbh | 能力文档版本号 | varchar | 100 | 是 |  |
| 5 | fbsj | 发布时间 | varchar | 19 | 是 | YYYY-MM-DD<br/>HH:mm:ss |
| 修改说明列表（xgsmList） | | | | | | |
| 1 | xgzjbh | 修改章节编号 | varchar | 300 | 是 |  |
| 2 | xgnrms | 修改内容描述 | varchar |  | 是 |  |
| 3 | xgsxrq | 修改生效日期 | varchar | 10 | 是 | YYYY-MM-DD |


**返回报文示例**

{

	"Response": {

		"RequestId": "16位随机数字和字母组合",

		"Data": {

			"returncode": "返回码",

			"returnmsg": "返回内容",

			"nlwdfbqkList": [

				{

					"nlbm":"能力编码",

					"nlmc": "能力名称",

					"nlwdmc": "能力文档名称",

					"nlwdbbh": "能力文档版本号",

					"fbsj": "发布时间",

					"xgsmList": [

						{

							"xgzjbh": "修改章节编号",

							"xgnrms": "修改内容描述",

							"xgsxrq": "修改生效日期"

						}

					]

				}

			]

		}

	}

}

##### 2.2.8.1.2版本发布情况查询
**接口说明**

企业业务系统通过版本发布情况查询接口，获取近期版本发布情况。

**请求方式**

请求方式为post，请求路径为：[https://lqpt.chinatax.gov.cn:8443/access/v1/queryBbfbqk](https://lqpt.chinatax.gov.cn:8443/access/v1/queryBbfbqk)

**请求参数**

| **序号** | **数据项标识** | **数据项名称** | **字段类型** | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- |
| 1 | nlbm | 能力编码 | varchar | 6 | 否 |  |
| 2 | sxhjfbsjq | 沙箱环境发布时间起 | varchar | 19 | 否 | YYYY-MM-DD<br/>HH:mm:ss |
| 3 | sxhjfbsjz | 沙箱环境发布时间止 | varchar | 19 | 否 | YYYY-MM-DD<br/>HH:mm:ss |


**请求报文示例**

{

	"nlbm": "能力编码",

	"sxhjfbsjq": "沙箱环境发布时间起",

	"sxhjfbsjz": "沙箱环境发布时间止"

}

**返回参数**

| **序号** | **数据项标识** | | **数据项名称** | | **字段类型** | | **长度** | **必须** | **说明** |
| :---: | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | returncode | | 返回码 | | varchar | | 2 | 是 | 00：成功<br/>其它：失败 |
| 2 | returnmsg | | 返回信息 | | varchar | | 2000 | 否 | 错误信息说明 |
| 版本发布情况列表（bbfbqkList） | | | | | | | | | | | | |
| 1 | | bbh | | 版本号 | | varchar | | 75 | 是 | 发布生产环境时申请的版本号 |
| 2 | | sxhjfbsj | | 沙箱环境发布时间 | | varchar | | 19 | 是 | YYYY-MM-DD<br/>HH:mm:ss |
| 3 | | schjsxsj | | 生产环境上线时间 | | varchar | | 19 | 是 | YYYY-MM-DD<br/>HH:mm:ss |
| 服务变更列表（fwbgList） | | | | | | | | | | | | |
| 1 | | nlbm | | 能力编码 | | varchar | | 6 | 是 |  |
| 2 | | nlmc | | 能力名称 | | varchar | | 450 | 是 |  |
| 3 | | nlwdbbh | | 能力文档版本号 | | varchar | | 100 | 是 |  |
| 4 | | fwbm | | 服务编码 | | varchar | | 100 | 是 |  |
| 5 | | fwmc | | 服务名称 | | varchar | | 150 | 是 |  |
| 6 | | xgsm | | 修改说明 | | varchar | | 3000 | 是 |  |
| 7 | | sfzd | | 是否阻断 | | varchar | | 1 | 是 | Y：阻断（自有系统需改造）<br/>N：不阻断（兼容上一版本） |


**返回报文示例**

{

	"Response": {

		"RequestId": "16位随机数字和字母组合",

		"Data": {

			"returncode": "返回码",

			"returnmsg": "返回内容",

			"bbfbqkList": [

				{

					"bbh":"版本号",

					"sxhjfbsj": "沙箱环境发布时间",,

					"schjsxsj": "生产环境上线时间",

					"fwbgList": [

						{

							"nlbm": "能力编码",

							"nlmc": "能力名称",

							"nlwdbbh": "能力文档版本号",

							"fwbm": "服务编码",

							"fwmc": "服务名称",

							"xgsm": "修改说明",

							"sfzd": "是否阻断"

						}

					]

				}

			]

		}

	}

}

## 2.3.邀请使用单位
直连单位接入申请成功后可邀请使用单位进行接入。具体操作步骤参照《附件1-1：乐企数字开放平台操作手册-纳税人端自用申请分册》。

## 2.4.邀请使用单位使用能力
直连单位可通过“授权我的能力”和“能力受理管理”两个功能对使用单位发起能力授权邀请，使用单位确认后，直连单位对使用单位能力授权成功；当使用单位对直连单位发起了能力授权申请后，直连单位可通过“能力受理管理”功能接收使用单位发起的能力授权申请。之后，使用单位可正常使用授权的能力。具体操作步骤参照《附件2：乐企数字开放平台操作手册-能力中心分册》。

# 3.使用单位接入指引
## 3.1.使用单位接入确认
乐企使用单位登录电子税务局（电子税务局>我要办税>乐企数字开放平台），响应邀请，提交接入资料，等待税务部门确认。税务部门确认后，接入成功。使用单位具体操作步骤参照《附件1-1：乐企数字开放平台操作手册-纳税人端自用申请分册》。

## 3.2.使用单位申请使用能力
使用单位可通过“我的授权”功能对直连单位发起能力授权申请，直连单位确认后，直连单位对使用单位能力授权成功。当直连单位对使用单位发起了能力授权邀请后，使用单位可通过“能力受理管理”功能接收直连单位发起的能力授权邀请。之后，使用单位可正常使用授权的能力。具体操作步骤参照《附件2：乐企数字开放平台操作手册-能力中心分册》。





# 附件：
《附件1-1：乐企数字开放平台操作手册-纳税人端自用申请分册》

《附件2：乐企数字开放平台操作手册-能力中心分册》

《附件3：乐企数字开放平台操作手册-测试中心分册》

《附件4：报文加解密开发指引》

《附件5-1：乐企数字开放平台-沙箱操作指引1（开票及基础）》

《附件5-2：乐企数字开放平台-沙箱操作指引2（用票）》





