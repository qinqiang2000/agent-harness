乐企代办退税勾选

能力说明文档V2.011





修改说明

| 版本 | 章节编号 | 修订内容简述 | 生效日期 |
| --- | --- | --- | --- |
| V1.000 | 三、开发指引四、接口列表 |  按新模板调整能力说明文档 | 2022-12-01 |
| V1.001 | 四、接口列表 | 对接口1、2返回参数中返回码说明进行修改，并增加附件一：一、返回码代码表 | 2022-12-05 |
| V1.002 | 三、开发指引 | 增加校验待处理农产品发票确认状态 | 2022-12-16 |
| V2.000 | 全部 | 增加代办退税勾选业务初始化场景及接口说明<br/>将“全电发票”“新电票”等表述改为“数字化电子发票”<br/>将“乐企平台”统一改为全称“乐企数字开放平台” | 2023-01-13 |
| V2.001 | 全部 | 增加目录及页码 | 2023-01-29 |
| V2.002 | 附件二 | 调整json报文示例结构 | 2023-02-02 |
| V2.003 | 三、开发指引 | 修改初始化场景中，调用接口判断逻辑说明 | 2023-03-07 |
| V2.004 | 三、开发指引 | 校验发票异常凭证状态，由如果发票信息中“异常凭证状态”不是“01：正常”，则发票不允许用于勾选，修改为“异常凭证状态”是“02：异常凭证”, 则发票不允许用于勾选。 | 2023-07-12 |
| V2.005 | 四、接口列表 | 成品油异常标识增加码值“8：正常，需全额红冲” | 2023-11-27 |
| V2.006 | 四、接口列表 | 调整请求参数中【发票代码 fpdm】、【发票号码 fphm】说明 | 2023-12-22 |
| V2.007 | 全部 | 发票代办退税勾选增加业务规则，校验机动车异常标识。同时接口2.查询发票代办退税勾选处理结果 返回数据项【处理结果 cljg】增加码值“12：机动车异常发票” | 2024-03-22 |
| V2.007 | 附件二 | 一、发票 增加数据项【机动车异常标识 jdcycbs】 | 2024-03-22 |
| V2.008 | 三、开发指引 | 修改：1、发票代办勾选场景案例：全流程图、时序图；业务规则增加1.2.10一节内容 | 2024-08-23 |
| V2.008 | 四、接口列表 | 【1.批量上传代办退税发票】，增加发票明细商品编码中不得抵扣及退税商品编码的描述<br/>【2.查询发票代办退税勾选处理结果】，在出参“处理结果”中增加返回结果代码“32不得抵扣及退税发票” | 2024-08-23 |
| V2.008 | 附件一（接口数据项说明） | 增加：二、不得抵扣及退税商品编码表 | 2024-08-23 |
| V2.009 | 三、开发指引 | 根据总局需求，“不得抵扣及退税商品编码” 的发票允许勾选，本版本删除“V2.008”版本中增加的【1、发票代办勾选场景案例】：全流程图、时序图；以及业务规则1.2.10一节内容。 | 2024-09-29 |
| V2.009 | 四、接口列表 | 本版本删除“V2.008”版本中增加的【1.批量上传代办退税发票】，发票明细商品编码中不得抵扣及退税商品编码的描述内容。 | 2024-09-29 |
| V2.009 | 附件一（接口数据项说明） | 本版本删除“V2.008”版本中增加的【二、不得抵扣及退税商品编码表】 | 2024-09-29 |
| V2.010 | 全部 | 调整文档格式 | 2025-06-27 |
| V2.010 | <font style="color:rgb(0, 0, 0);">四、开发指引</font> | <font style="color:#000000;">修改：1、【1.发票代办勾选场景案例】：全流程图、时序图；业务规则增加1.2.9一节内容</font><br/><font style="color:#000000;">2、【2.代办退税勾选业务初始化场景】“校验申请次数”，调整为每月三次</font> | 2025-06-27 |
| V2.010 | 五、接口技术说明 | 【3.未勾选数据初始化清单下载申请】接口，1、入参增加“结束开票月份”，2、接口说明，增加特别说明内容。 | 2025-06-27 |
| V2.010 | <font style="color:rgb(0, 0, 0);">六、附件</font> | <font style="color:#000000;">增加：（三）、不得抵扣及退税商品编码</font> | 2025-06-27 |
| V2.011 | <font style="color:#000000;">五、接口技术说明</font> | 【（二）接口清单】增加调用接口说明与报文样例代码 |  |




目  录



[一、阅读指引	5](#_Toc201048387)

[二、能力介绍	6](#_Toc201048388)

[（一）能力简介	6](#_Toc201048389)

[（二）应用案例	6](#_Toc201048390)

[（三）名词解释	6](#_Toc201048391)

[（四）扩展阅读	6](#_Toc201048392)

[三、政策依据	7](#_Toc201048393)

[四、开发指引	8](#_Toc201048394)

[（一）业务场景	8](#_Toc201048395)

[1.发票代办勾选场景案例	8](#_Toc201048396)

[2.代办退税勾选业务初始化场景	18](#_Toc201048397)

[五、接口技术说明	23](#_Toc201048398)

[（一）能力编码	23](#_Toc201048399)

[（二）接口清单	23](#_Toc201048400)

[1.批量上传代办退税发票	23](#_Toc201048401)

[2.查询发票代办退税勾选处理结果	27](#_Toc201048402)

[3.未勾选数据初始化清单下载申请	31](#_Toc201048403)

[4.未勾选数据初始化清单下载申请反馈	33](#_Toc201048404)

[六、附件	37](#_Toc201048405)

[（一）接口数据项说明	37](#_Toc201048406)

[1.返回码代码表	37](#_Toc201048407)

[（二）未勾选数据初始化清单数据说明	38](#_Toc201048408)

[1.发票	38](#_Toc201048409)

[（三）不得抵扣及退税商品编码	40](#_Toc201048410)





# 一、阅读指引
为了满足纳税人多场景、规模化、合规化、自动化的代办退税需求，乐企数字开放平台提供发票代办退税勾选能力，通过本能力说明文档明确了增值税发票代办退税的相关业务规则和数据接口。

本能力适用于提供外贸综合服务的纳税人订阅。

本能力说明文档分为阅读指引、能力介绍、政策依据、开发指引、接口技术说明、附件等六个章节，其中阅读指引、能力介绍、政策依据等章节适合纳税人管理人员及财务人员阅读；开发指引、接口技术说明、附件等章节适合纳税人技术人员阅读。



# 二、能力介绍
## （一）能力简介
纳税人提供出口退税代理服务时，可以通过本能力进行代办退税。

纳税人可将本能力中的各类规则和接口嵌入本单位信息化系统中（如代理出口等），实现代办退税流程和商业行为的融合，有效提升代办退税业务办理效率。

纳税人不可以同时使用本能力、电子发票服务平台及增值税发票综合服务平台代办退税（税务机关另有规定除外）。



## （二）应用案例
某公司出口退税代理服务系统将发票代办退税勾选能力嵌入网上服务系统，系统通过乐企数字开放平台嵌入的增值税发票代办退税能力规则和接口，完成自动化发票退代办税勾选。



## （三）名词解释
能力：为企业直连完成某项业务所提供的接口服务和业务规则组合。

规则：实现某项业务目标所遵循的逻辑和校验。

接口：一组定义、程序及协议的集合，通过接口实现计算机软件之间的相互通信。

服务：提供某项业务实现，通过接口服务调用达到业务目标。

API：应用程序编程接口，是一些预先定义的函数，或指软件系统不同组成部分衔接的约定。用来提供应用程序与开发人员基于某软件或硬件得以访问的一组例程，而又无需访问源代码，或理解内部工作机制的细节。

## （四）扩展阅读
无

# 三、政策依据
《国家税务总局关于调整完善外贸综合服务企业办理出口货物退（免）税有关事项的公告》（国家税务总局公告2017年第35号）

《国家税务总局关于进一步便利出口退税办理 促进外贸平稳发展有关事项的公告》（国家税务总局公告2022年第9号）



# 四、开发指引
## （一）业务场景
### 1.发票代办勾选场景案例
某公司出口退税代理服务系统将发票代办退税勾选能力嵌入网上服务系统，系统通过乐企数字开放平台嵌入的增值税发票代办退税能力规则和接口，完成自动化发票退代办税勾选。

#### 1.1全流程图
![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114452606-fc51d4d2-938e-4d42-90a2-8265e766c0a1.png)

业务流程图

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114452891-36aabad3-a2b6-4148-b065-2dbbca75eac0.png)

时序图

#### 1.2业务规则 
##### 1.2.1校验是否为蓝字发票
根据用于勾选代办退税用途发票的金额，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114453195-56c0a6e2-c7f0-49db-b1ed-d030219295a2.png)

**判断逻辑**

校验发票金额，如果发票信息中“金额”小于0，则发票不允许用于代办退税勾选用途。

##### 1.2.2校验发票类型是否可代办退税
根据用于勾选代办退税用途发票的发票类型，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114453471-6c2ca116-3847-4f2a-b7ed-5b113c6fe7c1.png)

**判断逻辑**

校验发票类型，如果发票信息中“发票类型”不是以下发票类型，则发票不允许用于代办退税勾选用途：

01：增值税专用发票

08：增值税电子专用发票

81：电子发票（增值税专用发票）

85：纸质发票（增值税专用发票）

##### 1.2.3校验出口退税类型是否为可代办退税发票
根据用于勾选代办退税用途发票的“出口退税类型”，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114453744-372162b6-bbdb-421e-8fe6-6971ce1b608a.png)

**判断逻辑**

校验出口退税类型，如果“出口退税类型”不是“01：“增值税专用发票可用于代办退税标签”，则发票不允许用于代办退税勾选用途。

##### 1.2.4校验发票状态
根据用于勾选代办退税用途发票的发票状态，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114454016-c51dc9b3-7a43-4a7b-a656-372907e1a23c.png)

**判断逻辑**

校验发票状态，如果发票信息中“发票状态”不是“0:正常”或“7：部分红冲”，则发票不允许用于代办退税勾选用途。

##### 1.2.5校验发票异常凭证状态
根据用于勾选代办退税用途发票的异常凭证状态，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114454299-643ca2a6-8d70-4b93-ab0b-2e0cccccb566.png)

**判断逻辑**

校验发票异常凭证状态，如果发票信息中“异常凭证状态”是“02：异常凭证”，则发票不允许用于代办退税勾选用途。

##### 1.2.6校验成品油发票异常标识
根据用于勾选抵扣用途发票的成品油异常标识，校验发票是否可用于代办退税。



![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114454557-3e88132c-3de0-47d6-a20e-5f0002f86bda.png)

**判断逻辑**

校验成品油发票异常标识，如果发票信息中“成品油异常标识”不是“9：正常”，则不允许用于代办退税勾选用途。

##### 1.2.7校验待处理农产品发票确认状态
根据《乐企增值税抵扣勾选能力说明文档》中农产品发票预处理结果，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114454832-a21ee79b-1369-4d4f-9c58-f338603b4161.png)

**判断逻辑**

校验待处理农产品发票确认状态，如果为“未确认”，则发票不允许用于代办退税勾选用途。

##### 1.2.8校验机动车异常标识
根据用于勾选代办退税用途发票的机动车异常标识，校验发票是否可用于代办退税勾选。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114455057-9c5c1822-ca12-4d01-a3ae-505db411bb6b.png)

**判断逻辑**

校验机动车类商品增值税专用发票异常标识，如果发票信息中“机动车异常标识”是“3：高风险”，则不允许用于代办退税勾选用途。

##### 1.2.9校验发票商品编码是否含不得抵扣及退税商品编码
根据发票明细中的商品编码是否含不得抵扣及退税商品编码，校验发票是否可用于代办退税。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114456135-4a5197f1-c6d0-472e-bfad-ed42b1b69ee5.png)

**判断逻辑**

<font style="color:#000000;">1、发票明细商品编码含“</font>开头为30705（居民日常服务）<font style="color:#000000;">”、“</font>开头为3070401（餐饮服务）<font style="color:#000000;">”、“</font>开头为3070302（娱乐服务）<font style="color:#000000;">”，且不含“</font>开头为30601（贷款服务）<font style="color:#000000;">”的发票，且开票日期在2025年12月31日之前（含）混开或者开票日期在2026年1月1日之后（含），此类发票属于“提示提醒类不得抵扣及退税发票”，</font>系统应提供“用途勾选”选择框，分为“**勾选不抵扣**”、“**暂不勾选**”、“**我已知晓政策继续抵扣**”三类。

勾选“我已知晓政策继续抵扣”，允许用于代办退税勾选，可上传抵扣。

勾选“勾选不抵扣”，则不用上传发票。

勾选“暂不勾选”，则不上传发票。

<font style="color:#000000;">并按以下消息提示提醒经办人员：</font>

<font style="color:#000000;">a、对于</font>纳税人同一属期勾选发票仅有发票开具日期小于等于2025年12月31日的：提示提醒内容为：“**尊敬的纳税人：您勾选用于抵扣的发票中涉及餐饮服务、居民日常服务和娱乐服务项目，根据《财政部 国家税务总局关于全面推开营业税改征增值税试点的通知》(财税〔2016〕36号)规定，餐饮服务、居民日常服务和娱乐服务对应的进项税额不得抵扣。**请您对勾选抵扣的发票进行再次确认。如有疑问，请及时联系主管税务机关或拨打12366咨询**！**”

b、<font style="color:#000000;">对于</font>纳税人同一属期勾选发票仅有2026年1月1日及以后开具发票情形，则<font style="color:#000000;">提示提醒内容为：“尊敬的纳税人：您勾选用于抵扣的发票中涉及餐饮服务、居民日常服务和娱乐服务项目，根据《中华人民共和国增值税法》规定，</font>**<font style="color:#000000;">购进并直接用于消费的餐饮服务、居民日常服务和娱乐服务对应的进项税额不得抵扣</font>**<font style="color:#000000;">。请您对勾选抵扣的发票进行再次确认。如有疑问，请及时联系主管税务机关或拨打12366咨询！”</font>

<font style="color:#000000;">c、</font>对于纳税人同一属期勾选涉及发票既有2025年12月31日及以前开具的，又有2026年1月1日后开具发票的：提示提醒内容为：“尊敬的纳税人：您勾选用于抵扣的发票中涉及餐饮服务、居民日常服务和娱乐服务项目，如您发生勾选抵扣《中华人民共和国增值税法》施行前上述项目进项发票情形，根据《财政部 国家税务总局关于全面推开营业税改征增值税试点的通知》(财税〔2016〕36号)规定，餐饮服务、居民日常服务和娱乐服务对应的进项税额不得抵扣；如您发生勾选抵扣《中华人民共和国增值税法》施行后上述项目进项发票情形，根据《中华人民共和国增值税法》规定，购进并直接用于消费的餐饮服务、居民日常服务和娱乐服务对应的进项税额不得抵扣。请您对勾选抵扣的发票进行再次确认。如有疑问，请及时联系主管税务机关或拨打12366咨询**！**”

<font style="color:#000000;">2、发票明细商品编码仅含“</font>开头为30705（居民日常服务）<font style="color:#000000;">”、“</font>开头为3070401（餐饮服务）<font style="color:#000000;">”、“</font>开头为3070302（娱乐服务）<font style="color:#000000;">”的一种、二种或三种（纯开）的发票且开票日期在2025年12月31日之前（含）的，此类发票属于“强制类不得抵扣及退税发票”</font>，不允许用于代办退税勾选。

<font style="color:#000000;">3、发票明细商品编码含“</font>开头为30601（贷款服务）<font style="color:#000000;">”的发票（无论混开或纯开）时，此类发票属于“强制类不得抵扣及退税发票”</font>，不允许用于代办退税勾选。

##### 1.2.10批量上传代办退税发票
调用《批量上传代办退税发票》接口，批量上传代办退税勾选发票。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114456568-2f2842f5-4c96-428c-b27d-db8605bcac28.png)



**判断逻辑**

参照《批量上传代办退税发票》接口规范录入，满足以下任意条件时阻断勾选。

（1）处理失败，调用《批量上传代办退税发票》接口通信失败或者返回报文中“上传状态”不是“00（成功）”。

##### 1.2.11查询发票代办退税勾选处理结果
调用《查询发票代办退税勾选处理结果》接口，查询勾选代办退税用途处理结果。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114456885-c2be692d-7b30-447f-be77-e5a6096d241b.png)

**判断逻辑**

参照《查询发票代办退税勾选处理结果》接口规范录入批次流水号查询对应发票勾选处理结果，满足以下任意条件时阻断查询代办退税勾选处理结果。

（1）返回失败，调用《查询发票代办退税勾选处理结果》接口通信失败或者返回报文中“返回码”不是“00（成功）”。

### 2.代办退税勾选业务初始化场景
#### 2.1全流程图
![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114457249-d55f2ffc-7cf0-4528-99dd-9d9189f0ca8a.png)

业务流程图

![](https://cdn.nlark.com/yuque/0/2025/jpeg/647520/1759114457584-b61efb8b-fca1-4384-b050-f75394c86287.jpeg)

时序图

#### 2.2业务规则
##### 2.2.1代办退税勾选业务初始化-发票
###### 2.2.1.1校验申请次数
根据申请日期，校验是否允许发起代办退税勾选业务初始化-发票申请。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114457890-e997b8d1-6014-4ced-942c-fcf89f11193e.png)

**判断逻辑**

校验每月申请次数，如果属于以下情况，则不允许发起代办退税勾选业务初始化-发票申请：（以当前日期为 2022-06-10 为例）

（1）每月申请下载相同月份（含当前月份）次数超过3次；

（2）同一个月内，相同月份非首次下载时，申请的“起始开票月份”至“结束开票月份”相差月份超过三个月。

如：6月10日第一次申请下载代办退税勾选业务初始化-发票清单后，再次申请时，相同月份的次数不超过三次，且“起始开票月份”至“结束开票月份”相差月份不能超过三个月。

###### 2.2.1.2申请代办退税勾选业务初始化-发票清单
调用《未勾选数据初始化清单下载申请》接口，进行代办退税勾选业务初始化-发票下载申请。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114458150-f2359a5a-572a-442f-9cee-812db3666a4a.png)

**判断逻辑**

参照《未勾选数据初始化清单下载申请》接口规范获取代办退税勾选业务初始化-发票数据，对返回码进行校验，如果属于下列情况，则阻断发票清单下载申请：

（1）查询失败，调用《未勾选数据初始化清单下载申请》接口通信失败或者返回报文中“返回码”不是“00（成功）”。

###### 2.2.1.3查询代办退税勾选业务初始化-发票申请反馈信息
调用《未勾选数据初始化清单下载申请反馈》接口，获取代办退税勾选业务初始化-发票申请反馈信息。

![](https://cdn.nlark.com/yuque/0/2025/png/647520/1759114458579-b58f80a4-21cc-46f5-887e-f908a827e702.png)

**判断逻辑**

参照《未勾选数据初始化清单下载申请反馈》接口规范，根据申请批次流水号批量下载代办退税勾选业务初始化-发票信息，对返回码进行校验，如果属于下列情况，则阻断发票清单下载申请：

（1）查询失败，调用《未勾选数据初始化清单下载申请反馈》接口通信失败或者返回报文中“返回码”不是“00（成功）”。





# 五、接口技术说明
## （一）能力编码
| 能力名称 | 乐企代办退税勾选能力 |
| --- | --- |
| 能力编码 | 203066 |


## （二）接口清单
| 序号 | 接口名称 | **<font style="color:#000000;">服务编码</font>** |
| --- | --- | --- |
| <font style="color:#000000;">1</font> | [批量上传代办退税发票](#_1.批量上传代办退税发票) | PLFPDBGX |
| <font style="color:#000000;">2</font> | [查询发票代办退税勾选处理结果](#_2查询发票代办退税勾选处理结果) | CXDBTSGX |
| <font style="color:#000000;">3</font> | [未勾选数据初始化清单下载申请](#_3.未勾选数据初始化清单下载申请) | WGXSJCSHQDXZSQDBTSGX |
| <font style="color:#000000;">4</font> | [未勾选数据初始化清单下载申请反馈](#_4.未勾选数据初始化清单下载申请反馈) | WGXSJCSHQDXZSQFKDBTSGX |




企业调用以上接口时，需以报文的形式在正式环境访问，报文包括：请求地址，报文头，报文体。

请求地址：

| [https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/](https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/)能力编码/服务编码/ |
| --- |


请求报文头header:

| **Key** | **名称** | **值** | **说明** |
| :---: | :---: | :---: | :---: |
| jrdwptbh | 直连单位乐企ID | XXXXXXXXXXXXXXXXXXXX | 必录 |
| sydwptbh | 使用单位乐企ID | XXXXXXXXXXXXXXXXXXXX | 必录 |
| ylbm | 用例编码 | XXXXXX | 非必录，沙箱环境必录，生产环境可空。 |
| clientTid | 客户端交易ID | 32位字母、数字组合 | **非必录**，用于企业侧与乐企侧之间的请求响应时长监测或其他业务跟踪。<br/>**特别注意：**建议使用UUID或自有业务系统会话ID，以减少重复概率。 |


报文体：

报文体见具体接口的“请求报文示例”部分内容。

举例：

本能力以“批量上传代办退税发票”接口为例，调用报文样例如下：

| 请求地址URL：<br/>[https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/203066/](https://lqpt.chinatax.gov.cn:8443/access/v2/invoke/203066/) PLFPDBGX /<br/>请求头:<br/>{"jrdwptbh":"5d2cff***35ab98943c","sydwptbh":"5d2d0063******58730da","ylbm":""}<br/>报文体：<br/>{<br/>	"gfsbh": "915100************",<br/>	"fpmx": [<br/>		{<br/>			"kprq": "20250701",<br/>			"fpdm": "5101*****111",<br/>			"fphm": "00000001",<br/>			"fplx": "01"<br/>		}, {<br/>			"kprq": "20250701",<br/>			"fpdm": "5101*****111",<br/>			"fphm": "12345678",<br/>			"fplx": "08"<br/>		}<br/>	]<br/>} |
| --- |




### 1.批量上传代办退税发票
#### 1.1接口说明
企业业务系统通过此接口对批量发票下载的代办退税发票进行批量上传。（单次申请不能超过2000条数据，若超过2000条数据则本次申请不予受理。）

#### 1.2请求方式
请求方式为POST

path 指该参数为路径参数

query 指该参数需在请求URL传参

body 指该参数需在请求JSON传参

#### 1.3请求参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | gfsbh | 购买方统一社会信用代码/纳税人识别号 | String | 30 | 是 |  |
| 明细数据（fpmx） | | | | | | |
| 1 | kprq | 开票日期 | String | 8 | 是 | YYYYMMDD |
| 2 | fpdm | 发票代码 | String | 12 | 否 | 发票类型为：01、08传纸质发票代码，其他发票类型无需传入 |
| 3 | fphm | 发票号码 | String | 20 | 是 | 发票类型为：01、08传纸质发票号码<br/>发票类型为：81、85传20位数字化电子发票号码 |
| 4 | fplx | 发票类型 | String | 2 | 是 | 01：增值税专用发票<br/>08：增值税电子专用发票<br/>81：电子发票（增值税专用发票）<br/>85：纸质发票（增值税专用发票） |


#### 1.4请求报文示例
| {<br/>	"gfsbh": "购买方统一社会信用代码/纳税人识别号",<br/>	"fpmx": [<br/>		{<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"fplx": "发票类型"<br/>		}, {<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"fplx": "发票类型"<br/>		}<br/>	]<br/>} |
| --- |


#### 1.5返回参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | String | 2 | 是 | 详情可参照“六、附件：1.返回码代码表”<br/>批量数据中有一条成功即视为成功 |
| 2 | returnmsg | 返回信息 | String | 2000 | 否 | 错误信息说明 |
| 3 | pclsh | 批次流水号 | String | 32 | 否 | 返回码不是00：成功时，不返回 |
| <font style="color:#000000;">明细数据（fpmx）</font> | | | | | | |
| 1 | kprq | 开票日期 | String | 8 | 是 | YYYYMMDD |
| 2 | fpdm | 发票代码 | String | 12 | 否 | 数字化电子发票发票代码可为空 |
| 3 | fphm | 发票号码 | String | 20 | 是 | 数字化电子发票，发票号码20位 |
| 4 | sczt | 上传状态 | String | 2 | 是 | 00：成功<br/>01：失败 |
| 5 | errormsg | 错误信息 | String | 2000 | 否 | 01：失败时记录失败原因 |


#### 1.6返回报文示例
| {<br/>	"returncode": "返回码",<br/>	"returnmsg": "返回信息",<br/>	"pclsh": "批次流水号",<br/>	"fpmx": [<br/>		{<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"sczt": "上传状态",<br/>			"errormsg": "错误信息"<br/>		}, {<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"sczt": "上传状态",<br/>			"errormsg": "错误信息"<br/>		}<br/>	]<br/>} |
| --- |


失败返回：

| {<br/>	"Response": {<br/>		"RequestId": "16位随机数字和字母组合",<br/>		"Error": {<br/>			"Code": "01",<br/>			"Message": "错误说明"<br/>		}<br/>	}<br/>} |
| --- |


### 2.查询发票代办退税勾选处理结果
#### 2.1接口说明
企业业务系统完成对代办退税发票的批量上传后，通过此接口查询代办退税勾选处理结果。

#### 2.2请求方式
请求方式为POST

path 指该参数为路径参数

query 指该参数需在请求URL传参

body 指该参数需在请求JSON传参

#### 2.3请求参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | pclsh | 批次流水号 | String | 32 | 是 |  |


#### 2.4请求报文示例
| {<br/>	"pclsh": "批次流水号"<br/>} |
| --- |


#### 2.5返回参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | String | 2 | 是 | 详情可参照“六、附件：1.返回码代码表”  |
| 2 | returnmsg | 返回信息 | String | 2000 | 否 | 错误信息说明 |
| 3 | pclsh | 批次流水号 | String | 32 | 是 |  |
| 4 | gfsbh | 购买方统一社会信用代码/纳税人识别号 | String | 30 | 是 |  |
| <font style="color:#000000;">明细数据（fpmx）</font> | | | | | | |
| 1 | kprq | 开票日期 | String | 8 | 是 | YYYYMMDD |
| 2 | fpdm | 发票代码 | String | 12 | 否 |  |
| 3 | fphm | 发票号码 | String | 20 | 是 |  |
| 4 | skssq | 税款所属期 | String | 6 | 否 | 格式YYYYMM，抵扣成功时该字段不为空 |
| 5 | cljg | 处理结果 | String | 2 | 否 | 01：勾选（撤销）成功 <br/>02：查无此票 <br/>03：该票异常无法勾选<br/>04：该票已经逾期无法认证  <br/>06：已勾选无法重复勾选<br/>07：未到期发票不可勾选（开票月份大于当前属期）<br/><font style="color:#000000;">12：机动车异常发票</font><br/>13：发票号码重复<br/>31：待处理农产品发票未确认<br/>32：不得抵扣及退税发票 <br/>99：其它 |
| 6 | gxsj | 勾选时间 | String | 8 | 否 |  |
| 7 | fpzt | 发票状态 | String | 2 | 否 | 处理结果为03：该票异常无法勾选时，根据实际情况反馈此码值<br/>0：正常<br/>1：失控<br/>2：作废<br/>3：已红冲<br/>7：部分红冲<br/>8：全额红冲 |
| 8 | sfycpz | 是否异常凭证 | String | 2 | 否 | 处理结果为03 ：该票异常无法勾选时，根据实际情况反馈此码值。<br/>01：正常<br/>02：异常凭证<br/>03：疑似异常凭证 |
| 9 | sdzt | 锁定状态 | String | 2 | 否 | 处理结果为03 该票异常无法勾选时，根据实际情况反馈此码值。<br/>01：未锁定<br/>02：已锁定 |
| 10 | cpyycbs | 成品油异常标识 | String | 1 | 否 | 处理结果为03：该票异常无法勾选时，根据实际情况反馈此码值<br/>9：正常<br/>1：成品油单价异常<br/>2：成品油超库存异常<br/>8：正常，需全额红冲 |


#### 2.6返回报文示例
| {<br/>	"returncode": "返回码",<br/>	"returnmsg": "返回信息",<br/>	"pclsh": "批次流水号",<br/>	"gfsbh": "购买方统一社会信用代码/纳税人识别号",<br/>	"fpmx": [<br/>		{<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"skssq": "税款所属期",<br/>			"cljg": "处理结果",<br/>			"gxsj": "勾选时间",<br/>			"fpzt": "发票状态",<br/>			"sfycpz": "是否异常凭证",<br/>			"sdzt": "锁定状态",<br/>			"cpyycbs": "成品油异常标识"<br/>		}, {<br/>			"kprq": "开票日期",<br/>			"fpdm": "发票代码",<br/>			"fphm": "发票号码",<br/>			"skssq": "税款所属期",<br/>			"cljg": "处理结果",<br/>			"gxsj": "勾选时间",<br/>			"fpzt": "发票状态",<br/>			"sfycpz": "是否异常凭证",<br/>			"sdzt": "锁定状态",<br/>			"cpyycbs": "成品油异常标识"<br/>		}<br/>	]<br/>} |
| --- |


失败返回：

| {<br/>	"Response": {<br/>		"RequestId": "16位随机数字和字母组合",<br/>		"Error": {<br/>			"Code": "01",<br/>			"Message": "错误说明"<br/>		}<br/>	}<br/>} |
| --- |


### 3.未勾选数据初始化清单下载申请
#### 3.1接口说明
企业业务系统通过在线申请下载未勾选数据初始化清单，申请成功后返回批次流水号，后续通过批次流水号、业务类型、凭证种类下载代办退税勾选业务场景未勾选的发票信息。

<font style="color:#FF0000;">特别说明：1、下载数据范围为“起始开票月份”至“结束开票月份”清单数据。</font>

<font style="color:#FF0000;">2、</font><font style="color:#FF0000;">每个月最多可以申请下载相同月份（含当前月份）的数据三次。</font>

<font style="color:#FF0000;">3、同一个月内企业首次申请下载时，可以全量申请下载。再次申请下载时，申请的“起始开票月份”至“结束开票月份”相差月份不能超过三个月（超过三个月则会拒绝处理）。如果首次申请下载时，因申请下载数据量过大导致调用“未勾选数据初始化清单下载申请反馈”接口返回信息为处理中或失败状态，再次申请下载时建议企业按月申请，即请求参数“起始开票月份”和“结束开票月份”相同，例如需要申请下载2020年到2024年数据时，应分次分别传入202001-202001，202002-202002，……，202412-202412的请求。</font>



| 序号 | 业务名称 | 业务类型 | 凭证种类 |
| --- | --- | --- | --- |
| 1 | 代办退税勾选业务初始化-发票 | 04 | 01 |


#### 3.2请求方式
请求方式为POST

path 指该参数为路径参数

query 指该参数需在请求URL传参

body 指该参数需在请求JSON传参

#### 3.3请求参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | gfsbh | 购方纳税人识别号/统一社会信用代码 | String | 30 | 是 |  |
| 2 | ywlx | 业务类型 | String | 2 | 是 | 04：代办退税业务 |
| 3 | pzzl | 凭证种类 | String | 2 | 是 | 01：发票 |
| <font style="color:#000000;">4</font> | <font style="color:#000000;">kpyf</font> | <font style="color:rgb(0, 0, 0);">起始开票月份</font> | <font style="color:#000000;">String</font> | <font style="color:#000000;">6</font> | <font style="color:#000000;">否</font> | <font style="color:#000000;">申请下载起始开票月份， 格式YYYYMM</font><br/><font style="color:#000000;">1、为空时，默认查询从“结束开票月份”倒推近三月数据</font><br/><font style="color:#000000;">2、“起始开票月份”和“结束开票月份”都为空时，默认查询近三月（不含当月）数据</font> |
| <font style="color:#000000;">5</font> | <font style="color:#000000;">jskpyf</font> | <font style="color:rgb(0, 0, 0);">结束开票月份</font> | <font style="color:#000000;">String</font> | <font style="color:#000000;">6</font> | <font style="color:#000000;">否</font> | <font style="color:#000000;">申请下载结束开票月份，格式YYYYMM</font><br/><font style="color:#000000;">1、为空时，默认查询截止到当前月份数据</font> |


#### 3.4请求报文示例
| {<br/>	"gfsbh": "购方纳税人识别号/统一社会信用代码",<br/>	"ywlx": "业务类型",<br/>	"pzzl": "凭证种类",<br/>	"kpyf": "起始开票月份",<br/>	"jskpyf": "结束开票月份"<br/>} |
| --- |


#### 3.5返回参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | String | 2 | 是 | 详情可参照“六、附件：1.返回码代码表”  |
| 2 | returnmsg | 返回信息 | String | 2000 | 否 | 错误信息说明 |
| 3 | pclsh | 批次流水号 | String | 32 | 否 | 返回码不是00：成功时，不返回 |


#### 3.6返回报文示例
| {<br/>	"Response": {<br/>		"RequestId": "系统自动生成ID",<br/>		"Data": {<br/>			"returncode": "返回码",<br/>			"returnmsg": "返回信息",<br/>			"pclsh": "批次流水号"<br/>		}<br/>	}<br/>} |
| --- |


<font style="color:#000000;">失败返回：</font>

| {<br/>	"Response": {<br/>		"RequestId": "16位随机数字和字母组合",<br/>		"Error": {<br/>			"Code": "01",<br/>			"Message": "错误说明"<br/>		}<br/>	}<br/>} |
| --- |


### 4.未勾选数据初始化清单下载申请反馈
#### 4.1接口说明
企业业务系统通过接口根据申请批次流水号下载代办退税勾选业务场景未勾选的发票信息，用于代办退税勾选业务。（查询数据超过5000条则开始分包处理）

#### 4.2请求方式
请求方式为POST

path 指该参数为路径参数

query 指该参数需在请求URL传参

body 指该参数需在请求JSON传参

#### 4.3请求参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | pclsh | 批次流水号 | String | 32 | 是 |  |
| 2 | packageno | 包号 | String | 5 | 是 | 数据包号，当数据量过大时会进行分包处理，初始包号1 |


#### 4.4请求报文示例
| {<br/>	"pclsh": "批次流水号",<br/>	"packageno": "包号"<br/>} |
| --- |


#### 4.5返回参数
| 序号 | 数据项标识 | 数据项名称 | 字段类型 | 长度 | 必须 | 说明 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | String | 2 | 是 | 详情可参照“六、附件：1.返回码代码表” |
| 2 | returnmsg | 返回信息 | String | 2000 | 否 | 错误信息说明 |
| 3 | packagecount | 总包数 | String | 5 | 是 | 当前流水号下的总包数 |
| 4 | gfsbh | 购方纳税人识别号/统一社会信用代码 | String | 30 | 是 |  |
| 5 | cljg | 处理结果 | String | 1 | 是 | 1：成功 <br/>2：不存在符合条件的发票<br/>3：失败 |
| 6 | sjl | 数据流 | String |  | 否 | 压缩包文件流（gzip+base64），原始数据为json报文<br/>Json报文格式详见：“六、附件（二）未勾选数据初始化清单信息数据说明” |


#### 4.6返回报文示例
| {<br/>	"Response": {<br/>		"RequestId": "系统自动生成ID",<br/>		"Data": {<br/>			"returncode": "返回码",<br/>			"returnmsg": "返回信息",<br/>			"packagecount": "总包数",<br/>			"gfsbh": "购方纳税人识别号/统一社会信用代码",<br/>			"cljg": "处理结果",<br/>			"sjl": "数据流"<br/>		}<br/>	}<br/>} |
| --- |


失败返回：

| {<br/>	"Response": {<br/>		"RequestId": "16位随机数字和字母组合",<br/>		"Error": {<br/>			"Code": "01",<br/>			"Message": "错误说明"<br/>		}<br/>	}<br/>} |
| --- |






# 六、附件
## （一）接口数据项说明
### 1.返回码代码表
| 序号 | 数据项标识 | 数据项名称 | 代码 | 代码名称 | 备注 |
| --- | --- | --- | --- | --- | --- |
| 1 | returncode | 返回码 | 00 | 成功 |  |
| 2 | returncode | 返回码 | 01 | 参数校验异常 | 如发票号码数据项为空、开票日期数据项格式不正确等 |
| 3 | returncode | 返回码 | 03 | 拒绝处理 | 如当前企业未授权、当前属期已锁定无法进行抵扣勾选、超过可申请次数等 |
| 4 | returncode | 返回码 | 04 | 查无数据 | 如当前传入的pclsh不存在 |
| 5 | returncode | 返回码 | 09 | 系统处理异常 | 如获取税款所属期失败 |
| 6 | returncode | 返回码 | 10 | 数据处理中 | 建议间隔3-5分钟再来查询 |
| 7 | returncode | 返回码 | 11 | 当前企业无资格办理此业务 |  |
| 8 | returncode | 返回码 | 99 | 系统级异常 |  |








## （二）未勾选数据初始化清单数据说明
### 1.发票
包含以下发票类型：

01：增值税专用发票

08：增值税电子专用发票

81：电子发票（增值税专用发票）

85：纸质发票（增值税专用发票）

原始数据为json报文字段说明

| 序号 | 数据项名称 | 数据项标识符 | 是否可空 | 字段类型 | 字段长度 | 备注 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 发票号码 | fphm | N | VARCHAR | 20 | 如果是税控开具发票，需要按发票代码+发票号码拼装；电票平台开具数字化电子发票电票、数字化电子发票纸票传数字化电子发票的20位号码 |
| 2 | 纸质发票代码 | zzfpDm | Y | VARCHAR | 12 | 税控开具发票或电票平台开具数字化电子发票纸票传纸质发票代码 |
| 3 | 纸质发票号码 | zzfphm | Y | VARCHAR | 8 | 税控开具发票或电票平台开具数字化电子发票纸票传纸质发票号码 |
| 4 | 开票日期 | kprq | N | VARCHAR | 8 | YYYYMMDD |
| 5 | 购买方统一社会信用代码/纳税人识别号 | gfsbh | N | VARCHAR | 30 |  |
| 6 | 发票类型 | fplx | N | VARCHAR | 2 | 代办退税勾选业务可传发票类型：01、08、81、85 |
| 7 | 发票状态 | fpzt | Y | VARCHAR | 1 | 0：正常<br/>2：作废<br/>3：已红冲<br/>7：部分红冲<br/>8：全额冲红 |
| 8 | 异常凭证状态 | ycpzzt | Y | VARCHAR | 2 | 01：正常<br/>02：异常凭证<br/>03：疑似异常凭证 |
| 9 | 红字锁定标识 | hzsdbs | Y | VARCHAR | 1 | Y：锁定<br/>N：未锁定 |
| 10 | 成品油异常标识 | cpyycbs | Y | VARCHAR | 1 | 9：正常<br/>1：成品油单价异常<br/>2：成品油超库存异常 |
| 11 | 有效抵扣税额 | yxdkse | Y | DECIMAL | 18,2 |  |
| 12 | 加计扣除额合计 | jjkcehj | Y | DECIMAL | 18,2 | 申请业务类型为04：代办退税业务时可空 |
| 13 | 加计扣除剩余额 | jjkcsye | Y | DECIMAL | 18,2 | 申请业务类型为04：代办退税业务时可空 |
| <font style="color:#000000;">14</font> | <font style="color:#000000;">机动车异常标识</font> | <font style="color:#000000;">jdcycbs</font> | <font style="color:#000000;">Y</font> | <font style="color:#000000;">VARCHAR</font> | <font style="color:#000000;">1</font> | <font style="color:#000000;">0：无风险</font><br/><font style="color:#000000;">1：低风险</font><br/><font style="color:#000000;">2：中风险</font><br/><font style="color:#000000;">3：高风险</font> |


原始数据为json报文示例

| [<br/>	{<br/>		"fphm": "发票号码",<br/>		"zzfpDm": "纸质发票代码",<br/>		"zzfphm": "纸质发票号码",<br/>		"kprq": "开票日期",<br/>		"gfsbh": "购买方统一社会信用代码/纳税人识别号",<br/>		"fplx": "发票类型",<br/>		"fpzt": "发票状态",<br/>		"ycpzzt": "异常凭证状态",<br/>		"hzsdbs": "红字锁定标识",<br/>		"cpyycbs": "成品油异常标识",<br/>		"yxdkse": "有效抵扣税额",<br/>		"jjkcehj": "加计扣除额合计",<br/>		"jjkcsye": "加计扣除剩余额",<br/>		"jdcycbs": "<font style="color:#000000;">机动车异常标识</font>"<br/>	}, {<br/>		"fphm": "发票号码",<br/>		"zzfpDm": "纸质发票代码",<br/>		"zzfphm": "纸质发票号码",<br/>		"kprq": "开票日期",<br/>		"gfsbh": "购买方统一社会信用代码/纳税人识别号",<br/>		"fplx": "发票类型",<br/>		"fpzt": "发票状态",<br/>		"ycpzzt": "异常凭证状态",<br/>		"hzsdbs": "红字锁定标识",<br/>		"cpyycbs": "成品油异常标识",<br/>		"yxdkse": "有效抵扣税额",<br/>		"jjkcehj": "加计扣除额合计",<br/>		"jjkcsye": "加计扣除剩余额",<br/>		"jdcycbs": "<font style="color:#000000;">机动车异常标识</font>"<br/>	}<br/>] |
| --- |




## （三）不得抵扣及退税商品编码
| **提示提醒不得抵扣类别** | **商品和服务税收分类合并编码** | **货物和劳务名称** |
| --- | --- | --- |
| 开头为30705（居民日常服务）的编码 | **3070500000000000000** | **居民日常服务** |
| | 3070501000000000000 | 殡葬服务 |
| | 3070502000000000000 | 养老服务 |
| | 3070503000000000000 | 员工制家政服务 |
| | 3070504000000000000 | 育养服务 |
| | 3070599000000000000 | 其他居民日常服务 |
| 开头为3070401（餐饮服务）的编码 | 3070401000000000000 | 餐饮服务 |
| 开头为3070302（娱乐服务）的编码 | 3070302000000000000 | 娱乐服务 |
| 开头为30601（贷款服务）的编码 | 3060100000000000000 | 贷款服务 |
| | 3060101000000000000 | 金融同业往来业务 |
| | 3060102000000000000 | 金融机构农户小额贷款 |
| | 3060103000000000000 | 国家助学贷款 |
| | 3060104000000000000 | 国债 |
| | 3060105000000000000 | 地方政府债 |
| | 3060106000000000000 | 住房公积金个人住房贷款 |
| | 3060107000000000000 | 外汇局外汇贷款 |
| | 3060108000000000000 | 统借统还 |
| | 3060109000000000000 | 融资性售后回租 |
| | 3060109010000000000 | 有形动产融资性售后回租 |
| | 3060109020000000000 | 不动产融资性售后回租 |
| | 3060109990000000000 | 其他融资性售后回租 |
| | 3060110000000000000 | 客户贷款 |
| | 3060110010000000000 | 企业贷款 |
| | 3060110020000000000 | 个人贷款 |
| | 3060110030000000000 | 票据贴现 |
| | 3060199000000000000 | 其他贷款服务 |








